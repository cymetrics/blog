{"version":3,"file":"min.js","sources":["../src/main.js"],"sourcesContent":["/**\n * Copyright (c) 2020 Google Inc\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n * the Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst exposed = {};\nif (location.search) {\n  var a = document.createElement(\"a\");\n  a.href = location.href;\n  a.search = \"\";\n  setTimeout(() => {\n    history.replaceState(null, null, a.href);\n  }, 5000)\n}\n\nfunction tweet_(url) {\n  open(\n    \"https://twitter.com/intent/tweet?url=\" + encodeURIComponent(url),\n    \"_blank\"\n  );\n}\nfunction tweet(anchor) {\n  tweet_(anchor.getAttribute(\"href\"));\n}\nexpose(\"tweet\", tweet);\n\nfunction share(anchor) {\n  var url = anchor.getAttribute(\"href\");\n  event.preventDefault();\n  if (navigator.share) {\n    navigator.share({\n      url: url,\n    });\n  } else if (navigator.clipboard) {\n    navigator.clipboard.writeText(url);\n    message(\"URL copied!\");\n  } else {\n    tweet_(url);\n  }\n}\nexpose(\"share\", share);\n\nfunction message(msg) {\n  var dialog = document.getElementById(\"message\");\n  dialog.textContent = msg;\n  dialog.setAttribute(\"open\", \"\");\n  setTimeout(function () {\n    dialog.removeAttribute(\"open\");\n  }, 3000);\n}\n\nfunction prefetch(e) {\n  if (e.target.tagName != \"A\") {\n    return;\n  }\n  if (e.target.origin != location.origin) {\n    return;\n  }\n  /**\n   * Return the given url with no fragment\n   * @param {string} url potentially containing a fragment\n   * @return {string} url without fragment\n   */\n  const removeUrlFragment = (url) => url.split(\"#\")[0];\n  if (removeUrlFragment(window.location.href) === removeUrlFragment(e.target.href)) {\n    return;\n  }\n  var l = document.createElement(\"link\");\n  l.rel = \"prefetch\";\n  l.href = e.target.href;\n  document.head.appendChild(l);\n}\ndocument.documentElement.addEventListener(\"mouseover\", prefetch, {\n  capture: true,\n  passive: true,\n});\ndocument.documentElement.addEventListener(\"touchstart\", prefetch, {\n  capture: true,\n  passive: true,\n});\n\nconst GA_ID = document.documentElement.getAttribute(\"ga-id\");\nwindow.ga =\n  window.ga ||\n  function () {\n    if (!GA_ID) {\n      return;\n    }\n    (ga.q = ga.q || []).push(arguments);\n  };\nga.l = +new Date();\nga(\"create\", GA_ID, \"auto\");\nga(\"set\", \"transport\", \"beacon\");\nvar timeout = setTimeout(\n  (onload = function () {\n    clearTimeout(timeout);\n    ga(\"send\", \"pageview\");\n  }),\n  1000\n);\n\nvar ref = +new Date();\nfunction ping(event) {\n  var now = +new Date();\n  if (now - ref < 1000) {\n    return;\n  }\n  ga(\"send\", {\n    hitType: \"event\",\n    eventCategory: \"page\",\n    eventAction: event.type,\n    eventLabel: Math.round((now - ref) / 1000),\n  });\n  ref = now;\n}\naddEventListener(\"pagehide\", ping);\naddEventListener(\"visibilitychange\", ping);\n\n/**\n * Injects a script into document.head\n * @param {string} src path of script to be injected in <head>\n * @return {Promise} Promise object that resolves on script load event\n */\nconst dynamicScriptInject = (src) => {\n  return new Promise((resolve) => {\n    const script = document.createElement(\"script\");\n    script.src = src;\n    script.type = \"text/javascript\";\n    document.head.appendChild(script);\n    script.addEventListener(\"load\", () => {\n      resolve(script);\n    });\n  });\n};\n\n// Script web-vitals.js will be injected dynamically if user opts-in to sending CWV data.\nconst sendWebVitals = document.currentScript.getAttribute(\"data-cwv-src\");\n\nif (/web-vitals.js/.test(sendWebVitals)) {\n  dynamicScriptInject(`${window.location.origin}/js/web-vitals.js`)\n    .then(() => {\n      webVitals.getCLS(sendToGoogleAnalytics);\n      webVitals.getFID(sendToGoogleAnalytics);\n      webVitals.getLCP(sendToGoogleAnalytics);\n    })\n    .catch((error) => {\n      console.error(error);\n    });\n}\n\naddEventListener(\n  \"click\",\n  function (e) {\n    var button = e.target.closest(\"button\");\n    if (!button) {\n      return;\n    }\n    ga(\"send\", {\n      hitType: \"event\",\n      eventCategory: \"button\",\n      eventAction: button.getAttribute(\"aria-label\") || button.textContent,\n    });\n  },\n  true\n);\nvar selectionTimeout;\naddEventListener(\n  \"selectionchange\",\n  function () {\n    clearTimeout(selectionTimeout);\n    var text = String(document.getSelection()).trim();\n    if (text.split(/[\\s\\n\\r]+/).length < 3) {\n      return;\n    }\n    selectionTimeout = setTimeout(function () {\n      ga(\"send\", {\n        hitType: \"event\",\n        eventCategory: \"selection\",\n        eventAction: text,\n      });\n    }, 2000);\n  },\n  true\n);\n\nif (window.ResizeObserver &&\n    document.querySelector(\"header nav #nav\") &&\n    document.querySelector('#post-page') // only show it on post page\n) {\n\n  var progress = document.getElementById(\"reading-progress\");\n\n  var timeOfLastScroll = 0;\n  var requestedAniFrame = false;\n  function scroll() {\n    if (!requestedAniFrame) {\n      requestAnimationFrame(updateProgress);\n      requestedAniFrame = true;\n    }\n    timeOfLastScroll = Date.now();\n  }\n  addEventListener(\"scroll\", scroll);\n\n  var winHeight = 1000;\n  var bottom = 10000;\n  function updateProgress() {\n    requestedAniFrame = false;\n    var percent = Math.min(\n      (document.scrollingElement.scrollTop / (bottom - winHeight)) * 100,\n      100\n    );\n    progress.style.transform = `translate(-${100 - percent}vw, 0)`;\n    if (Date.now() - timeOfLastScroll < 3000) {\n      requestAnimationFrame(updateProgress);\n      requestedAniFrame = true;\n    }\n  }\n\n  new ResizeObserver(() => {\n    bottom =\n      document.scrollingElement.scrollTop +\n      document.querySelector(\"#comments,footer\").getBoundingClientRect().top;\n    winHeight = window.innerHeight;\n    scroll();\n  }).observe(document.body);\n}\n\nfunction expose(name, fn) {\n  exposed[name] = fn;\n}\n\naddEventListener(\"click\", (e) => {\n  const handler = e.target.closest(\"[on-click]\");\n  if (!handler) {\n    return;\n  }\n  e.preventDefault();\n  const name = handler.getAttribute(\"on-click\");\n  const fn = exposed[name];\n  if (!fn) {\n    throw new Error(\"Unknown handler\" + name);\n  }\n  fn(handler);\n});\n\nfunction removeBlurredImage(img) {\n  // Ensure the browser doesn't try to draw the placeholder when the real image is present.\n  img.style.backgroundImage = \"none\";\n}\n\n// There is a race condition here if an image loads faster than this JS file. But\n// - that is unlikely\n// - it only means potentially more costly layouts for that image.\n// - And so it isn't worth the querySelectorAll it would cost to synchronously check\n//   load state.\ndocument.body.addEventListener(\n  \"load\",\n  (e) => {\n    if (e.target.tagName != \"IMG\") {\n      return;\n    }\n    removeBlurredImage(e.target);\n  },\n  /* capture */ \"true\"\n);\n\nfor (let img of document.querySelectorAll(\"img\")) {\n  if (img.complete) {\n    removeBlurredImage(img);\n  }\n}\n"],"names":["exposed","location","search","a","document","createElement","href","setTimeout","history","replaceState","tweet_","url","open","encodeURIComponent","prefetch","e","target","tagName","origin","removeUrlFragment","split","window","l","rel","head","appendChild","expose","anchor","getAttribute","msg","dialog","event","preventDefault","navigator","share","clipboard","writeText","getElementById","textContent","setAttribute","removeAttribute","documentElement","addEventListener","capture","passive","GA_ID","ga","q","push","arguments","Date","timeout","onload","clearTimeout","ref","ping","now","hitType","eventCategory","eventAction","type","eventLabel","Math","round","sendWebVitals","currentScript","src","selectionTimeout","test","Promise","resolve","script","then","webVitals","getCLS","sendToGoogleAnalytics","getFID","getLCP","catch","error","console","button","closest","text","String","getSelection","trim","length","ResizeObserver","querySelector","progress","timeOfLastScroll","requestedAniFrame","scroll","requestAnimationFrame","updateProgress","winHeight","bottom","percent","min","scrollingElement","scrollTop","style","transform","getBoundingClientRect","top","innerHeight","observe","body","name","fn","removeBlurredImage","img","backgroundImage","handler","Error","querySelectorAll","complete"],"mappings":"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"}