<!DOCTYPE html><html domain="tech-blog.cymetrics.io" ga-id="G-3VBVCXV9Z0" lang="zh-TW"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="CYBER,Cymetrics,Security" name="keywords"><link href="/favicon.svg" rel="icon" type="image/svg+xml"><meta content="#5789d3" name="theme-color"><title>é—œæ–¼ email security çš„å¤§å°äº‹â€Šâ€”â€Šè¨­å®šç¯‡ SPF</title><meta content="é—œæ–¼ email security çš„å¤§å°äº‹â€Šâ€”â€Šè¨­å®šç¯‡ SPF" property="og:title"><meta content="é—œæ–¼ email security çš„å¤§å°äº‹â€Šâ€”â€Šè¨­å®šç¯‡ SPF" name="twitter:title"><meta content="summary" name="twitter:card"><meta content="ä¸Šä¸€æ¬¡æˆ‘å€‘æ·±å…¥ç­è§£äº† email security çš„åŸç†èˆ‡æ‡‰ç”¨å ´æ™¯ï¼Œé€™æ¬¡ä¾†çœ‹çœ‹ SPFã€DKIMã€DMARC è©²å¦‚ä½•è¨­ç½®å§ï¼" name="description"><meta content="ä¸Šä¸€æ¬¡æˆ‘å€‘æ·±å…¥ç­è§£äº† email security çš„åŸç†èˆ‡æ‡‰ç”¨å ´æ™¯ï¼Œé€™æ¬¡ä¾†çœ‹çœ‹ SPFã€DKIMã€DMARC è©²å¦‚ä½•è¨­ç½®å§ï¼" name="twitter:description"><meta content="ä¸Šä¸€æ¬¡æˆ‘å€‘æ·±å…¥ç­è§£äº† email security çš„åŸç†èˆ‡æ‡‰ç”¨å ´æ™¯ï¼Œé€™æ¬¡ä¾†çœ‹çœ‹ SPFã€DKIMã€DMARC è©²å¦‚ä½•è¨­ç½®å§ï¼" property="og:description"><meta content="article" property="og:type"><meta content="https://tech-blog.cymetrics.io/posts/crystal/email-sec-settings-spf/" property="og:url"><meta content="Cymetrics Tech Blog" property="og:site_name"><meta content="https://tech-blog.cymetrics.io/img/posts/crystal/email-sec-settings-spf/cover.jpg" property="og:image"><meta content="https://tech-blog.cymetrics.io/img/posts/crystal/email-sec-settings-spf/cover.jpg" name="twitter:image"><meta content="hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk" name="google-site-verification"><link href="https://tech-blog.cymetrics.io/posts/crystal/email-sec-settings-spf/" rel="canonical"><meta content="always" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Cymetrics Tech Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=7f26b2ece8" defer=""></script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}body,figure{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}h2,h5{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}h3{font-size:2em;line-height:1.125;margin-bottom:.75em;font-size:1.4rem;line-height:1.5rem;margin-bottom:1rem}h5{line-height:1.5em;font-size:1.25em;margin-bottom:1.2em;font-size:1rem;line-height:1.6rem}body,ol,p,pre,ul{font-size:1em}ol,p,pre,ul{margin-bottom:1.5em}body,ol,p,pre,ul{font-size:1rem;line-height:1.6}ol,p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}h3{font-size:1.7989rem;line-height:2rem}h5{line-height:1.56rem;margin-bottom:1.296rem;font-size:1.1rem}body,ol,p,pre,ul{font-size:1.1rem;line-height:1.6}h2,h3,ol,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:2.05rem}h3{font-size:1.5rem}h5{line-height:1.42rem;margin-bottom:1.2rem;font-size:1.2rem}body,ol,p,pre,ul{font-size:1.2rem;line-height:1.6}h2,h3,ol,p,pre,ul{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){overflow-x:scroll}button,code{border-radius:.3em}code{color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}mark{background:#f9c412;padding:0 .3em;background:var(--primary)}h1,h2,h3,h5{font-family:var(--font-family)}a:hover{text-decoration:underline}figcaption{color:#757575;margin-top:.75em;text-align:center}figcaption>p{margin:0;font-size:90%}@media (max-width:767px){x:-moz-any-link{display:table-cell}}button{max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button+label,label+*{page-break-before:always}button,label{display:inline-block}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}figure img,header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ol,ul{margin-top:0}header nav .nav-title{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ol,li ul{margin-bottom:0}blockquote{padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:4px solid var(--primary)}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.w-full{width:100%}body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}@media (prefers-color-scheme:dark){body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}.post,footer{border-top:1px solid #ccc}.post{padding-top:35px;margin-top:35px}.menu__btn{display:inline-block;width:24px;height:24px;position:relative}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav,#nav .nav-title{display:flex;align-items:center}#nav{position:relative;height:68px;z-index:2}#nav .nav-title{padding:.375rem 1.5rem;width:100%;justify-content:space-between}#nav .nav-title *,.article-footer img{margin:0}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}.nav-logo{width:260px;height:40px;background:url(/img/logo1.png) no-repeat center center;background-size:contain}footer{margin-top:48px;font-size:14px;padding:24px;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.direct-link{display:none}.post-avatar{margin-top:27px;display:flex;align-items:center;height:36px}.post-avatar__img{width:36px;height:36px;overflow:hidden;margin:0;border-radius:50%}.post-avatar__time{font-size:13px}.post-avatar__info{margin-left:8px;color:#747474;text-align:left}.post-avatar__author{font-size:14px;font-weight:700}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}.article-author{margin-top:34px;display:flex;align-items:flex-start;margin-bottom:48px}.article-author__img{width:80px;height:80px;overflow:hidden;margin:0;border-radius:50%;flex-shrink:0}.article-author__info{margin-left:16px;text-align:left}.article-author__title{color:#747474;font-size:16px}.article-author__author{font-size:22px;font-weight:700;line-height:1em}.article-author__intro{color:#2f2f2f;margin-top:8px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav-logo{width:313px}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id="nav"><div class="nav-title"><a href="/" class="nav-logo" title="Homepage"></a> <label class="menu__btn" for="menu__control"><span>Menu</span></label></div><div class="nav__links"><a href="/archive/">Archive</a> <a href="/tags/">Tags</a> <a href="/about/">About</a> <a href="/en">English</a></div></div><div id="reading-progress" aria-hidden="true"></div></nav><h1 class="w-full">é—œæ–¼ email security çš„å¤§å°äº‹â€Šâ€”â€Šè¨­å®šç¯‡ SPF</h1><aside class="w-full"><div class="post-tags"><a href="/tags/security/" class="post-tag">#Security</a> <a href="/tags/email-security/" class="post-tag">#Email Security</a></div><div class="post-avatar"><img src="/img/authors/crystal_logo.png" alt="crystal" class="post-avatar__img" data-deopt="true"><div class="post-avatar__info"><div class="post-avatar__author"><a href="/posts/crystal">crystal</a></div><div class="post-avatar__time">14 Jul 2021</div></div></div></aside><dialog id="message"></dialog></header><main><article><div id="post-page"></div><p>ä¸Šä¸€æ¬¡æˆ‘å€‘æ·±å…¥ç­è§£äº† email security çš„åŸç†èˆ‡æ‡‰ç”¨å ´æ™¯ï¼Œé€™æ¬¡ä¾†çœ‹çœ‹ SPFã€DKIMã€DMARC è©²å¦‚ä½•è¨­ç½®å§ï¼</p><p>è«‹æ³¨æ„ï¼Œé€™è£¡çš„ã€è¨­å®šã€ä¸¦ä¸æ˜¯å›ç­”ä½ ã€å¦‚ä½•åœ¨ google æˆ–æ˜¯ Office365 è¨­å¥½é€™äº›ç´€éŒ„ã€ã€ã€ç”¨ XX æœå‹™çµæœä¿¡å¯„ä¸åˆ°æ€éº¼è¾¦ã€ï¼Œé€™ç¨®æ“ä½œé…ç½®çš„æ•™å­¸æ–‡è«‹åƒè€ƒå®˜æ–¹æ–‡ä»¶ï¼Œç•¢ç«Ÿ email provider åƒåƒç™¾ç™¾å®¶ï¼Œå„è‡ªå¯èƒ½æœ‰çš„å•é¡Œæ›´æ˜¯é›£ä»¥å½™æ•´ã€‚</p><p>æˆ‘æƒ³å‘Šè¨´ä½ çš„ã€è¨­å®šã€æ˜¯ SPFã€DMARC çš„ DNS ç´€éŒ„æœ¬èº«æœ‰å“ªäº›æ¨™ç±¤ï¼Œä»¥åŠè¨­ç½®é€™äº›é¸é …æ™‚å¯èƒ½ä¸å°å¿ƒè¸©åˆ°å“ªäº›åœ°é›·ï¼Œå°è‡´æ”¶ä¿¡æ–¹çš„ email server åœ¨é©—è­‰ä½ çš„éƒµä»¶æ™‚å‡ºç¾éé æœŸåœ°å ±éŒ¯ï¼Œè€Œåˆ¤æ–·é©—è­‰å¤±æ•—ã€‚å¦å¤–ï¼Œä¹Ÿæœƒå‘Šè¨´ä½ å¦‚æœæœ‰å¤šå€‹å­ç¶²åŸŸï¼Œæˆ–æœ‰ä½¿ç”¨ç¬¬ä¸‰æ–¹å¯„ä¿¡æœå‹™æ™‚è©²æ€éº¼è¾¦ã€‚</p><p>ç¸½ä¹‹ï¼Œå¯ä»¥æƒ³æˆæ˜¯å›ç­”ä½ ã€æˆ‘è©²æ€éº¼ç†è§£é€™äº›ç´€éŒ„ã€å’Œã€æ¯å€‹æ©Ÿåˆ¶æœ‰å“ªäº›é¸é …è·Ÿé™åˆ¶ã€ï¼Œè€Œä¸æ˜¯é‡å°å–®ä¸€ email provider çš„æ•™å­¸æ–‡ã€‚</p><p>å¦‚æœä½ é‚„ä¸å¤ªæ‡‚ SPFã€DKIMã€DMARC æ˜¯ä»€éº¼ï¼Œæˆ–æ˜¯ä¸æ¸…æ¥šéƒµä»¶å‚³ééç¨‹ä¸­çš„å„å€‹è§’è‰²èˆ‡è·è²¬ï¼ˆMDAã€MTAâ‹¯â‹¯å€‘ï¼‰ï¼Œæˆ–æ˜¯æƒ³äº†è§£æ›´å¤šç¯„ä¾‹èˆ‡å»¶ä¼¸è­°é¡Œï¼Œè«‹çœ‹æœ¬ç³»åˆ—å…¶ä»–ç¯‡ï¼š</p><p>æœ‰ä¸æ‡‚æˆ–æ˜¯æƒ³äº†è§£æ›´å¤šç¯„ä¾‹èˆ‡å»¶ä¼¸è­°é¡Œï¼Œè«‹çœ‹æœ¬ç³»åˆ—å…¶ä»–ç¯‡ï½<br>å¦‚æœä½ é‚„ä¸å¤ªæ‡‚ SPFã€DKIMã€DMARC ğŸ‘‰ <a href="https://tech-blog.cymetrics.io/posts/crystal/email-sec-theory">é—œæ–¼ email security çš„å¤§å°äº‹â€Šâ€”â€ŠåŸç†ç¯‡</a><br>å¦‚æœä½ åœ¨æ‰¾ DKIMã€DMARC çš„è¨­å®š ğŸ‘‰ <a href="https://tech-blog.cymetrics.io/posts/crystal/email-sec-settings-dkimdmarc">é—œæ–¼ email security çš„å¤§å°äº‹â€Šâ€”â€Šè¨­å®šç¯‡ DKIMã€DMARC</a><br>å¦‚æœä½ æƒ³æ­é…è¨­å®šç¯„ä¾‹ ğŸ‘‰ <a href="https://tech-blog.cymetrics.io/posts/crystal/email-sec-examples">é—œæ–¼ email security çš„å¤§å°äº‹â€Šâ€”â€Šç¯„ä¾‹ç¯‡</a><br>å¦‚æœä½ æƒ³äº†è§£å»¶ä¼¸è­°é¡Œ ğŸ‘‰ <a href="https://tech-blog.cymetrics.io/posts/crystal/email-sec-extra">é—œæ–¼ email security çš„å¤§å°äº‹ â€” å»¶ä¼¸ç¯‡</a></p><h2 id="spf"><a href="#spf" class="direct-link">#</a> SPF</h2><p>å…ˆä¾†çœ‹çœ‹ SPFã€‚SPF ç´€éŒ„çš„èªæ³•èªªè¤‡é›œä¸è¤‡é›œï¼Œä½†å„ç¨®å°ç´°ç¯€å¸¸å¸¸è®“äººé ­ç–¼ï¼Œä¸€å€‹å¾ˆå®Œæ•´çš„èªæ³•ä»‹ç´¹å¯ä»¥åƒè€ƒ <a href="https://dmarcian.com/spf-syntax-table" rel="noopener noreferrer" target="_blank">Dmarcian-SPF record syntax</a>ã€‚</p><p>å¦‚æœæƒ³é…è‘—çœŸå¯¦çš„ä¿¡ä»¶çœ‹ï¼Œå»ºè­°ä½ å¯ä»¥ç”¨ <a href="https://mxtoolbox.com/SuperTool.aspx" rel="noopener noreferrer" target="_blank">mxtoolbox</a> ä¹‹é¡çš„å·¥å…·ä¸€é‚ŠæŸ¥è©¢ SPF ç´€éŒ„ï¼Œä¸€é‚Šé»é–‹ä¿¡ä»¶åŸå§‹å…§å®¹çœ‹ SPF é©—è­‰çµæœï¼š</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/crystal/email-sec-settings-spf/spf-result-1920w.webp 1920w, /img/posts/crystal/email-sec-settings-spf/spf-result-1280w.webp 1280w, /img/posts/crystal/email-sec-settings-spf/spf-result-840w.webp 840w, /img/posts/crystal/email-sec-settings-spf/spf-result-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/crystal/email-sec-settings-spf/spf-result-1920w.png 1920w, /img/posts/crystal/email-sec-settings-spf/spf-result-1280w.png 1280w, /img/posts/crystal/email-sec-settings-spf/spf-result-840w.png 840w, /img/posts/crystal/email-sec-settings-spf/spf-result-320w.png 320w" type="image/png"><img src="/img/posts/crystal/email-sec-settings-spf/spf-result-1920w.png" alt="" height="120" width="800" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 800 120'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAm0lEQVQI11VNvQqDMBj0rV3d3DLnFdLZPRXc7BioYCGVJl8MiQ7+FKwm7Qdd2huOu4O7S6y1WmswgHxirCiKvu8xBNDGGO892n3f53lelqUsyzRNsyxrmutxHIlz7ta2AKDUg1LKGMOaUqrr7pijEEIQQqqqijG+/5GM46hBD4O/1HWe57h65vy5rvj22rYQwjRNnHMpZfzBt/wBsfybyzMDpz4AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>é€™è£¡æˆ‘å€‘å…ˆè¬›ä¸€ä¸‹ SPF é©—è­‰æ™‚æœƒå‡ºç¾çš„å¹¾ç¨®çµæœï¼š</p><ul><li><code>Pass</code>ï¼šIP æ–¼åˆ—è¡¨ä¸­ï¼Œé©—è­‰æˆåŠŸã€‚æ¡å–è¡Œç‚ºæ˜¯ï¼šaccept</li><li><code>Fail</code>ï¼šIP ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œé©—è­‰å¤±æ•—ã€‚æ¡å–è¡Œç‚ºæ˜¯ï¼šreject</li><li><code>SoftFail</code>ï¼šIP ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œé©—è­‰å¤±æ•—ï¼Œä½†ä¸è¦ç›´æ¥ rejectã€‚æ¡å–è¡Œç‚ºæ˜¯ï¼šaccept but markï¼ˆæ¨™æ³¨å¤±æ•—ï¼‰</li><li><code>Neutral</code>ï¼šä¸äºˆç½®è©•ï¼Œå³ä½¿ IP ä¸åœ¨åˆ—è¡¨ä¸­ä¹Ÿä¸è¦–ç‚ºå¤±æ•—ï¼Œè¦–åŒ <code>None</code>ã€‚æ¡å–è¡Œç‚ºæ˜¯ï¼šaccept</li><li><code>None</code>ï¼šæ²’æœ‰è¶³å¤ è³‡è¨Šå¾—å‡ºçµè«–ï¼ˆä¾‹å¦‚æœªæ‰¾åˆ° SPF ç´€éŒ„ï¼‰ã€‚æ¡å–è¡Œç‚ºæ˜¯ï¼šaccept</li><li><code>PermError</code>ï¼šé©—è­‰éç¨‹å‡ºéŒ¯ï¼Œä¾‹å¦‚æ ¼å¼éŒ¯èª¤çš„ SPF ç´€éŒ„ã€‚æ¡å–è¡Œç‚ºæ˜¯ï¼šunspecifiedï¼ˆæœªå®šç¾©ï¼‰ï¼Œäº¤ç”±æ”¶ä¿¡æ–¹ email server è‡ªè¡Œæ±ºå®šã€‚</li><li><code>TempError</code>ï¼šé©—è­‰éç¨‹å‡ºéŒ¯ï¼Œä½†æ²’æœ‰ PermError åš´é‡ã€‚æ¡å–è¡Œç‚ºå¯èƒ½æ˜¯ accept æˆ–æš«æ™‚ rejectï¼Œç”±æ”¶ä¿¡æ–¹ email server è‡ªè¡Œæ±ºå®šã€‚</li></ul><p>SPF çš„å°åœ°é›·å°±åœ¨æ–¼ï¼Œå¾ˆå¤šç¨®è¨­ç½®ä¸Šçš„å°å¤±èª¤å¯èƒ½å°è‡´ PermErrorã€TempErrorã€æˆ–æ˜¯å…¶ä»–å‰Šå¼± SPF å®‰å…¨æ€§çš„çµæœã€‚å› ç‚ºæˆ‘å€‘ç„¡æ³•é æœŸæ”¶ä¿¡æ–¹ email server æœƒæ¡å–ä»€éº¼è¡Œç‚ºï¼Œæ‰€ä»¥ä¹Ÿç„¡æ³•ç¢ºä¿é€åˆ°æ”¶ä»¶äººæ‰‹ä¸Šçš„ä¿¡ä»¶éƒ½æœ‰å—åˆ° SPF ç´€éŒ„çš„ä¿è­·ã€‚è¦æ˜¯å°æ–¹é‡åˆ° Error ä¸€å¾‹æ¡å– acceptï¼Œæˆ–æ˜¯ä¹¾è„†é¸æ“‡å¿½ç•¥é€™ç­† SPF ç´€éŒ„ï¼Œé‚£ä¸å°±å½¢åŒè™›è¨­äº†å—ï¼Ÿ</p><p>ä¸‹é¢æˆ‘å€‘çœ‹çœ‹ SPF ç´€éŒ„ä¸­çš„æ¨™ç±¤ï¼š 8 å€‹æ©Ÿåˆ¶ï¼ˆmechanismï¼‰è·Ÿ 2 ç¨®ä¿®é£¾ï¼ˆmodifierï¼‰ï¼Œä»¥åŠä»–å€‘å¯èƒ½è¸©åˆ°åœ°é›·çš„æƒ…å½¢ã€‚æ‰€æœ‰çš„æ¨™ç±¤ï¼ˆtagï¼‰èˆ‡æ¨™ç±¤å€¼ï¼ˆtag valueï¼‰ä¸­é–“éƒ½ä¸èƒ½æœ‰ç©ºç™½ã€‚æ­¤å¤–ï¼Œè‡³å°‘åœ¨å‡ºç¾æ›´æ–°ç‰ˆæœ¬çš„ SPF specä¹‹å‰ï¼Œç¾éšæ®µ SPF ç´€éŒ„é–‹é ­å¿…é ˆæ˜¯ <code>v=spf1</code>ã€‚</p><p></p><figure><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/crystal/email-sec-theory/spf-1920w.webp 1920w, /img/posts/crystal/email-sec-theory/spf-1280w.webp 1280w, /img/posts/crystal/email-sec-theory/spf-840w.webp 840w, /img/posts/crystal/email-sec-theory/spf-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/crystal/email-sec-theory/spf-1920w.png 1920w, /img/posts/crystal/email-sec-theory/spf-1280w.png 1280w, /img/posts/crystal/email-sec-theory/spf-840w.png 840w, /img/posts/crystal/email-sec-theory/spf-320w.png 320w" type="image/png"><img src="/img/posts/crystal/email-sec-theory/spf-1920w.png" height="52" width="800" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 800 52'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAACCAIAAADARvsVAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAi0lEQVQI1xWOyxaCMAxE+f/fExBbWvqkSVMQForuHM/JIpm5k6QLMS3O98PYtp256tnElGdjC3FKmbiilJ7zWtZCzgfw431CD6xKgyVtM9YC2PfjeZzIwn29r46IjV1u/QAV9PRQaykhRqzGFgS4il0caIwgIeGV/2F4xM77KgKdmEU2/Ke0RuT6fH/5yqDPHn09OQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture><figcaption><p>ç°¡çŸ­çš„ SPF recordï¼ˆå–è‡ª ç¶­åŸºç™¾ç§‘ï¼‰</p></figcaption></figure><p></p><p>ä»¥ä¸‹æˆ‘å€‘ç¨±ä¿¡ä»¶çš„ä¾†æºï¼ˆä¹Ÿå°±æ˜¯ <code>smtp.MailFrom</code>ï¼‰ç‚º sender-domain æˆ– sender-ipï¼Œæ¨™ç±¤å€¼ç‚º target-domain æˆ– target-ipã€‚</p><h3 id="mechanisms"><a href="#mechanisms" class="direct-link">#</a> Mechanisms</h3><p>8 å€‹ mechanism ç‚ºï¼š <code>all, ip4, ip6, a, mx, ptr, exists, include</code></p><p>SPF ç´€éŒ„é©—è­‰æ™‚æ˜¯ç…§è‘— mechanism å‡ºç¾çš„é †åºæ¯”å°çš„ï¼Œæ¯”å°çµæœç‚º matchã€ not-matchã€æˆ– error ä¹‹ä¸€ï¼Œä¸€æ—¦æˆåŠŸæ‰¾åˆ° match æˆ–æ˜¯ç™¼ç”Ÿ error å°±æœƒåœä¸‹ã€‚</p><p>åœ¨æ¯å€‹ mechanism å‰éƒ½å¯èƒ½å¸¶æœ‰ä¸€å€‹ qualifier ç¬¦è™Ÿï¼Œç‚ºä¸‹åˆ—å…¶ä¸€ï¼š</p><ul><li><code>pass(+)</code>ï¼šè‹¥å°åˆ° sender-ipï¼Œçµæœ passï¼ˆå³ç™½åå–®ï¼‰ã€‚é è¨­å€¼ï¼Œå¯ä»¥çœç•¥ï¼ˆ <code>+all</code> åŒ <code>all</code>ï¼‰</li><li><code>neutral(?)</code>ï¼šNone ï¼Œç­‰åŒæ²’æœ‰ policyã€‚</li><li><code>softfail(~)</code>ï¼šè‹¥å°åˆ° sender-ipï¼Œçµæœ failï¼Œä»è¦æ¨™æ³¨ä¸¦æ¥å—ã€‚</li><li><code>fail(-)</code>ï¼šè‹¥å°åˆ° sender-ipï¼Œçµæœ failï¼ˆå³é»‘åå–®ï¼‰ã€‚</li></ul><h5 id="all"><a href="#all" class="direct-link">#</a> all</h5><p>èªæ³•ç‚ºï¼š <code>[qualifier]all</code></p><p>å¿…é ˆåœ¨ç´€éŒ„æœ€æœ«ï¼Œæ˜¯æœ€å¾Œä¸€å€‹åˆ¤æ–·æ¢ä»¶ã€‚ä¸€èˆ¬ä¾†èªªæ‡‰è¨­ç½®æœ€åš´è¬¹çš„ <code>-all</code>ï¼Œè¡¨ç¤ºé™¤äº†å‰è¿° mechanism æŒ‡å®šçš„ target IP å¤–ä¸€å¾‹æ‹’çµ•ï¼ˆ<code>fail(-)</code>ï¼‰ï¼Œæ‰€ä»¥å¦‚æœå‰é¢çš„ mechanism éƒ½æ²’å°åˆ°ï¼Œæœ€å¾Œå°±æœƒå¤±æ•—ã€‚</p><p>åœ°é›·ï¼š</p><ul><li>ç¼ºå°‘ <code>all</code>ï¼š<code>PermError</code></li><li><code>all</code> å¾Œé¢çš„ä»»ä½•æ¨™ç±¤å‡æœƒè¢«å¿½ç•¥</li><li><code>?all, +all</code>ï¼šä¸ç®¡å‰é¢æœ‰æ²’æœ‰å°åˆ°ï¼Œéƒ½è¦–ç‚º passã€‚SPF è·Ÿæ²’è¨­ä¸€æ¨£ã€‚</li></ul><h5 id="ip4%2C-ip6"><a href="#ip4%2C-ip6" class="direct-link">#</a> ip4, ip6</h5><p>èªæ³•ç‚ºï¼š<code>[qualifier]ip4:target-ip[cidr-length]</code> æˆ– <code>[qualifier]ip6:target-ip[cidr-length]</code></p><p>åˆ†åˆ¥ç”¨ ipv4 èˆ‡ ipv6 å®šç¾©çš„ IP åˆ—è¡¨ï¼Œåªè¦æ˜¯ CIDR è¡¨ç¤ºæ³•éƒ½å¯ä»¥ï¼Œä¾‹å¦‚ <code>192.168.0.1/16</code>ã€‚æ–œç·šå¾Œçš„ prefix length å¦‚æœçœç•¥ï¼Œæœƒé è¨­ç‚º <code>/32</code>ï¼ˆipv4ï¼‰èˆ‡ <code>/128</code>ï¼ˆipv6ï¼‰ã€‚</p><p>åœ°é›·ï¼š</p><ul><li>ä¸åˆæ³•çš„ IPï¼š<code>PermError</code></li></ul><h5 id="a"><a href="#a" class="direct-link">#</a> a</h5><p>èªæ³•ç‚ºï¼š<code>[qualifier]a:[target-domain][cidr-length]</code></p><p>æª¢æŸ¥ sender IP æ˜¯å¦åœ¨ target-domain çš„ A æˆ– AAAA ç´€éŒ„ä¸­ï¼Œå³æ˜¯å¦ç‚º target-domain æ‰€æ“æœ‰çš„ IPã€‚å¦‚æœæ²’æœ‰å¯« target-domain å°±æœƒé»˜èªç‚ºç•¶å‰ SPF ç´€éŒ„çš„ç¶²åŸŸï¼Œ <code>a</code> ç­‰åŒ <code>a:sender-domain</code>ã€‚</p><h5 id="mx"><a href="#mx" class="direct-link">#</a> mx</h5><p>èªæ³•ç‚ºï¼š<code>[qualifier]mx:[target-domain][cidr-length]</code></p><p>æª¢æŸ¥ sender IP æ˜¯å¦åœ¨ target-domain çš„ MX ç´€éŒ„ä¸­ã€‚å¦‚æœæ²’æœ‰å¯« target-domain å°±æœƒé»˜èªç‚ºç•¶å‰ SPF ç´€éŒ„çš„ç¶²åŸŸï¼Œ <code>mx</code> ç­‰åŒ <code>mx:sender-domain</code>ã€‚</p><p>åœ°é›·ï¼š</p><ul><li>è‹¥ä¸€å€‹ MX ç´€éŒ„åŒ…å«è¶…é 10 å€‹ A æˆ– AAAA ç´€éŒ„ï¼š<code>PermError</code></li></ul><h5 id="ptr-%EF%BC%88%E5%B7%B2%E5%BB%A2%E6%A3%84%EF%BC%89"><a href="#ptr-%EF%BC%88%E5%B7%B2%E5%BB%A2%E6%A3%84%EF%BC%89" class="direct-link">#</a> ptr ï¼ˆå·²å»¢æ£„ï¼‰</h5><p>èªæ³•ç‚ºï¼š<code>[qualifier]ptr:[target-domain]</code></p><p>é€²è¡Œ reverse DNS lookupï¼Œè‹¥å¾—åˆ°çš„ç¶²åŸŸæ˜¯ <code>smtp.MailFrom</code> æˆ–å…¶å­ç¶²åŸŸï¼Œå‰‡ passã€‚æ­¤æ©Ÿåˆ¶é€Ÿåº¦æ…¢ä¸”æœƒÂ .arpa name servers çš„è² æ“”ï¼Œè«‹å‹¿ä½¿ç”¨ã€‚</p><p>åœ°é›·ï¼š</p><ul><li>è‹¥ä¸€å€‹ PTR ç´€éŒ„åŒ…å«è¶…é 10 å€‹ A æˆ– AAAA ç´€éŒ„ï¼Œåªçœ‹å‰åå€‹å¾Œé¢å¿½ç•¥</li></ul><h5 id="exists"><a href="#exists" class="direct-link">#</a> exists</h5><p>èªæ³•ç‚ºï¼š<code>[qualifier]exists:target-domain</code></p><p>è‹¥ target-domain å­˜åœ¨ A ç´€éŒ„ï¼Œè¦–ç‚º passã€‚</p><h5 id="include"><a href="#include" class="direct-link">#</a> include</h5><p>èªæ³•ç‚ºï¼š<code>[qualifier]include:target-domain</code></p><p>è·Ÿå¯«ç¨‹å¼å‘¼å«å¦ä¸€å€‹å‡½æ•¸çš„æ¦‚å¿µé¡ä¼¼ï¼Œæœƒæª¢æŸ¥ target-domain çš„ SPF ç´€éŒ„ä¸¦ä¸”ä¸€ç›´éè¿´æŸ¥è©¢ä¸‹å»ï¼Œç›´åˆ°æ¯”å°éæ¯ä¸€å€‹ IPã€‚ä½† include ä¸ä»£è¡¨æŠŠå°æ–¹çš„ SPF ç´€éŒ„ inline æ’å…¥è‡ªå·±çš„ï¼Œè€Œæ˜¯è·³åˆ°å°æ–¹çš„ SPF ç´€éŒ„çš„ context ä¸­æ¯”å°ï¼Œæœ€å¾Œå¾—åˆ° matchã€ not-matchã€æˆ– error çš„çµæœã€‚</p><p>åœ¨éè¿´éç¨‹ä¸­ï¼Œå­ç´€éŒ„çš„é©—è­‰çµæœå°æ¯ç´€éŒ„çš„ include æ©Ÿåˆ¶çš„å½±éŸ¿ç‚ºï¼š</p><ul><li><code>Pass</code>â†’ include åˆ¤å®šï¼šmatch</li><li><code>Fail, Softfail, Neutral</code>â†’ include åˆ¤å®šï¼šnot-match</li><li><code>PermError, None</code>â†’ include åˆ¤å®šï¼š<code>PermError</code></li><li><code>TempError</code>â†’ include åˆ¤å®šï¼š<code>TempError</code></li></ul><p>include æ©Ÿåˆ¶é©åˆç”¨åœ¨æ ¸å‡†å¤–éƒ¨ï¼ˆè·¨åŸŸï¼‰çš„ email providerï¼Œä¾‹å¦‚ç•¶æˆ‘å€‘ä½¿ç”¨ç¬¬ä¸‰æ–¹å¯„ä»¶æœå‹™æ™‚ï¼Œå°±è¦æŠŠå°æ–¹çš„ SPF ç´€éŒ„ç”¨ include æ©Ÿåˆ¶æ”¾åˆ°æˆ‘å€‘çš„SPF ç´€éŒ„ã€‚</p><h3 id="modifiers"><a href="#modifiers" class="direct-link">#</a> Modifiers</h3><p>2 ç¨®ä¿®é£¾ç‚ºï¼š <code>redirect, exp</code></p><h5 id="redirect"><a href="#redirect" class="direct-link">#</a> redirect</h5><p>èªæ³•ç‚ºï¼š<code>redirect:target-domain</code></p><p>å¿…é ˆåœ¨ç´€éŒ„æœ€æœ«ï¼Œèˆ‡ all ä¸å¯åŒæ™‚å‡ºç¾ã€‚è‹¥å‰é¢çš„ mechanism é©—è­‰å®Œç•¢ä½†éƒ½æ²’æœ‰æ‰¾åˆ° matchï¼Œå°±ç”¨ target-domain çš„ SPF ç´€éŒ„å–ä»£è‡ªå·±çš„ã€‚èˆ‡ include çš„æ¯å­é—œä¿‚ä¸åŒï¼Œé€™è£¡ç”¨ inline æ¦‚å¿µæ’å…¥ï¼Œæ‰€ä»¥ä»»ä½•å ±éŒ¯è¦–ç‚ºç•¶å‰ SPF ç´€éŒ„çš„ Errorã€‚</p><p>åœ°é›·ï¼š</p><ul><li>è‹¥ target-domain æ²’æœ‰ SPF ç´€éŒ„ï¼š<code>PermError</code></li><li><code>all</code> èˆ‡ <code>redirect</code> åªèƒ½å‡ºç¾ä¸€å€‹ï¼Œè‹¥ç´€éŒ„ä¸­å…©è€…åŒæ™‚å‡ºç¾å‰‡ <code>redirect</code> æœƒè¢«å¿½ç•¥</li></ul><h5 id="exp"><a href="#exp" class="direct-link">#</a> exp</h5><p>èªæ³•ç‚ºï¼š<code>exp:target-domain</code></p><p>ä»£è¡¨ explanationï¼Œè‹¥ SPF ç´€éŒ„é©—è­‰çµæœç‚º <code>Fail</code>ï¼Œæœƒè¿”å› target-domain çš„ TXT ç´€éŒ„å…§çš„å­—ä¸²ã€‚</p><p>åœ°é›·ï¼š</p><ul><li>è‹¥åœ¨ include çš„ target-domain çš„ SPF ç´€éŒ„ä¸­æ‰¾åˆ° expï¼Œæœƒå¿½ç•¥ï¼ˆæ¯å­é—œä¿‚ï¼‰ï¼›è‹¥åœ¨ redirect çš„ target-domain çš„ SPF ç´€éŒ„ä¸­æ‰¾åˆ° expï¼Œå‰‡æœƒå¿½ç•¥åŸç´€éŒ„çš„ expï¼ˆå–ä»£é—œä¿‚ï¼‰</li></ul><h3 id="%E5%85%B6%E4%BB%96%E5%9C%B0%E9%9B%B7%EF%BC%9A"><a href="#%E5%85%B6%E4%BB%96%E5%9C%B0%E9%9B%B7%EF%BC%9A" class="direct-link">#</a> å…¶ä»–åœ°é›·ï¼š</h3><ul><li>DNS å›å‚³ NXDOMAINï¼ˆæ²’æœ‰ <code>smtp.MailFrom</code> é€™å€‹ç¶²åŸŸï¼‰ï¼š<code>None</code></li><li>æ‰¾åˆ°è¤‡æ•¸ç­† SPF ç´€éŒ„ï¼š<code>PermError</code></li><li>SPF ç´€éŒ„é–‹é ­ä¸æ˜¯ <code>v=spf1</code>ï¼š<code>None</code></li><li>SPF ç´€éŒ„è¢«è¨­æˆ SPF é¡å‹è€Œä¸æ˜¯ TXT é¡å‹ï¼šSPF é¡å‹ä½œç‚º SPF æ©Ÿåˆ¶ç™¼å±•çš„éæ¸¡æœŸä½¿ç”¨ï¼Œç›®å‰å·²å»¢æ£„ï¼Œè™•ç†æ–¹å¼æœªå®šç¾©</li><li>ä»»ä½•èªæ³•éŒ¯èª¤ï¼Œä¾‹å¦‚ mechanism æˆ– modifier æ‹¼éŒ¯å­—ï¼Œæˆ–æ˜¯ä¸­é–“å¤šäº†ç©ºæ ¼ç­‰ï¼š<code>PermError</code></li><li>DNS æŸ¥è©¢ timeout ã€server failure ç­‰é™¤äº† success èˆ‡ nxdomain çš„çµæœï¼š<code>TempError</code></li><li>ç™¼ç”Ÿå¤§æ–¼å…©æ¬¡ void lookupï¼Œä¹Ÿå°±æ˜¯ DNS query å›å‚³ç©ºç™½çµæœï¼ˆsuccess èˆ‡ nxdomainï¼‰ï¼š<code>PermError</code></li><li>æ¶µæ‹¬é™¤äº† <code>all, ip4, ip6, exp</code>ä¹‹å¤–çš„æ‰€æœ‰æ¨™ç±¤ï¼Œä»¥åŠå¾€ä¸‹éè¿´æ™‚éœ€è¦çš„ DNS queryï¼Œç¸½è¨ˆè¶…é 10 æ¬¡ DNS lookupï¼š<code>PermError</code></li><li>è‹¥ redirect æˆ– include çš„ç¶²åŸŸæœ‰é‡è¤‡ï¼ˆä¾‹å¦‚ SPF ç´€éŒ„æœ‰ï¼š<code>include: a.com include:b.com</code> ä½†æ˜¯ <a href="http://a.com" rel="noopener noreferrer" target="_blank">a.com</a> çš„ SPF ç´€éŒ„å…§å·²ç¶“æœ‰ <code>include:b.com</code>ï¼‰æˆ–æ˜¯ loopï¼ˆa include b â†’ b include c â†’ c include aï¼‰çš„æƒ…æ³ï¼Œä¸æœƒå ±éŒ¯ï¼Œä½†å¾ˆå¯èƒ½æœƒå°è‡´è¶…é 10 æ¬¡ DNS lookup</li><li>è‹¥é©—è­‰ä¸€ç­† SPF ç´€éŒ„éœ€è¦è¶…é 20 ç§’ï¼š<code>TempError</code></li><li>æ¯å€‹ modifier åœ¨ SPF ç´€éŒ„åªèƒ½å„å‡ºç¾ä¸€æ¬¡ï¼Œè‹¥è¶…éï¼š<code>PermError</code></li></ul><h3 id="%E5%A4%9A%E5%80%8B%E5%AD%90%E7%B6%B2%E5%9F%9F"><a href="#%E5%A4%9A%E5%80%8B%E5%AD%90%E7%B6%B2%E5%9F%9F" class="direct-link">#</a> å¤šå€‹å­ç¶²åŸŸ</h3><p>å¦‚æœä½ æœ‰å¤šå€‹æœƒå¯„ä¿¡çš„ç¶²åŸŸï¼Œå°±è¦ç‚ºæ¯ä¸€å€‹åˆ†åˆ¥è¨­ç½® SPF ç´€éŒ„ã€‚å¦‚æœå®ƒå€‘æ˜¯å¾åŒä¸€å€‹ email server å¯„å‡ºå»çš„ï¼Œå¯ä»¥ç”¨ redirect çµ±ä¸€æŒ‡å‘ä¸€ç­†ç´€éŒ„ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚</p><p>ä¸å¯„ä¿¡çš„ç¶²åŸŸï¼ˆparked domainï¼‰è«‹è¨­ç½® <code>v=spf1 -all</code>ã€‚</p><h3 id="%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8B%99"><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8B%99" class="direct-link">#</a> ç¬¬ä¸‰æ–¹æœå‹™</h3><p>å¦‚æœä½ æœ‰ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å¯„ä»¶æœå‹™ï¼Œä¾‹å¦‚ SendGridï¼Œä½ å¯ä»¥åœ¨ SPF ç´€éŒ„ä¸­ç”¨ include æ©Ÿåˆ¶æŠŠç¬¬ä¸‰æ–¹çš„ email server æ¶µè“‹é€²ä¾†ï¼Œä¾‹å¦‚ OneDegree ä½¿ç”¨å¾®è»Ÿ Outlookã€MailChimpã€FreshDeskã€SendGrid ç­‰æœå‹™ï¼š</p><pre class="language-txt"><code class="language-txt">v=spf1 include:spf.protection.outlook.com include:servers.mcsv.net include:email.freshdesk.com -all</code></pre><p>çœ¼å°–çš„äººå¯èƒ½æœƒç™¼ç¾ï¼Œä¸Šé¢çš„ç´€éŒ„æ€éº¼å°‘äº† <code>include:sendgrid.net</code>ï¼Ÿ</p><p>å…¶å¯¦ï¼Œä½ å¦‚æœå»æŸ¥é€™å¹¾å€‹ç¬¬ä¸‰æ–¹æœå‹™çš„çš„ SPF ç´€éŒ„å°±æœƒç™¼ç¾ï¼ŒFreshDesk çš„ SPF ç´€éŒ„å°±å·²ç¶“æœ‰ <code>include:sendgrid.net</code> é€™ä¸€è¡Œï¼Œå› æ­¤æˆ‘å€‘å°±ä¸ç”¨åŠ å•¦ï¼é€™æ¨£ä¹Ÿå¯ä»¥çœä¸‹ä¸€ç­† DNS lookup çš„æ‰£æ‰“ï¼Œç•¢ç«Ÿ 10 æ¬¡ DNS lookup æ˜¯å¾ˆå®¹æ˜“è¶…éçš„ã€‚</p><p>é€™è£¡ä¹Ÿé †ä¾¿å›ç­”ä¸€å€‹éå¸¸å¸¸è¦‹çš„å•é¡Œï¼š</p><blockquote><p>ã€è¶…é 10 æ¬¡ DNS lookup æ€éº¼è¾¦ã€</p></blockquote><p>åªè¦ä½ å¤šç”¨å¹¾å€‹ç¬¬ä¸‰æ–¹å¯„ä»¶æœå‹™ï¼Œé¦¬ä¸Šå°±è¶…é 10 æ¬¡äº†ï¼Œç•¢ç«Ÿä½  include ä»–ç®—ä¸€æ¬¡ï¼Œä»–ç”¨åˆ°çš„ includeã€aã€mx ç­‰ç­‰ä¹Ÿé€šé€šç®—ä½ çš„ï¼é‚„ä¸å«ä½ è‡ªå·±çš„ä¸€äº› email server å‘¢ï¼</p><p>è§£æ±ºé€™å€‹å•é¡Œæœ‰å¹¾å€‹æ’‡æ­¥ï¼š</p><p>å¦‚æœä½ æœ‰ lookup åˆ°ä½ è‡ªå·±çš„ä¸€äº› email serverï¼Œå¯ä»¥è€ƒæ…®ç”¨ ip4 ip6 ç›´æ¥ inline æ’é€²ä¾†ï¼Œä¾‹å¦‚ï¼š</p><pre class="language-txt"><code class="language-txt">// before  <br>mydom.com -> include:sub1.mydom.com mx:sub2.mydom.com include:a.com  <br>sub1.mydom.com(SPF) -> ip4:192.x.x.3 ip4:172.x.x.x/16  <br>sub2.mydom.com(MX) -> 192.x.126.5<br><br>//after  <br>mydom.com -> ip4:192.x.x.3 ip4:172.x.x.x/16 ip4:192.x.126.5 include:a.com</code></pre><p>æˆ–è€…ï¼Œå¯ä»¥è€ƒæ…®æŠŠé€™å€‹å¯„ä¿¡çš„ domain æ‹†æˆå¹¾å€‹ä¸åŒåŠŸç”¨çš„ subdomain ç„¶å¾ŒæŠŠç¬¬ä¸‰æ–¹å¯„ä»¶æœå‹™ä¹Ÿä¾æ“šç”¨é€”ç“œåˆ†ä¸‹å»ï¼Œé€™æ¨£æ¯å€‹ domain éƒ½æœ‰è‡ªå·±çš„ 10 æ¬¡æ‰£æ‰“ã€‚ä¾‹å¦‚ï¼š</p><pre class="language-txt"><code class="language-txt">// before  <br>mydomain.com -> include:a.com include:b.com include:c.com <br><br>//after  <br>mydomain.com -> include:a.com   <br>customer.mydomain.com -> include:b.com   <br>partnership.mydomain.com -> include:c.com</code></pre><p>å¦‚æœä½ å¾ˆä¸å¹¸åœ°ç”¨åˆ°äº†ä¸€å€‹ç¬¬ä¸‰æ–¹æœå‹™ï¼Œä»–è‡ªå·±çš„ SPF ç´€éŒ„å°±è¦ç”¨åˆ°å¿« 10 æ¬¡ lookupï¼Œé‚£åªèƒ½èªªâ€¦.æ›ä¸€å€‹å§ï¼Ÿï¼ˆæˆ–æ˜¯è¯ç¹«å°æ–¹çœ‹çœ‹ä»–å€‘æœ‰ä»€éº¼å»ºè­°å•¦ï¼‰</p><h2 id="%E7%B5%90%E8%AB%96"><a href="#%E7%B5%90%E8%AB%96" class="direct-link">#</a> çµè«–</h2><p>æ­å–œå¤§å®¶ææ‡‚ä¸‰åŠå®¢è£¡æœ€é›£è¨­å®šçš„ SPF å•¦ï¼ä½ å¯ä»¥åœ¨ç¶²è·¯ä¸Šæ‰¾åˆ°çš„ SPF ç´€éŒ„æª¢æŸ¥å™¨é€šå¸¸ä¸æœƒæŠŠæˆ‘å€‘è¨è«–çš„åœ°é›·å…¨éƒ½æª¢æŸ¥ä¸€æ¬¡ï¼Œå› ç‚ºå¯¦åœ¨æ˜¯å¤ªéº»ç…©å•¦QQ æ¨è–¦ä½ å¯ä»¥å¤šç”¨å¹¾ç¨®å·¥å…·é…è‘—é€™ç¯‡ä»”ç´°æª¢è¦–ä¸€ä¸‹ä½ çš„ SPF ç´€éŒ„ï¼Œç„¶å¾Œè·Ÿè‘—ä¸‹ä¸€ç¯‡è¨­å¥½ DMARC å¾Œï¼Œå°±å¯ä»¥åœ¨æ¯æ—¥çš„å½™æ•´å ±å‘Šä¸­çœ‹åˆ° SPF é€šéè·Ÿå¤±æ•—çš„ç´€éŒ„å›‰ï¼</p><h3 id="reference%3A"><a href="#reference%3A" class="direct-link">#</a> Reference:</h3><ol><li><a href="https://datatracker.ietf.org/doc/html/rfc7208" rel="noopener noreferrer" target="_blank">SPF RFC</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc6376" rel="noopener noreferrer" target="_blank">DKIM RFC</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7489" rel="noopener noreferrer" target="_blank">DMARC RFC</a></li></ol><div class="article-footer"><a href="https://tech-blog.cymetrics.io/posts/crystal/email-sec-settings-spf/" on-click="share"><img src="/img/icons/icon_external link hyperlink.svg" alt="Share" height="24" width="24">Share this post</a></div><div><p style="font-weight: bold;">Tag</p><div class="post-tags"><a href="/tags/security/" class="post-tag">#Security</a> <a href="/tags/email-security/" class="post-tag">#Email Security</a></div><p style="font-weight: bold;">Recommendation</p><ol><li><a href="/posts/cymetrics/ecommerce-scam/">ç°¡å–®ä¸‰æ‹›å­¸æœƒè¾¨è­˜é›»å•†è©é¨™ï¼Œè®“ä½ åœ¨é›™11å®‰å¿ƒè³¼ç‰©</a></li><li><a href="/posts/huli/xss-history/">XSS å¾é ­è«‡èµ·ï¼šæ­·å²èˆ‡ç”±ä¾†</a></li><li><a href="/posts/crystal/oscp-review/">æˆ‘å€‘èˆ‡ OSCP çš„è·é›¢</a></li><li><a href="/posts/huli/learn-from-intigriti-xss-0721/">Intigriti ä¸ƒæœˆä»½ XSS æŒ‘æˆ°ï¼šçªç ´å±¤å±¤é—œå¡</a></li><li><a href="/posts/jo/zerobased-secure-samesite-httponly/">é›¶åŸºç¤è³‡å®‰ç³»åˆ—ï¼ˆä¸‰ï¼‰-ç¶²ç«™å®‰å…¨ä¸‰æœ¬æŸ±ï¼ˆSecure & SameSite & HttpOnlyï¼‰</a></li></ol></div><div class="article-author"><img src="/img/authors/crystal_logo.png" alt="crystal" class="article-author__img" data-deopt="true"><div class="article-author__info"><div class="article-author__title">Author</div><div class="article-author__author"><a href="/posts/crystal">crystal</a></div><div class="article-author__intro">Security newbie with a gallon of passion</div></div></div><p style="font-weight: bold;">Discussion(login required)</p><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" id="utterance-script" issue-term="title" label="utterance" repo="cymetrics/blog" theme="github-light"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"é—œæ–¼ email security çš„å¤§å°äº‹â€Šâ€”â€Šè¨­å®šç¯‡ SPF","image":["https://tech-blog.cymetrics.io/img/posts/crystal/email-sec-settings-spf/spf-result-1920w.png","https://tech-blog.cymetrics.io/img/posts/crystal/email-sec-theory/spf-1920w.png","https://tech-blog.cymetrics.io/img/icons/icon_external link hyperlink.svg","https://tech-blog.cymetrics.io/img/authors/crystal_logo.png"],"author":{"@type":"Person","name":"crystal"},"publisher":{"@type":"Organization","name":"Cymetrics Tech Blog","url":"https://tech-blog.cymetrics.io","logo":{"@type":"ImageObject","url":"https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png","width":512,"height":512}},"url":"https://tech-blog.cymetrics.io/posts/crystal/email-sec-settings-spf/","mainEntityOfPage":"https://tech-blog.cymetrics.io/posts/crystal/email-sec-settings-spf/","datePublished":"2021-07-14","dateModified":"2021-12-29","description":"ä¸Šä¸€æ¬¡æˆ‘å€‘æ·±å…¥ç­è§£äº† email security çš„åŸç†èˆ‡æ‡‰ç”¨å ´æ™¯ï¼Œé€™æ¬¡ä¾†çœ‹çœ‹ SPFã€DKIMã€DMARC è©²å¦‚ä½•è¨­ç½®å§ï¼ è«‹æ³¨æ„ï¼Œé€™è£¡çš„ã€è¨­å®šã€ä¸¦ä¸æ˜¯å›ç­”ä½ ã€å¦‚ä½•åœ¨ google æˆ–æ˜¯ Office365 è¨­å¥½é€™äº›ç´€éŒ„ã€ã€ã€ç”¨ XX..."}</script></article></main><footer><div class="footer-logos"><a href="https://www.facebook.com/cymetrics" rel="noopener noreferrer" target="_blank"><img src="/img/icons/icon_social media_facebook.svg" alt="facebook" height="30" width="30"></a><a href="https://www.linkedin.com/company/cymetrics" rel="noopener noreferrer" target="_blank"><img src="/img/icons/icon_social media_linkedln.svg" alt="linkedin" height="30" width="30"></a><a href="https://tech-blog.cymetrics.io/feed/feed.xml" rel="noreferrer noopener" target="_blank"><img src="/img/icons/rss-feed.svg" alt="rss feed" height="30" width="30"></a></div><div class="copyright">Â© 2021 Cymetrics Tech Blog, based on <a href="https://github.com/google/eleventy-high-performance-blog" rel="noopener noreferrer" target="_blank">eleventy-high-performance-blog</a></div></footer><script>// light/dark theme switch
      // disable dark mode for now
      const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })</script></body></html>