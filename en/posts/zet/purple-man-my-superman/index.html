<!DOCTYPE html><html domain="tech-blog.cymetrics.io" ga-id="G-3VBVCXV9Z0" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="CYBER,Cymetrics,Security" name="keywords"><link href="/img/favicon/favicon-192x192.png?hash=42b087227d" rel="icon" type="image/png"><meta content="#5789d3" name="theme-color"><title>Walking around between Red Team and Blue Team - Purple Man, My Superman</title><meta content="Walking around between Red Team and Blue Team - Purple Man, My Superman" property="og:title"><meta content="Walking around between Red Team and Blue Team - Purple Man, My Superman" name="twitter:title"><meta content="summary_large_image" name="twitter:card"><meta content="I'm glad that I can share some interesting insights that I've been following daily at CYBERSEC 2023 Taiwan. Red-Blue confrontation happens all the time. Red team uses new vulnerabilities and techniques to attack, while Blue team can use various mechanisms and protection to interrupt the attack. This article will introduce some useful tips and tools." name="description"><meta content="I'm glad that I can share some interesting insights that I've been following daily at CYBERSEC 2023 Taiwan. Red-Blue confrontation happens all the time. Red team uses new vulnerabilities and techniques to attack, while Blue team can use various mechanisms and protection to interrupt the attack. This article will introduce some useful tips and tools." name="twitter:description"><meta content="I'm glad that I can share some interesting insights that I've been following daily at CYBERSEC 2023 Taiwan. Red-Blue confrontation happens all the time. Red team uses new vulnerabilities and techniques to attack, while Blue team can use various mechanisms and protection to interrupt the attack. This article will introduce some useful tips and tools." property="og:description"><meta content="article" property="og:type"><meta content="https://tech-blog.cymetrics.io/en/posts/zet/purple-man-my-superman/" property="og:url"><meta content="Cymetrics Tech Blog" property="og:site_name"><meta content="https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/cover_en.png" property="og:image"><meta content="https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/cover_en.png" name="twitter:image"><meta content="hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk" name="google-site-verification"><link href="https://tech-blog.cymetrics.io/en/posts/zet/purple-man-my-superman/" rel="canonical"><meta content="always" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Cymetrics Tech Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=7f26b2ece8" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3VBVCXV9Z0"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3VBVCXV9Z0');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}body{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b,strong{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,ol,p,pre,ul{font-size:1em}ol,p,pre,ul{margin-bottom:1.5em}body,ol,p,pre,ul{font-size:1rem;line-height:1.6}ol,p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}body,ol,p,pre,ul{font-size:1.1rem;line-height:1.6}h2,ol,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:2.05rem}body,ol,p,pre,ul{font-size:1.2rem;line-height:1.6}h2,ol,p,pre,ul{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){overflow-x:scroll}button,code{border-radius:.3em}code{color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}h1,h2{font-family:var(--font-family)}a:hover{text-decoration:underline}form{padding:1.5em 1.5em 0;border:.2rem solid #202020;margin-bottom:1.5em}button{max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button+label,label+*{page-break-before:always}button,label{display:inline-block}form>:not(fieldset){margin-right:.75em}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ol,ul{margin-top:0}header nav .nav-title{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ol,li ul{margin-bottom:0}blockquote{padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:4px solid var(--primary)}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.punctuation{color:#ccc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.constant,.token.property{color:#f8c555}.token.builtin,.token.important,.token.keyword{color:#cc99cd}.token.string,.token.variable{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.inserted{color:green}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.w-full{width:100%}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}.post,footer{border-top:1px solid #ccc}.post{padding-top:35px;margin-top:35px}.menu__btn{display:inline-block;width:24px;height:24px;position:relative}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav,#nav .nav-title{display:flex;align-items:center}#nav{position:relative;height:68px;z-index:2}#nav .nav-title{padding:.375rem 1.5rem;width:100%;justify-content:space-between}#nav .nav-title *,.article-footer img{margin:0}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}.nav-logo{width:260px;height:40px;background:url(/img/logo1.png) no-repeat center center;background-size:contain}footer{margin-top:48px;font-size:14px;padding:24px;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.direct-link{display:none}.post-avatar{margin-top:27px;display:flex;align-items:center;height:36px}.post-avatar__img{width:36px;height:36px;overflow:hidden;margin:0;border-radius:50%}.post-avatar__time{font-size:13px}.post-avatar__info{margin-left:8px;color:#747474;text-align:left}.post-avatar__author{font-size:14px;font-weight:700}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}.article-author{margin-top:34px;display:flex;align-items:flex-start;margin-bottom:48px}.article-author__img{width:80px;height:80px;overflow:hidden;margin:0;border-radius:50%;flex-shrink:0}.article-author__info{margin-left:16px;text-align:left}.article-author__title{color:#747474;font-size:16px}.article-author__author{font-size:22px;font-weight:700;line-height:1em}.article-author__intro{color:#2f2f2f;margin-top:8px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav-logo{width:313px}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id="nav"><div class="nav-title"><a href="/en" class="nav-logo" title="Homepage"></a> <label class="menu__btn" for="menu__control"><span>Menu</span></label></div><div class="nav__links"><a href="/en/archive/">Archive</a> <a href="/en/tags/">Tags</a> <a href="/en/about/">About</a> <a href="/" style="white-space:nowrap;">中文</a></div></div><div id="reading-progress" aria-hidden="true"></div></nav><h1 class="w-full">Walking around between Red Team and Blue Team - Purple Man, My Superman</h1><aside class="w-full"><div class="post-tags"><a href="/en/tags/postsen/" class="post-tag">#postsEn</a></div><div class="post-avatar"><img alt="zet" src="/img/authors/zet_logo.jpeg" class="post-avatar__img" data-deopt="true"><div class="post-avatar__info"><div class="post-avatar__author"><a href="/en/posts/zet">zet</a></div><div class="post-avatar__time">18 Jul 2023</div></div></div></aside><dialog id="message"></dialog></header><main><article><div id="post-page"></div><p>I'm glad that I can share some interesting insights that I've been following daily at <a href="https://cyber.ithome.com.tw/2023/session-page/1819" rel="noopener noreferrer" target="_blank">CYBERSEC 2023 Taiwan</a>. Red-Blue confrontation happens all the time. Red team uses new vulnerabilities and techniques to attack, while Blue team can use various mechanisms and protection to interrupt the attack. This article will introduce some useful tips and tools.</p><h1 id="lab-environment-setup"><a href="#lab-environment-setup" class="direct-link">#</a> LAB Environment Setup</h1><p>Whether you're a red team or a blue team, there's always a need for a Lab. Not only can they test the traces of an attack, but they can also reproduce the threat to study and enhance detection. Is there a better way to do this than taking a snapshot of the state of a virtual machine?</p><h2 id="automatedlab"><a href="#automatedlab" class="direct-link">#</a> AutomatedLab</h2><p><a href="https://automatedlab.org/en/latest/" rel="noopener noreferrer" target="_blank">AutomatedLab</a> is a tool that can be used on Hyper-V and Azure and supports multiple services. The automated setup can greatly reduce the time we spend setting up the Lab.</p><p>Services supported by AutomatedLab include:</p><pre><code>Windows 7, 2008 R2, 8 / 8.1 and 2012 / 2012 R2, 10 / 2016, 2019, 2022
SQL Server 2008, 2008R2, 2012, 2014, 2016, 2017, 2019 more
Visual Studio 2012, 2013, 2015, 2017 more
Team Foundation Services 2015+
Azure DevOps more
Exchange 2013, 2016, 2019
SharePoint 2013, 2016, 2019
...
...
</code></pre><p>We can easily set up an Endpoint Client for a Windows DC Server, Exchange Server, and domain-joined endpoint by utilizing a straightforward PowerShell script. This script allows us to specify the required resources for the Virtual Machines (VMs).</p><pre class="language-powershell"><code class="language-powershell"><span class="token function">New-LabDefinition</span> <span class="token operator">-</span>Name LabEx2013 <span class="token operator">-</span>DefaultVirtualizationEngine HyperV<br><span class="token variable">$PSDefaultParameterValues</span> = @<span class="token punctuation">{</span><br>    <span class="token string">'Add-LabMachineDefinition:DomainName'</span> = <span class="token string">'contoso.com'</span><br>    <span class="token string">'Add-LabMachineDefinition:OperatingSystem'</span> = <span class="token string">'Windows Server 2012 R2 Datacenter (Server with a GUI)'</span><br><span class="token punctuation">}</span><br><span class="token function">Add-LabMachineDefinition</span> <span class="token operator">-</span>Name Ex2013DC1 <span class="token operator">-</span>Roles RootDC <span class="token operator">-</span>Memory 1GB<br><span class="token variable">$role</span> = <span class="token function">Get-LabPostInstallationActivity</span> <span class="token operator">-</span>CustomRole Exchange2013 <span class="token operator">-</span>Properties @<span class="token punctuation">{</span> OrganizationName = <span class="token string">'Test1'</span> <span class="token punctuation">}</span><br><span class="token function">Add-LabMachineDefinition</span> <span class="token operator">-</span>Name Ex2013EX1 <span class="token operator">-</span>Memory 4GB <span class="token operator">-</span>PostInstallationActivity <span class="token variable">$role</span><br><span class="token function">Add-LabMachineDefinition</span> <span class="token operator">-</span>Name Ex2013Client1 <span class="token operator">-</span>OperatingSystem <span class="token string">'Windows 10 Pro'</span> <span class="token operator">-</span>Memory 1GB<br><span class="token function">Install-Lab</span><br><span class="token function">Show-LabDeploymentSummary</span> <span class="token operator">-</span>Detailed<br></code></pre><h2 id="detectionlab"><a href="#detectionlab" class="direct-link">#</a> DetectionLab</h2><p><a href="https://github.com/clong/DetectionLab" rel="noopener noreferrer" target="_blank">DetectionLab</a> is another option. Unlike AutomatedLab, DetectionLab does not offer a wide variety of services for customers to customize their installations, but rather uses a fixed architecture of four machines. However, DetectionLab comes with a number of useful tools, these include:</p><ul><li>Microsoft Advanced Threat Analytics</li><li>Splunk</li><li>Osquery + Fleet</li><li>Sysmon</li><li>Zeek</li><li>Splunk</li></ul><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/detection-lab-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/detection-lab-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/detection-lab-840w.webp 840w, /img/posts/zet/purple-man-my-superman/detection-lab-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/detection-lab-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/detection-lab-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/detection-lab-840w.png 840w, /img/posts/zet/purple-man-my-superman/detection-lab-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/detection-lab-1920w.png" height="540" width="960" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 960 540'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQImQXBy2oCMRQA0Hyf0D/pTwguuxOKuHfrxmWLSnGhID4Qq52HFp0xZmJeOib3ZmbUc4imR7ypHP30eDnnkKrrnJoccHUSkcjJstUI2vXEQK3ZHU9+P7o/751+tNi8ffYG6x1hjKWHQ1mWf2FIE0YTGkY7nck43l+kJEEcVWVlrWWMPR4V55nWqigKIQSAI7PtyN3xzLWSgmu7DP6NklzcOOfOOfI9/DLaAOKzKlIN833mwQKi9x4RX3rZn2FfFhBrAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>One tool worth mentioning is Microsoft Advanced Threat Analytics (ATA). Many of the internal network detection mechanisms of Microsoft Defender were formerly integrated into ATA. It allows for the reproduction and verification of intranet attacks, such as Password Spraying, Pass-The-Hash, and Pass-The-Ticket, to ensure their detection.</p><p>For the red team, DetectionLab can be utilized to observe, and tools such as Sysmon, Zeek, and ATA can be used to understand possible attack traces in advance and try to reduce their visibility. On the other hand, the blue team can use tools such as Splunk and Sysmon to conduct Threat Hunting training, and by familiarizing themselves with the log data of various events, they can then quickly connect and investigate similar attacks that may occur in the future.</p><h1 id="information-security-tools-integration"><a href="#information-security-tools-integration" class="direct-link">#</a> Information Security Tools Integration</h1><p>Enterprises use SecDevOps or DevSecOps to integrate security into the development process and automate it using the CI/CD pipeline. The concept here is more like <a href="https://github.com/j3ssie/osmedeus" rel="noopener noreferrer" target="_blank">osmedeus</a> tool <a href="https://github.com/osmedeus/osmedeus-workflow" rel="noopener noreferrer" target="_blank">workflow</a> "flow Engine for Offensive Security". We can leverage CI/CD to accomplish this, encompassing the installation and deployment of the latest versions of scanning tools, as well as customizing the various stages of scanning according to our requirements.</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/osmedeus-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/osmedeus-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/osmedeus-840w.webp 840w, /img/posts/zet/purple-man-my-superman/osmedeus-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/osmedeus-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/osmedeus-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/osmedeus-840w.png 840w, /img/posts/zet/purple-man-my-superman/osmedeus-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/osmedeus-1920w.png" height="900" width="1600" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1600 900'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAg0lEQVQImUVOXQvCMAzs//9X+qaIexmICIIO7NSydevSj9Skuq7qPVxyIbmcIOLEzKlgbjhzhigVA8f4Hf5Xxb46JKW6p4KgR3hIE6fWX/vOE87X212d9KisvfjeoT8PaKQ7mabSxwGnYk7Mlkje7q/8gpgchUBRLLEWXq03APCTH/M3baSttral0EEAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>For example, the process can be sequenced as follows:</p><ol><li>Install the latest tools<ul><li>Utilize Git clone</li><li>Utilize Curl</li></ul></li><li>Host and URL listing<ul><li>subfinder</li><li>httpx</li></ul></li><li>Analyzing and Crawling<ul><li><a href="https://github.com/projectdiscovery/katana" rel="noopener noreferrer" target="_blank">katana</a></li></ul></li><li>Scanning<ul><li>ZAP Proxy</li><li>Nessus</li><li>BurpSuite</li></ul></li><li>Notifications<ul><li>Telegram bot</li><li>Slack bot</li></ul></li></ol><p>We can streamline the process by installing the latest tools through commands and conducting emulations to gather comprehensive data. This data is then fed into a crawler or filter, followed by a straightforward and robust vulnerability scanning tool for basic checks. Finally, the scanning log and results are integrated into communication software to signal the completion of scanning. A well-designed CI process allows for highly customized scanning content and tools.</p><p>The greatest concern is discovering fundamental weaknesses during extended penetration testing that could have been easily identified through catalog scanning but were overlooked at the initial stage, leading to significant time wastage. Implementing a fixed and comprehensive automation process can help us save time, uncover more information, and enhance our efficiency and accuracy.</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/drone-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/drone-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/drone-840w.webp 840w, /img/posts/zet/purple-man-my-superman/drone-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/drone-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/drone-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/drone-840w.png 840w, /img/posts/zet/purple-man-my-superman/drone-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/drone-1920w.png" height="460" width="972" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 972 460'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAIAAAAcxIEBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnUlEQVQImWPImrz+/++f33/8+PX7z++////9h4K/f/9++vTl799/DDldy/7////r1+9///43Nbf6+gWEhoaFhoaFhIBQYGAwQ0HvKpCK33/+///v4+PHy8OvpKQiIiLOzc3Lzc3Lzs7FkN+78uf//x9//vn6/39QaLiMjJy+vpGCghIvLz83Ny8PDx+KGaEgFfJGRqbq6loiImIQYwADD1hmMAq/7wAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>Here is an example using Drone CI. After adding the relevant environment variables, the automated scanning process can be initiated. It allows for saving scan logs and automatic notifications upon completion of the scan.</p><h1 id="red-and-blue-team-technology"><a href="#red-and-blue-team-technology" class="direct-link">#</a> Red and Blue Team Technology</h1><h2 id="tunneling-(t1572)"><a href="#tunneling-(t1572)" class="direct-link">#</a> Tunneling (<a href="https://attack.mitre.org/techniques/T1572/" rel="noopener noreferrer" target="_blank">T1572</a>)</h2><blockquote><p>Can be used to hide real IP, penetrate and bridge internal network.</p></blockquote><p>During penetration testing, we usually don't want to expose our public IP, or firewall blocking mechanism, so we can use Ngrok to transfer files and shells. In real APT (Advanced Persistent Threat) attacks, we can also see other intranet penetration practices, such as using the SoftEther service to connect the victim's computer to the attacker's computer network, so that the attacker can easily take control of the victim's computers and keep them under constant management. However, here we would like to focus on two specific services, Cloudflared and Tailscale.</p><p>Cloudflared is a cross-platform command-line Tunnel client offered by Cloudflare, designed to complement, and work in conjunction with its own services, <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/" rel="noopener noreferrer" target="_blank">Zero Trust Tunnels</a>.</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/cloudflare-tunnel-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnel-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnel-840w.webp 840w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnel-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/cloudflare-tunnel-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnel-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnel-840w.png 840w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnel-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/cloudflare-tunnel-1920w.png" height="1102" width="1768" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1768 1102'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiUlEQVQImR3JWw4CIQxAUfa/SE2MOkaw8iq0hbZmvF83OWHKvgOpboHb5unuscurirurWZC1ckOjXN/XXtJsEFN8ZUwVh2gwszkGxCPFY4w+W5o9N5JPqbwtqNoSnjQuj2eEL7PYP2aRk88j10UsAFBLQcSBSMQnu7uZ+WbfvIRJtA9uSJN1bfsBu8mtVVfUWhMAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>We can run the Cloudflared Tunnel agent on the victim's computer to allow the victim computer to act as a <strong>proxy</strong> to access the internal network. Add the intranet resources you want to pass through in the Cloudflare settings interface, which supports CIDR representation in the web settings interface. Next, remove the default intranet setting in the Split Tunnels function. With all the above done, we can access the intranet resources directly through <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/" rel="noopener noreferrer" target="_blank">Cloudflare WARP</a>.</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-840w.webp 840w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-840w.png 840w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-1920w.png" height="659" width="965" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 965 659'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAGCAIAAACepSOSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYklEQVQImVWOQQ6AIBAD+f8HPZtoYgSVgOCulF2D8SBzbdOO8esUDyuipUBE9IfJBOIbgHN7zqmKAl/DpItrQxYb7BYuLsT1y2KiM3OBDiPPDt2mj0wMtGp31rL7VXjRXkUf1kaen/uhl5cAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-840w.webp 840w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-840w.png 840w, /img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-1920w.png" height="540" width="1018" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1018 540'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAIAAACaUPOvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAc0lEQVQImT3M0QHDIAiEYfcfp1t0GYUYRY4grbXJPX/3p5z5OJiJVRUA/0ZEvXd3j4hUSiGinEutJ2AiHTAzG6pmFnMmwKb/B2CMsa8KFZHVEJHr3hIiW0Bv0Vp1v3ZjxZ/GI15v5zYjYkaYmTwNqKp+xQdn8cB46RdeCwAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>In addition, Tailscale and Headscale have developed their own applications based on the WireGuard protocol. The application scenario is like having a VPN Hub where each client can connect, creating a virtual intranet that enables communication amongst themselves. This communication is facilitated through Network Address Translators (<a href="https://tailscale.com/blog/how-nat-traversal-works/" rel="noopener noreferrer" target="_blank">NATs</a>) to establish seamless connectivity.</p><p>Similar services, such as ZeroTier, can eventually form a hacker's virtual intranet, allowing the hacker to take control of the intranet hosts without being affected by firewalls.</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/tailscale-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/tailscale-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/tailscale-840w.webp 840w, /img/posts/zet/purple-man-my-superman/tailscale-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/tailscale-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/tailscale-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/tailscale-840w.png 840w, /img/posts/zet/purple-man-my-superman/tailscale-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/tailscale-1920w.png" height="1076" width="2000" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 2000 1076'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxklEQVQYlUWP3UrDQBBG8+R9Bx9CCl5YavGiBelFoVShrTc2mGhLoH9gTbJxw252u3tkA9EDMzdzmG8mAnDO4b1vyzpQUpKP76g3yzD+IwpCRy4k6f7C/cOUbHhLFa9IkgRRFjRaBdnx8rzguE0ppSbLNf3RjP3hjGk0P5XAGNOmR43WvK7XnHYfFEVFliv6gyfSmx71YoIyFtvJoXVcvks+sxOPkznH+A35deY9jqmEaFOiIHVnO+8xDmrVoO0Ve/1fFB78BbcN+LdbeyL3AAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p><strong>Defense & Hunting:</strong></p><p>We can utilize <a href="https://github.com/VirusTotal/yara" rel="noopener noreferrer" target="_blank">YARA</a> and <a href="https://github.com/SigmaHQ/sigma" rel="noopener noreferrer" target="_blank">SIGMA</a> to scan the process and memory to cover a pattern-based detection mechanism to strengthen the defense capability. Pattern-based detection mechanisms are implemented to strengthen the defense capability. The setup of these rules can be found in Mandiant's blog post on detecting VPNs: <a href="https://www.mandiant.com/resources/blog/burrowing-your-way-into-vpns" rel="noopener noreferrer" target="_blank">Burrowing your way into VPNs, Proxies, and Tunnels</a>.</p><pre><code>rule M_Hunting_Linux_VPNEngine_GenericSoftEther_1
{
    meta:
        author = "Mandiant"
        description = "Rule looks for SoftEther generic terms in samples."
    strings:
        $domain = "update-check.softether-network.net" ascii fullword
        $keepalive = "keepalive.softether.org"
        $vpn = "SoftEther Corporation" ascii fullword
    condition:
        filesize &lt; 10MB and uint32(0) == 0x464c457f and all of them
}
</code></pre><h2 id="lateral-movement-(ta0109)"><a href="#lateral-movement-(ta0109)" class="direct-link">#</a> Lateral Movement (<a href="https://attack.mitre.org/tactics/TA0109/" rel="noopener noreferrer" target="_blank">TA0109</a>)</h2><p>If you want to execute commands and control other computers after getting a HASH or Ticket from an intranet infiltration, you usually use PsExec, SMBExec, Atexec, but these tools are very likely to be detected. Here we can use Impacket to customize our own intranet mobility tool.</p><p>Check out Impacket's official SMB command execution tool <a href="https://github.com/fortra/impacket/blob/b5dab2df5e187b81d481dbbd513ea7fe1978d76a/examples/smbexec.py#L187" rel="noopener noreferrer" target="_blank">Github: Impacket examples smbexec.py</a>, in which you can modify the <code>self.__output</code> file upload location and <code>self.__pwsh</code> powershell command. These pattern are easily recognized and detected, so we can use other system APIs or methods to achieve the same functionality, and reduce the chance of detection by changing processes and features.</p><p>The following commands are executed in a way that is easily recognized as a rule, <strong>fixed system path + random <code>.bat</code> file + base64 encoded content</strong>, we can modify the path and execution method to bypass detection.</p><pre class="language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">execute_remote</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> shell_type<span class="token operator">=</span><span class="token string">'cmd'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token keyword">if</span> shell_type <span class="token operator">==</span> <span class="token string">'powershell'</span><span class="token punctuation">:</span><br>        data <span class="token operator">=</span> <span class="token string">'$ProgressPreference="SilentlyContinue";'</span> <span class="token operator">+</span> data<br>        data <span class="token operator">=</span> self<span class="token punctuation">.</span>__pwsh <span class="token operator">+</span> b64encode<span class="token punctuation">(</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-16le'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    batchFile <span class="token operator">=</span> <span class="token string">'%SYSTEMROOT%\\'</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>string<span class="token punctuation">.</span>ascii_letters<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.bat'</span><br><br>    command <span class="token operator">=</span> self<span class="token punctuation">.</span>__shell <span class="token operator">+</span> <span class="token string">'echo '</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">' ^> '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>__output <span class="token operator">+</span> <span class="token string">' 2^>^&1 > '</span> <span class="token operator">+</span> batchFile <span class="token operator">+</span> <span class="token string">' & '</span> <span class="token operator">+</span> \<br>              self<span class="token punctuation">.</span>__shell <span class="token operator">+</span> batchFile<br><br>    <span class="token keyword">if</span> self<span class="token punctuation">.</span>__mode <span class="token operator">==</span> <span class="token string">'SERVER'</span><span class="token punctuation">:</span><br>        command <span class="token operator">+=</span> <span class="token string">' & '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>__copyBack<br>    command <span class="token operator">+=</span> <span class="token string">' & '</span> <span class="token operator">+</span> <span class="token string">'del '</span> <span class="token operator">+</span> batchFile</code></pre><p>In addition, the CrackMapExec tool supports multiple protocols, Credentials, Kerberos can be combined with BloodHound to form modular functionality and used for listing, password cracking, command execution. The Impacket-based attack on Linux, at its core, is remarkably user-friendly. Furthermore, the authors have established <a href="https://github.com/Porchetta-Industries" rel="noopener noreferrer" target="_blank">Porchetta Industries</a>, a central platform aimed at supporting developers of Open Source Infosec tools—a commendable and valuable initiative.</p><p><strong>Defense & Hunting:</strong></p><p>Set up an alarm system to record and notify when certain login events occur, for example, if an important server logs in, it can also send a notification to internal communication software such as Slack. In addition, if you perform traffic and packet mirroring on your internal network and throw in a network analysis tool, some of the error codes from internal attacks and attempts may be detected.</p><p>You can also create HoneyShare, HoneyUser, and set up traps to lure attackers, when they were in the intranet, they always pick the easy one to attack. Create shared folders without passwords, fake accounts with high privileges and use weak passwords, if someone accesses the data and logs in, it can be logged and notified, and we have a chance to catch the attack and block it immediately.</p><h2 id="evasion-(ta0103)-%26-command-and-control-(ta0101)"><a href="#evasion-(ta0103)-%26-command-and-control-(ta0101)" class="direct-link">#</a> Evasion (<a href="https://attack.mitre.org/tactics/TA0103/" rel="noopener noreferrer" target="_blank">TA0103</a>) & Command-and-Control (<a href="https://attack.mitre.org/tactics/TA0101/" rel="noopener noreferrer" target="_blank">TA0101</a>)</h2><p>The main detections of the defense software can be divided into:</p><ul><li>Pattern-based</li><li>Behavior-based</li><li>Indicators of Compromise (IOCs)</li></ul><p>Pattern-based uses fixed strings, URLs, and Hexadecimal as features.</p><p>Behavior-based is like a web server process that opens a shell process in which the command line contains some special strings, and this kind of multiple behaviors are combined to form a peculiar behavior that is sequential and dependent to be used as a judgment.</p><p>Lastly, Indicator of Compromise (IOC) often involves utilizing IP/URL blacklists. In reality, <strong>given enough time, attackers can bypass any protective software</strong>.</p><p>There are many bypass techniques that must be included in the backdoor program of the controlling host in order to work covertly under the layers of surveillance and protection mechanisms, including:</p><ul><li>Unhook</li><li>Indirect syscalls</li><li>Run PowerShell without Powershell.exe</li><li>Disable AMSI, ETW, Event Log</li></ul><p>There are now a wide variety of Loaders and Packers that dramatically reduce the amount of time it takes to bypass protection software, and there are even SaaS services available. Attackers can also write malware in multiple languages, we can use the keyword "Offensive" at the beginning and add the language name of the program to Github search. For example, <a href="https://github.com/byt3bl33d3r/OffensiveNim" rel="noopener noreferrer" target="_blank">OffensiveNim</a> contains sample code to run shellcode, patch process memory, call syscall, and so on.</p><p>The concept of an Interpreter can also be incorporated into malware, by minimizing the malware loader, splitting up the modular functionality, and then downloading and loading it for execution when needed. This can be implemented using Lua or .NET Assemblies. The <a href="https://github.com/traefik/yaegi" rel="noopener noreferrer" target="_blank">yaegi</a> lib in golang is also interesting, and can be used to run golang samples in golang as follows:</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main<br><br><span class="token keyword">import</span> <span class="token punctuation">(</span><br>	<span class="token string">"github.com/traefik/yaegi/interp"</span><br>	<span class="token string">"github.com/traefik/yaegi/stdlib"</span><br><span class="token punctuation">)</span><br><br><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	i <span class="token operator">:=</span> interp<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>interp<span class="token punctuation">.</span>Options<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>	i<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>stdlib<span class="token punctuation">.</span>Symbols<span class="token punctuation">)</span><br><br>	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token function">Eval</span><span class="token punctuation">(</span><span class="token string">`import "fmt"`</span><span class="token punctuation">)</span><br>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br><br>	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">Eval</span><span class="token punctuation">(</span><span class="token string">`fmt.Println("Hello Yaegi")`</span><span class="token punctuation">)</span><br>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre><p>In fact, many of the techniques and details are aimed at achieving the concept of "Anti-Forensics".</p><p><strong>Defense & Hunting:</strong></p><p>In addition to YARA and Sigma, we can also utilize the Event Query Language provided by EDR vendors, with Timeline Explorer or free scanners to help us detect malware. For example, we can look at elastic's <a href="https://github.com/elastic/detection-rules/tree/main/rules" rel="noopener noreferrer" target="_blank">detection-rules</a> to learn malware behavior.</p><p>On the endpoint, we can simply use <a href="https://ericzimmerman.github.io/#!index.md" rel="noopener noreferrer" target="_blank">Timeline Explorer</a> + <a href="https://github.com/Yamato-Security/hayabusa" rel="noopener noreferrer" target="_blank">Yamato-Security/hayabusa</a> for cross-computer Eventlog analysis, which uses temporal ordering to analyze and aggregate high-risk events across computers. Nextron Systems also has open-source and free scanning programs <a href="https://github.com/Neo23x0/Loki" rel="noopener noreferrer" target="_blank">Loki</a>, <a href="https://www.nextron-systems.com/thor-lite/" rel="noopener noreferrer" target="_blank">Thor Lite</a> to help detect threats on endpoints.</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/timeline-explorer-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/timeline-explorer-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/timeline-explorer-840w.webp 840w, /img/posts/zet/purple-man-my-superman/timeline-explorer-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/timeline-explorer-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/timeline-explorer-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/timeline-explorer-840w.png 840w, /img/posts/zet/purple-man-my-superman/timeline-explorer-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/timeline-explorer-1920w.png" height="449" width="960" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 960 449'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAIAAAAcxIEBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAqklEQVQImRXCywqCQBQA0Pn8XJgEkihaLixal4atKjT1as6ojYpkMeOLFn1EdDgo5IeocwK2T0Y3Ho4wOOnk0u8ZOht6G08nFF2V8KKAp+axmYMJvpZGRlPsSGxiWNHUQsxXmacyX+3jNQ8NftPGZPXJrCnfjv8bhImA8QwT4VHOs0IkmVDW0pMrRSXlVKTNApWBTEO5ipYvojeJVoPSZvpQWy3W27v2JvoP1kV8zEVO6/MAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/thor-lite-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/thor-lite-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/thor-lite-840w.webp 840w, /img/posts/zet/purple-man-my-superman/thor-lite-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/thor-lite-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/thor-lite-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/thor-lite-840w.png 840w, /img/posts/zet/purple-man-my-superman/thor-lite-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/thor-lite-1920w.png" height="384" width="960" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 960 384'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAIAAAD+GJp4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvklEQVQImU3BzwvBUAAA4Pe3MpZQclJqeysvJUUhYsZhyUPy68IeYmmT3qK5OEmT4iI3kT3l5PuABCHnDyjFZKoQiaYRynUSE9LNSB05P1ssiaYRQoAERa8/tNVxey4kempa3ZUe92G/32i39rZNKbUsC4iCwPGhtaY2x0IcK/rgcGFuvVQrFyuUUsMwTNMECCEfH97oGGswhqun6Zkx5pyd6+36fr2fPwBC0cMHV3IWj+IxrByJwxhzPy778wV4XH9TfsBvSQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h1 id="a-few-tips-for-the-blue-team"><a href="#a-few-tips-for-the-blue-team" class="direct-link">#</a> A few tips for the blue team</h1><ol><li>Regularly conduct asset inventory and familiarize yourself with the network boundaries. Avoid waiting for incidents to occur without knowing the locations of the affected hosts.</li><li>Keep all devices connected to the network up to date with the latest patches, including routers, switches, IoT devices, printers, and endpoints.</li><li>Establish a Log Server to record as much data as possible, including logs from firewalls, endpoints, and servers. Utilize these logs for incident investigation.</li><li>Implement regular vulnerability scanning, penetration testing, and DevSecOps planning. Elevate information security standards and integrate them into daily operations.</li><li>Stay subscribed to product vulnerability notifications and related intelligence to stay informed about relevant attack techniques and knowledge.</li></ol><p>For the Blue Team, use a "Red Team" to validate and identify vulnerabilities. Collaborate with a trusted service provider regularly to identify and resolve issues, thus increasing the cost of potential attacks.</p><h1 id="learning-and-improvement"><a href="#learning-and-improvement" class="direct-link">#</a> Learning and Improvement</h1><p>You can subscribe news, techs, and RSS feeds to achieve, and categorize these subscription items. Google the information or find more valuable resources when you don't understand the concept or meaning during the learning process.For example, if you find a nice Github project, you can subscribe to the blog of the author and the company he works for. Here are some of the subscription sources:</p><ul><li>Vulnerabilities can be subscribed from TVN, Exploit Database, ZDI.</li><li>Industry information can be found in the ATT&CK Evaluations program on the vendor's Tech Blog.</li><li>Join Reddit, forums, Youtube community software discussions.</li></ul><p>There are also many good online course resources available:</p><ul><li><a href="https://institute.sektor7.net/" rel="noopener noreferrer" target="_blank">SEKTOR7</a></li><li><a href="https://www.pentesteracademy.com/" rel="noopener noreferrer" target="_blank">Pentester Academy</a></li><li><a href="https://www.zeropointsecurity.co.uk/" rel="noopener noreferrer" target="_blank">Zero-Point Security Courses</a></li></ul><p>Finally, here are some links and resources collected during the process, and organized into a <a href="mind-map.html" rel="noopener noreferrer" target="_blank">Mind map</a> using <a href="https://markmap.js.org/" rel="noopener noreferrer" target="_blank">markmap</a>.</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/mind-map-1920w.webp 1920w, /img/posts/zet/purple-man-my-superman/mind-map-1280w.webp 1280w, /img/posts/zet/purple-man-my-superman/mind-map-840w.webp 840w, /img/posts/zet/purple-man-my-superman/mind-map-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/zet/purple-man-my-superman/mind-map-1920w.png 1920w, /img/posts/zet/purple-man-my-superman/mind-map-1280w.png 1280w, /img/posts/zet/purple-man-my-superman/mind-map-840w.png 840w, /img/posts/zet/purple-man-my-superman/mind-map-320w.png 320w" type="image/png"><img alt="" src="/img/posts/zet/purple-man-my-superman/mind-map-1920w.png" height="1122" width="1192" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1192 1122'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtklEQVQYlSXOS07EMBRE0Wwl2HH8ec+fEJM0EdDqZoAYsP/dXBRlWjpS3cGnStRGXt5Iy86kK8YrNhSMzwxzFGxQglTkROuB8Qnrr/0CUXG5EWIhv35itfPiFePlAi4qQQtp2fj4/qW8P5nrhkvlAlMUTMiE9cZyfCGPP/R4klpnCFKIuWKl4VNmXm6M/cGoHTMnBhcLPmacVloW2v2HuXSs81fkFJTpLD5vvKB9x60b437HSOUfEsFh57xx0wUAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h1 id="reference"><a href="#reference" class="direct-link">#</a> Reference</h1><ul><li>A blueprint for evading industry leading endpoint protection in 2022 - <a href="https://vanmieghem.io/blueprint-for-evading-edr-in-2022/" rel="noopener noreferrer" target="_blank">https://vanmieghem.io/blueprint-for-evading-edr-in-2022/</a></li><li>MITRE ATT&CK GALLIUM Group - <a href="https://attack.mitre.org/groups/G0093/" rel="noopener noreferrer" target="_blank">https://attack.mitre.org/groups/G0093/</a></li><li>psexec 原理分析和实现 - <a href="https://paper.seebug.org/2056/" rel="noopener noreferrer" target="_blank">https://paper.seebug.org/2056/</a></li><li>Anti-Forensics - <a href="https://github.com/ashemery/Anti-Forensics" rel="noopener noreferrer" target="_blank">https://github.com/ashemery/Anti-Forensics</a></li><li>WarCon V - Modern Initial Access and Evasion Tactics</li><li>bigb0sss/RedTeam-OffensiveSecurity - <a href="https://github.com/bigb0sss/RedTeam-OffensiveSecurity" rel="noopener noreferrer" target="_blank">https://github.com/bigb0sss/RedTeam-OffensiveSecurity</a></li><li>tkmru/awesome-edr-bypass - <a href="https://github.com/tkmru/awesome-edr-bypass" rel="noopener noreferrer" target="_blank">https://github.com/tkmru/awesome-edr-bypass</a></li><li>snovvcrash Pentester's Promiscuous Notebook - <a href="https://ppn.snovvcrash.rocks/" rel="noopener noreferrer" target="_blank">https://ppn.snovvcrash.rocks/</a></li></ul><div class="article-footer"><a href="https://tech-blog.cymetrics.io/en/posts/zet/purple-man-my-superman/" on-click="share"><img alt="Share" src="/img/icons/icon_external link hyperlink.svg" height="24" width="24">Share this post</a></div><div><p style="font-weight: bold;">Tag</p><div class="post-tags"><a href="/en/tags/postsen/" class="post-tag">#postsEn</a></div><p style="font-weight: bold;">Recommendation</p><ol><li><a href="/en/posts/nick/chatgpt_basic_en/">ChatGPT Hacking Basics</a></li><li><a href="/en/posts/seadog007/supply-chain-attack/">What is Supply Chain Attack?</a></li><li><a href="/en/posts/nick/data-leakage_en/">Basic Awareness of Hacking Prevention: Data Protection</a></li><li><a href="/en/posts/genchilu/javas-thread-model-and-golang-goroutine-en/">Java’s Thread Model and Golang Goroutine</a></li><li><a href="/en/posts/genchilu/the-difference-between-java-and-golang-in-writing-concurrent-code-to-access-shared-variable-en/">The Difference Between Java and Golang in Writing Concurrent Code to Access Shared Variable</a></li></ol></div><div class="article-author"><img alt="zet" src="/img/authors/zet_logo.jpeg" class="article-author__img" data-deopt="true"><div class="article-author__info"><div class="article-author__title">Author</div><div class="article-author__author"><a href="/en/posts/zet">zet</a></div><div class="article-author__intro"></div></div></div><p style="font-weight: bold;">Discussion(login required)</p><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" id="utterance-script" issue-term="title" label="utterance" repo="cymetrics/blog" theme="github-light"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Walking around between Red Team and Blue Team - Purple Man, My Superman","image":["https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/detection-lab-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/osmedeus-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/drone-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/cloudflare-tunnel-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/cloudflare-tunnels-setting-2-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/tailscale-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/timeline-explorer-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/thor-lite-1920w.png","https://tech-blog.cymetrics.io/img/posts/zet/purple-man-my-superman/mind-map-1920w.png","https://tech-blog.cymetrics.io/img/icons/icon_external link hyperlink.svg","https://tech-blog.cymetrics.io/img/authors/zet_logo.jpeg"],"author":{"@type":"Person","name":"zet"},"publisher":{"@type":"Organization","name":"Cymetrics Tech Blog","url":"https://tech-blog.cymetrics.io","logo":{"@type":"ImageObject","url":"https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png","width":512,"height":512}},"url":"https://tech-blog.cymetrics.io/en/posts/zet/purple-man-my-superman/","mainEntityOfPage":"https://tech-blog.cymetrics.io/en/posts/zet/purple-man-my-superman/","datePublished":"2023-07-18","dateModified":"2023-11-23","description":"I&#39;m glad that I can share some interesting insights that I&#39;ve been following daily at CYBERSEC 2023 Taiwan. Red-Blue confrontation happens..."}</script></article></main><footer><div class="footer-logos"><a href="https://www.facebook.com/cymetrics" rel="noopener noreferrer" target="_blank"><img alt="facebook" src="/img/icons/icon_social media_facebook.svg" height="30" width="30"></a><a href="https://www.linkedin.com/company/cymetrics" rel="noopener noreferrer" target="_blank"><img alt="linkedin" src="/img/icons/icon_social media_linkedln.svg" height="30" width="30"></a><a href="https://tech-blog.cymetrics.io/feed/feed.xml" rel="noreferrer noopener" target="_blank"><img alt="rss feed" src="/img/icons/rss-feed.svg" height="30" width="30"></a></div><div class="copyright">© 2021 Cymetrics Tech Blog, based on <a href="https://github.com/google/eleventy-high-performance-blog" rel="noopener noreferrer" target="_blank">eleventy-high-performance-blog</a>. <a href="https://oneinfinity.global/" rel="noopener noreferrer" target="_blank">OneInfinity</a></div></footer><script>const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })</script></body></html>