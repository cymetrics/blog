<!DOCTYPE html><html domain="tech-blog.cymetrics.io" ga-id="G-3VBVCXV9Z0" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="CYBER,Cymetrics,Security" name="keywords"><link href="/img/favicon/favicon-192x192.png?hash=42b087227d" rel="icon" type="image/png"><meta content="#5789d3" name="theme-color"><title>Cache Strategy In Backend</title><meta content="Cache Strategy In Backend" property="og:title"><meta content="Cache Strategy In Backend" name="twitter:title"><meta content="summary_large_image" name="twitter:card"><meta content="Cache is one of the most important parts of the backend. We always use cache to improve latency. There are several things worth thinking about more before we implement cache architecture. In this article, I want to briefly discuss some of that." name="description"><meta content="Cache is one of the most important parts of the backend. We always use cache to improve latency. There are several things worth thinking about more before we implement cache architecture. In this article, I want to briefly discuss some of that." name="twitter:description"><meta content="Cache is one of the most important parts of the backend. We always use cache to improve latency. There are several things worth thinking about more before we implement cache architecture. In this article, I want to briefly discuss some of that." property="og:description"><meta content="article" property="og:type"><meta content="https://tech-blog.cymetrics.io/en/posts/genchilu/cache-strategy-en/" property="og:url"><meta content="Cymetrics Tech Blog" property="og:site_name"><meta content="https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png" property="og:image"><meta content="https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png" name="twitter:image"><meta content="hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk" name="google-site-verification"><link href="https://tech-blog.cymetrics.io/en/posts/genchilu/cache-strategy-en/" rel="canonical"><meta content="always" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Cymetrics Tech Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=7f26b2ece8" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3VBVCXV9Z0"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3VBVCXV9Z0');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}body,figure{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b,strong{font-weight:700}code{overflow-x:auto;border-radius:.3em;color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,ol,p,ul{font-size:1em}ol,p,ul{margin-bottom:1.5em}body,ol,p,ul{font-size:1rem;line-height:1.6}ol,p,ul{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}body,ol,p,ul{font-size:1.1rem;line-height:1.6}h2,ol,p,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:2.05rem}body,ol,p,ul{font-size:1.2rem;line-height:1.6}h2,ol,p,ul{margin-bottom:1.632rem}}h1,h2{font-family:var(--font-family)}a:hover{text-decoration:underline}button{border-radius:.3em;max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button+label,label+*{page-break-before:always}button,label{display:inline-block}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}figure img,header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ol,ul{margin-top:0}header nav .nav-title{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ol,li ul{margin-bottom:0}blockquote{padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:4px solid var(--primary)}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.w-full{width:100%}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}.post,footer{border-top:1px solid #ccc}.post{padding-top:35px;margin-top:35px}.menu__btn{display:inline-block;width:24px;height:24px;position:relative}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav,#nav .nav-title{display:flex;align-items:center}#nav{position:relative;height:68px;z-index:2}#nav .nav-title{padding:.375rem 1.5rem;width:100%;justify-content:space-between}#nav .nav-title *,.article-footer img{margin:0}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}.nav-logo{width:260px;height:40px;background:url(/img/logo1.png) no-repeat center center;background-size:contain}footer{margin-top:48px;font-size:14px;padding:24px;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.direct-link{display:none}.post-avatar{margin-top:27px;display:flex;align-items:center;height:36px}.post-avatar__img{width:36px;height:36px;overflow:hidden;margin:0;border-radius:50%}.post-avatar__time{font-size:13px}.post-avatar__info{margin-left:8px;color:#747474;text-align:left}.post-avatar__author{font-size:14px;font-weight:700}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}.article-author{margin-top:34px;display:flex;align-items:flex-start;margin-bottom:48px}.article-author__img{width:80px;height:80px;overflow:hidden;margin:0;border-radius:50%;flex-shrink:0}.article-author__info{margin-left:16px;text-align:left}.article-author__title{color:#747474;font-size:16px}.article-author__author{font-size:22px;font-weight:700;line-height:1em}.article-author__intro{color:#2f2f2f;margin-top:8px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav-logo{width:313px}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id="nav"><div class="nav-title"><a href="/en" class="nav-logo" title="Homepage"></a> <label class="menu__btn" for="menu__control"><span>Menu</span></label></div><div class="nav__links"><a href="/en/archive/">Archive</a> <a href="/en/tags/">Tags</a> <a href="/en/about/">About</a> <a href="/" style="white-space:nowrap;">中文</a></div></div><div id="reading-progress" aria-hidden="true"></div></nav><h1 class="w-full">Cache Strategy In Backend</h1><aside class="w-full"><div class="post-tags"><a href="/en/tags/postsen/" class="post-tag">#postsEn</a> <a href="/en/tags/back-end/" class="post-tag">#Back-end</a> <a href="/en/tags/cache/" class="post-tag">#cache</a> <a href="/en/tags/policy/" class="post-tag">#policy</a> <a href="/en/tags/strategy/" class="post-tag">#strategy</a> <a href="/en/tags/lru/" class="post-tag">#lru</a> <a href="/en/tags/consistency-hash/" class="post-tag">#consistency-hash</a></div><div class="post-avatar"><img alt="genchilu" src="/img/authors/genchilu_logo.jpeg" class="post-avatar__img" data-deopt="true"><div class="post-avatar__info"><div class="post-avatar__author"><a href="/en/posts/genchilu">genchilu</a></div><div class="post-avatar__time">25 Jan 2022</div></div></div></aside><dialog id="message"></dialog></header><main><article><div id="post-page"></div><p>Cache is one of the most important parts of the backend. We always use cache to improve latency. There are several things worth thinking about more before we implement cache architecture. In this article, I want to briefly discuss some of that.</p><h2 id="how-much-data-should-be-stored-in-cache"><a href="#how-much-data-should-be-stored-in-cache" class="direct-link">#</a> How much data should be stored in cache</h2><p>Before implementing cache architecture, we have to estimate how much memory our cache needs. The 80/20 rule is the most common way to do that - 20% of objects are used 80% of the time. According to the 80/20 rule, we can cache 20% of data and improve 80% requests latency time.<br>For example. if there were 10M daily active users in the system and each user's metadata provided to fronted is 500k, then the size of our cache is about<br><code>500k * 10M * 0.2 = 100G</code><br>Currently, the maximum memory size of the VM of each Cloud platform is about 512G, so we could use just one VM to store our cache.<br>Besides that in some extreme cases, we may cache all data into memory to improve latency, we must clarify the scenario first before starting design.</p><h2 id="cache-cluster"><a href="#cache-cluster" class="direct-link">#</a> Cache cluster</h2><p>How if we figure out that we can not store cache data in barely one VM after estimating? Maybe we can use cache cluster like below:</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/genchilu/cache-strategy/cache-cluster-1920w.webp 1920w, /img/posts/genchilu/cache-strategy/cache-cluster-1280w.webp 1280w, /img/posts/genchilu/cache-strategy/cache-cluster-840w.webp 840w, /img/posts/genchilu/cache-strategy/cache-cluster-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/genchilu/cache-strategy/cache-cluster-1920w.png 1920w, /img/posts/genchilu/cache-strategy/cache-cluster-1280w.png 1280w, /img/posts/genchilu/cache-strategy/cache-cluster-840w.png 840w, /img/posts/genchilu/cache-strategy/cache-cluster-320w.png 320w" type="image/png"><img alt="" src="/img/posts/genchilu/cache-strategy/cache-cluster-1920w.png" height="341" width="308" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 308 341'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAYAAAA1BOUGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAdklEQVQImW2OzQoAIQiEe/83LIKgW3QoKvqjmkWX9rSCoH7jqDjngKLWilIK1601aK0hCFKOMTj33ogxQikFwVLgg1dAIe4ghADvPeacbGuMgaCC7hFwzjHIOUNK+W97n/we6r0zWGshpQRr7QvvJgmopzNk+wCKXNk8htituAAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>Generally, we use the hash function to find the mapping cache node. For example, we use request id as key, and use mod as hash function, we could find the mapping cache node as blow flow:</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/genchilu/cache-strategy/cash-native-hash-1-1920w.webp 1920w, /img/posts/genchilu/cache-strategy/cash-native-hash-1-1280w.webp 1280w, /img/posts/genchilu/cache-strategy/cash-native-hash-1-840w.webp 840w, /img/posts/genchilu/cache-strategy/cash-native-hash-1-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/genchilu/cache-strategy/cash-native-hash-1-1920w.png 1920w, /img/posts/genchilu/cache-strategy/cash-native-hash-1-1280w.png 1280w, /img/posts/genchilu/cache-strategy/cash-native-hash-1-840w.png 840w, /img/posts/genchilu/cache-strategy/cash-native-hash-1-320w.png 320w" type="image/png"><img alt="" src="/img/posts/genchilu/cache-strategy/cash-native-hash-1-1920w.png" height="261" width="291" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 291 261'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAYAAAA1WQxeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcElEQVQImW2N6wZGIRBFe/+XjEiKLrqISvvY0Tnfj2+zGWPNGrH3BsvUWk+Zuxe/ADPn/A/knJFSgvcevfcPuJcEqA8hHPBGjDGw1nq1nNlSClprENZaxBjPb+pZArRwL6SUcM4dgzEGWuszE1RK4QEqb9nk2K0/WQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>It's simple, but it also comes to some problems. If we have 3 cache nodes now, then the data distribution looks like this:</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/genchilu/cache-strategy/cash-native-hash-2-1920w.webp 1920w, /img/posts/genchilu/cache-strategy/cash-native-hash-2-1280w.webp 1280w, /img/posts/genchilu/cache-strategy/cash-native-hash-2-840w.webp 840w, /img/posts/genchilu/cache-strategy/cash-native-hash-2-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/genchilu/cache-strategy/cash-native-hash-2-1920w.png 1920w, /img/posts/genchilu/cache-strategy/cash-native-hash-2-1280w.png 1280w, /img/posts/genchilu/cache-strategy/cash-native-hash-2-840w.png 840w, /img/posts/genchilu/cache-strategy/cash-native-hash-2-320w.png 320w" type="image/png"><img alt="" src="/img/posts/genchilu/cache-strategy/cash-native-hash-2-1920w.png" height="131" width="462" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 462 131'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAECAYAAABREWWJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQImT2OywqFMAxE+/+/JnRdtCsVoaiIFW3tay4T8HYzzSRnErWuK7Ztw77vOM8TfNd1Se2cw3EcuO9bfP45S7XWQsUYMU0TvPd43xe1VoQQkFKSgNaa1PTZ/0LHcYRiwxgjaQQ+uJQiw4Sf5xE/5yyLCM7zDMWTtNZYluUPU3le13UCfiHUYRjQ971s/wFUcuTEbfSjSAAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>However, if we add one cache node to the cluster, then the data distribution will become like this:</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/genchilu/cache-strategy/cash-native-hash-3-1920w.webp 1920w, /img/posts/genchilu/cache-strategy/cash-native-hash-3-1280w.webp 1280w, /img/posts/genchilu/cache-strategy/cash-native-hash-3-840w.webp 840w, /img/posts/genchilu/cache-strategy/cash-native-hash-3-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/genchilu/cache-strategy/cash-native-hash-3-1920w.png 1920w, /img/posts/genchilu/cache-strategy/cash-native-hash-3-1280w.png 1280w, /img/posts/genchilu/cache-strategy/cash-native-hash-3-840w.png 840w, /img/posts/genchilu/cache-strategy/cash-native-hash-3-320w.png 320w" type="image/png"><img alt="" src="/img/posts/genchilu/cache-strategy/cash-native-hash-3-1920w.png" height="131" width="642" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 642 131'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAADCAYAAAB1c+RqAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhklEQVQImS2MSRKDMAwE+f/3SPlCuFIUtokM8SYvk7LIbUbT6slaC2MMnHMopcB7L11rLbn3DiKSPlhmFs6eJz7OQSmFaYD6OGTIOQuUUkIIQXJrTe6DizEKV2pF9B71uvCaZ0yBCLyuyMyPgBnQGt0YxL9kPH/3HfG+H0lrSETAtuG9LPgBNFvEESaHMC4AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>After adding one node to the cache cluster, we have to move 8 data to the mapping cache node, which makes scale up or down very suffer.</p><p>In order to minimize the number of data migration after cache cluster resizes, we can introduce consistent hashing to solve that problem.</p><blockquote><p>In this article we do not descripe how Consistent hashing work, you can see more detail in <a href="https://en.wikipedia.org/wiki/Consistent_hashing" rel="noopener noreferrer" target="_blank">wiki</a>。</p></blockquote><h2 id="replacement-policy"><a href="#replacement-policy" class="direct-link">#</a> Replacement policy</h2><p>Earlier we mention that in most scenarios, we would not store all data to cache. So we need one policy to determine which data should swap out if the capacity of the cache is full. That's the cache replacement policy. There are some common policies:</p><ul><li><a href="https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)" rel="noopener noreferrer" target="_blank">First in first out(FIFO)</a>：Those data which are stored earlier are discarded first.</li><li><a href="https://en.wikipedia.org/wiki/Least_frequently_used" rel="noopener noreferrer" target="_blank">Least frequently used(LFU)</a>：Those data are used least often are discarded first.</li><li><a href="https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)" rel="noopener noreferrer" target="_blank">Least recently used (LRU)</a>：Those data that are not used recently are discarded first.</li></ul><p>Personally, I think LRU is most commonly used.</p><h2 id="update-policy"><a href="#update-policy" class="direct-link">#</a> Update policy</h2><p>Finally, let's talk about how to update the cache. There 3 policies to update cache:</p><ol><li>write-through： Update DB and cache at the same time. This policy provides a strong consistency between cache and DB. The disadvantage is that it would increase loading while writing data and is not recommended for the write-heavy scenario.</li><li>write around： While writing data we only update DB and invalid cache data. When we read data we update the cache simultaneously. The disadvantage is that there may be several cache misses at the very beginning of reading.</li><li>write back： While writing data we only update cache and write back to DB after an interval of time. This policy would improve latency and throughput in the write-heavy scenario. But the disadvantage is obvious: if the system crash before writing back, it may lose some data.</li></ol><h2 id="wrap-up"><a href="#wrap-up" class="direct-link">#</a> Wrap Up</h2><p>Cache exists in every level of system architecture, from hardware(CPU, Memory, and Disk), OS, Application to User fronted (Browser, app). <br>In This article, we discuss how to use the cache more efficiently in limited space, how to cluster for scalable, how to replace data, and how to update stale data. Through all these considerations, we can build our cache architecture more resilient, stable, efficient, and suitable for our system.</p><div class="article-footer"><a href="https://tech-blog.cymetrics.io/en/posts/genchilu/cache-strategy-en/" on-click="share"><img alt="Share" src="/img/icons/icon_external link hyperlink.svg" height="24" width="24">Share this post</a></div><div><p style="font-weight: bold;">Tag</p><div class="post-tags"><a href="/en/tags/postsen/" class="post-tag">#postsEn</a> <a href="/en/tags/back-end/" class="post-tag">#Back-end</a> <a href="/en/tags/cache/" class="post-tag">#cache</a> <a href="/en/tags/policy/" class="post-tag">#policy</a> <a href="/en/tags/strategy/" class="post-tag">#strategy</a> <a href="/en/tags/lru/" class="post-tag">#lru</a> <a href="/en/tags/consistency-hash/" class="post-tag">#consistency-hash</a></div><p style="font-weight: bold;">Recommendation</p><ol><li><a href="/en/posts/alice/solidiyDoS_en/">Decoding DoS Attacks in Solidity: Security Vulnerabilities and Prevention Strategies.</a></li><li><a href="/en/posts/ava/workflow-process-en/">From Start to Finish:A Deep Dive into How Cymetrics Manages Product Development Process</a></li><li><a href="/en/posts/seadog007/supply-chain-attack/">What is Supply Chain Attack?</a></li><li><a href="/en/posts/nick/exchange_en/">How to Choose a Safe Exchange</a></li><li><a href="/en/posts/huli/amelia-wordpress-plugin-sensitive-data-exposure-detail/">Sensitive Data Disclosure in WordPress Plugin Amelia &lt; 1.0.49</a></li></ol></div><div class="article-author"><img alt="genchilu" src="/img/authors/genchilu_logo.jpeg" class="article-author__img" data-deopt="true"><div class="article-author__info"><div class="article-author__title">Author</div><div class="article-author__author"><a href="/en/posts/genchilu">genchilu</a></div><div class="article-author__intro">I am Genchi, a backend engineer in Taiwan.</div></div></div><p style="font-weight: bold;">Discussion(login required)</p><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" id="utterance-script" issue-term="title" label="utterance" repo="cymetrics/blog" theme="github-light"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Cache Strategy In Backend","image":["https://tech-blog.cymetrics.io/img/posts/genchilu/cache-strategy/cache-cluster-1920w.png","https://tech-blog.cymetrics.io/img/posts/genchilu/cache-strategy/cash-native-hash-1-1920w.png","https://tech-blog.cymetrics.io/img/posts/genchilu/cache-strategy/cash-native-hash-2-1920w.png","https://tech-blog.cymetrics.io/img/posts/genchilu/cache-strategy/cash-native-hash-3-1920w.png","https://tech-blog.cymetrics.io/img/icons/icon_external link hyperlink.svg","https://tech-blog.cymetrics.io/img/authors/genchilu_logo.jpeg"],"author":{"@type":"Person","name":"genchilu"},"publisher":{"@type":"Organization","name":"Cymetrics Tech Blog","url":"https://tech-blog.cymetrics.io","logo":{"@type":"ImageObject","url":"https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png","width":512,"height":512}},"url":"https://tech-blog.cymetrics.io/en/posts/genchilu/cache-strategy-en/","mainEntityOfPage":"https://tech-blog.cymetrics.io/en/posts/genchilu/cache-strategy-en/","datePublished":"2022-01-25","dateModified":"2025-06-04","description":"Cache is one of the most important parts of the backend. We always use cache to improve latency. There are several things worth thinking..."}</script></article></main><footer><div class="footer-logos"><a href="https://www.facebook.com/cymetrics" rel="noopener noreferrer" target="_blank"><img alt="facebook" src="/img/icons/icon_social media_facebook.svg" height="30" width="30"></a><a href="https://www.linkedin.com/company/cymetrics" rel="noopener noreferrer" target="_blank"><img alt="linkedin" src="/img/icons/icon_social media_linkedln.svg" height="30" width="30"></a><a href="https://tech-blog.cymetrics.io/feed/feed.xml" rel="noreferrer noopener" target="_blank"><img alt="rss feed" src="/img/icons/rss-feed.svg" height="30" width="30"></a></div><div class="copyright">© 2021 Cymetrics Tech Blog, based on <a href="https://github.com/google/eleventy-high-performance-blog" rel="noopener noreferrer" target="_blank">eleventy-high-performance-blog</a>. <a href="https://oneinfinity.global/" rel="noopener noreferrer" target="_blank">OneInfinity</a></div></footer><script>const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })</script></body></html>