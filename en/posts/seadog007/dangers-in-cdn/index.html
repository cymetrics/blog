<!DOCTYPE html><html domain="tech-blog.cymetrics.io" ga-id="G-3VBVCXV9Z0" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="CYBER,Cymetrics,Security" name="keywords"><link href="/img/favicon/favicon-192x192.png?hash=42b087227d" rel="icon" type="image/png"><meta content="#5789d3" name="theme-color"><title>The Hidden Dangers of CDNs: Why CDNs May Not Be as Secure as You Think</title><meta content="The Hidden Dangers of CDNs: Why CDNs May Not Be as Secure as You Think" property="og:title"><meta content="The Hidden Dangers of CDNs: Why CDNs May Not Be as Secure as You Think" name="twitter:title"><meta content="summary_large_image" name="twitter:card"><meta content="Content distribution networks (CDNs) are an important part of the modern Internet, providing fast and reliable connections and network resources to users around the world. However, while CDNs offer many benefits, they also introduce new security risks that many people may not be aware of. In this article, we'll explore the hidden dangers of CDNs and examine why CDNs may not be as secure as you think. Explore how to protect yourself and your business from these potential security risks that CDNs might introduce. This article will help you better understand the potential risks involved with CDNs and how to mitigate them." name="description"><meta content="Content distribution networks (CDNs) are an important part of the modern Internet, providing fast and reliable connections and network resources to users around the world. However, while CDNs offer many benefits, they also introduce new security risks that many people may not be aware of. In this article, we'll explore the hidden dangers of CDNs and examine why CDNs may not be as secure as you think. Explore how to protect yourself and your business from these potential security risks that CDNs might introduce. This article will help you better understand the potential risks involved with CDNs and how to mitigate them." name="twitter:description"><meta content="Content distribution networks (CDNs) are an important part of the modern Internet, providing fast and reliable connections and network resources to users around the world. However, while CDNs offer many benefits, they also introduce new security risks that many people may not be aware of. In this article, we'll explore the hidden dangers of CDNs and examine why CDNs may not be as secure as you think. Explore how to protect yourself and your business from these potential security risks that CDNs might introduce. This article will help you better understand the potential risks involved with CDNs and how to mitigate them." property="og:description"><meta content="article" property="og:type"><meta content="https://tech-blog.cymetrics.io/en/posts/seadog007/dangers-in-cdn/" property="og:url"><meta content="Cymetrics Tech Blog" property="og:site_name"><meta content="https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cover_en.png" property="og:image"><meta content="https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cover_en.png" name="twitter:image"><meta content="hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk" name="google-site-verification"><link href="https://tech-blog.cymetrics.io/en/posts/seadog007/dangers-in-cdn/" rel="canonical"><meta content="always" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Cymetrics Tech Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=7f26b2ece8" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3VBVCXV9Z0"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3VBVCXV9Z0');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}body,figure{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b{font-weight:700}code{overflow-x:auto;border-radius:.3em;color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden]{display:none}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}h3{font-size:2em;line-height:1.125;margin-bottom:.75em;font-size:1.4rem}h4{font-size:1.5em;margin-bottom:1em;line-height:1.5em}body,ol,p,ul{font-size:1em}form,ol,p,ul{margin-bottom:1.5em}h3,h4{line-height:1.5rem;margin-bottom:1rem}h4{font-size:1.2rem}body,ol,p,ul{font-size:1rem;line-height:1.6}ol,p,ul{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}h3{font-size:1.7989rem;line-height:2rem}h4{font-size:1.3554rem;line-height:1.56rem;margin-bottom:1.296rem}body,ol,p,ul{font-size:1.1rem;line-height:1.6}h2,h3,ol,p,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:2.05rem}h3{font-size:1.5rem}h4{font-size:1.15rem;line-height:1.42rem;margin-bottom:1.2rem}body,ol,p,ul{font-size:1.2rem;line-height:1.6}h2,h3,ol,p,ul{margin-bottom:1.632rem}}h1,h2,h3,h4{font-family:var(--font-family)}a:hover{text-decoration:underline}form{padding:1.5em 1.5em 0;border:.2rem solid #202020}button{border-radius:.3em;max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button+label,label+*{page-break-before:always}button,label{display:inline-block}form>:not(fieldset){margin-right:.75em}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}figure img,header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ol,ul{margin-top:0}header nav .nav-title{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ol,li ul{margin-bottom:0}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.w-full{width:100%}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}.post,footer{border-top:1px solid #ccc}.post{padding-top:35px;margin-top:35px}.menu__btn{display:inline-block;width:24px;height:24px;position:relative}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav,#nav .nav-title{display:flex;align-items:center}#nav{position:relative;height:68px;z-index:2}#nav .nav-title{padding:.375rem 1.5rem;width:100%;justify-content:space-between}#nav .nav-title *,.article-footer img{margin:0}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}.nav-logo{width:260px;height:40px;background:url(/img/logo1.png) no-repeat center center;background-size:contain}footer{margin-top:48px;font-size:14px;padding:24px;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.direct-link{display:none}.post-avatar{margin-top:27px;display:flex;align-items:center;height:36px}.post-avatar__img{width:36px;height:36px;overflow:hidden;margin:0;border-radius:50%}.post-avatar__time{font-size:13px}.post-avatar__info{margin-left:8px;color:#747474;text-align:left}.post-avatar__author{font-size:14px;font-weight:700}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}.article-author{margin-top:34px;display:flex;align-items:flex-start;margin-bottom:48px}.article-author__img{width:80px;height:80px;overflow:hidden;margin:0;border-radius:50%;flex-shrink:0}.article-author__info{margin-left:16px;text-align:left}.article-author__title{color:#747474;font-size:16px}.article-author__author{font-size:22px;font-weight:700;line-height:1em}.article-author__intro{color:#2f2f2f;margin-top:8px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav-logo{width:313px}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id="nav"><div class="nav-title"><a href="/en" class="nav-logo" title="Homepage"></a> <label class="menu__btn" for="menu__control"><span>Menu</span></label></div><div class="nav__links"><a href="/en/archive/">Archive</a> <a href="/en/tags/">Tags</a> <a href="/en/about/">About</a> <a href="/" style="white-space:nowrap;">中文</a></div></div><div id="reading-progress" aria-hidden="true"></div></nav><h1 class="w-full">The Hidden Dangers of CDNs: Why CDNs May Not Be as Secure as You Think</h1><aside class="w-full"><div class="post-tags"><a href="/en/tags/postsen/" class="post-tag">#postsEn</a> <a href="/en/tags/security/" class="post-tag">#Security</a> <a href="/en/tags/cdn/" class="post-tag">#CDN</a> <a href="/en/tags/cloud/" class="post-tag">#Cloud</a> <a href="/en/tags/internet/" class="post-tag">#Internet</a> <a href="/en/tags/network/" class="post-tag">#Network</a> <a href="/en/tags/networking/" class="post-tag">#Networking</a></div><div class="post-avatar"><img alt="seadog007" src="/img/authors/seadog007_logo.png" class="post-avatar__img" data-deopt="true"><div class="post-avatar__info"><div class="post-avatar__author"><a href="/en/posts/seadog007">seadog007</a></div><div class="post-avatar__time">15 Jun 2023</div></div></div></aside><dialog id="message"></dialog></header><main><article><div id="post-page"></div><p>Content distribution networks (CDNs) are an important part of the modern Internet, providing fast and reliable connections and network resources to users around the world. However, while CDNs offer many benefits, they also introduce new security risks that many people may not be aware of. In this article, we'll explore the hidden dangers of CDNs and examine why CDNs may not be as secure as you think. Explore how to protect yourself and your business from these potential security risks that CDNs might introduce. This article will help you better understand the potential risks involved with CDNs and how to mitigate them.</p><h2 id="what-is-cdn%3F"><a href="#what-is-cdn%3F" class="direct-link">#</a> What is CDN?</h2><p>CDN stands for Content Delivery Network or Content Distribution Network.</p><p>Many companies have written a detailed introduction to CDNs, such as Cloudflare, which is a major player in CDNs, has done a detailed introduction</p><ul><li>What is CDN?](<a href="https://www.cloudflare.com/zh-tw/learning/cdn/what-is-a-cdn/" rel="noopener noreferrer" target="_blank">https://www.cloudflare.com/zh-tw/learning/cdn/what-is-a-cdn/</a>)</li></ul><p>Here to briefly introduce, CDN is basically a group of servers placed in different places, these servers provide nearby users access to relevant web pages, in order to achieve a variety of different functions.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cdn_cf-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/cdn_cf-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/cdn_cf-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/cdn_cf-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cdn_cf-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/cdn_cf-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/cdn_cf-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/cdn_cf-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/cdn_cf-1920w.png" height="2834" width="5667" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 5667 2834'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAIAAAAcxIEBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkklEQVQImTXKuw6CMBgGUN7/nVwMDhqNEEEoLcjgjSC1hba0/xcTQ6LLmU4kLApNqcS+p0QSt2AGuaZcUzlBOETCIhkQN++ks3wK6eDjW1i1i5mi2iGqHRr/ybqRvXSl3Lq1u8e8uYaTpIvHbzBluQnbuy/HcHi6Y+9rh1QSm/6jGAzTc65IOHCLyoAbnBVVZhlf5fSWvjtOs5QAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture><br>(Source: <a href="https://www.cloudflare.com/zh-tw/learning/cdn/what-is-a-cdn/" rel="noopener noreferrer" target="_blank">Cloudflare Blog</a>)</p><h3 id="why-use-cdn%3F"><a href="#why-use-cdn%3F" class="direct-link">#</a> Why use CDN?</h3><p>"Can't we just use our own server and let users connect directly? Why do we need a CDN?"<br>You might think so, but in reality, CDNs have become the norm on larger sites because of the amount of resources they have and the different features they offer.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cdn_benifit-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/cdn_benifit-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/cdn_benifit-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/cdn_benifit-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cdn_benifit-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/cdn_benifit-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/cdn_benifit-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/cdn_benifit-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/cdn_benifit-1920w.png" height="896" width="2124" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 2124 896'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAYAAABxeg0vAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAx0lEQVQImSWN20rDQABE8/v2P9QHoQQUtKCCSCjFK9ZWeom0iaCmLdlssrekzZGN8zbDOUygjMbWjmgY8T4Z43M1uOT55YkDLYvlnN9NhnEWzwbaGrRzhBcD7ocP7IGz/jl30aiTR4+vxKuU5rD/FyqtELJAWdeJvjdti3F1t9umQRlDXgi0F9ZpwvXtTXeZfKUcn55ga8sqWdMPQ2Ql8cxRr0dRlgTbXDCLUypj+M52vE2XSKXIdjnjjxhRVvxsciazT7ZC8gelityVlvcNjAAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>For example, because the servers and network nodes placed by CDN vendors exist all over the world, the main function is to help users who purchase CDN services to save bandwidth on the original server. It can also receive DDoS traffic from that region and do the first layer of blocking.</p><p>Because of the wide distribution of CDN sites, CDNs can also provide lower connection latency for users in the corresponding area, improving connection speed.</p><p>Most CDNs also provide HTTPS Reverse Proxy service, which adds HTTPS protection to services that originally did not have HTTPS.</p><p>Some CDNs even provide WAF/IP rules protection, which can protect the hosts behind them from various malicious attacks. It can also help to prevent attackers from getting the original site IP.</p><h3 id="how-does-a-cdn-work%3F"><a href="#how-does-a-cdn-work%3F" class="direct-link">#</a> How does a CDN work?</h3><p>As I said earlier, a CDN is actually a set of servers around the world that forward requests back to the original site when users connect to them. If you draw a picture, it should be like this.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cdn_work-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/cdn_work-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/cdn_work-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/cdn_work-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cdn_work-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/cdn_work-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/cdn_work-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/cdn_work-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/cdn_work-1920w.png" height="852" width="1580" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1580 852'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQYlWNQdZrBp+W7iUfesYeh/Nx/Bhgo3vGfQdspmcHAp4QRxOcWlGZg0HTq0hZS8HI3sjPjnPniPxcbJ48mEyOD2v///5nkzGOYNJ0zwJo5eEUZGKwcQzi5uXk0rCPbxXNW/ZcQlVRQ4uXmkM1Z+lMwYfpLWTFlcwUGBgZDTj5xZgYd90l68kaZtv+LGBj+///PKCoqKi4mJia+8cl/xqzl/+XFlEzsGBgY4ti5BdkYeDgYWBkYGHRNguqki7f9l+LkFdZnYGDQrNn7XzC08xqvvIoOt6SEuDA7jwgDQ0paLpODozNHRKAb099//xlcXd04PDw82Z1L9jAkzXrLoKBjyyDAx8PAKyLLAACis0Bm0aJlGgAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h2 id="the-risks-introduced-by-cdns"><a href="#the-risks-introduced-by-cdns" class="direct-link">#</a> The Risks Introduced by CDNs</h2><p>The use of CDNs is not risk-free. After all, information on a website passes through the servers of CDNs before reaching the user, and these CDNs may provide some additional functionality. When a website is set up incorrectly, it may lead to some security risks. Such as</p><ul><li>Wrong IP logging method</li><li>Invalid Cache mechanism</li><li>Unexpected transport protocols</li><li>Bypassing blocking lists</li><li>Domain reputation impact</li></ul><p>Of course there are many more risks might be associated with CDNs, but for the limitation of this article, these are just five examples.</p><h3 id="1.-wrong-ip-logging-method"><a href="#1.-wrong-ip-logging-method" class="direct-link">#</a> 1. Wrong IP logging method</h3><p>Generally, the HTTP server records the IP address by using the Src IP field of the TCP socket.<br>However, if the request is forwarded from CDN today, the Src IP of the TCP scoket will become the source IP of the CDN server because the CDN server will be the source of the request to the origin, which will cause the origin server to record the wrong IP and lead to problems in the subsequent forensic investigation/event response/audit related process.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_wrong-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/ip_wrong-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/ip_wrong-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/ip_wrong-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_wrong-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/ip_wrong-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/ip_wrong-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/ip_wrong-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/ip_wrong-1920w.png" height="852" width="1580" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1580 852'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAACXBIWXMAABYlAAAWJQFJUiTwAAABE0lEQVQYlWNQdZ7Op+W3kUfesY+h8tJ/BhjIXP6fIX7me2a3+HY+R+8kwdDaPZwMmk6d2kIK3m4GNsacM57+52Lj4NFkYmJU+///P6NrzTHObA8fmSJne5309C5hBkuHIE4+Pn4dq4hW8dzV/8XFpBVV+Pm45XOX/xWIn/5KTtU0UJ2PX8zaMW4SO4OO+0R9BaM0x/8qDAz///9nEBcXlxQXl5C89v8/Y9by//IiCoZ2DAwMsQwMDKwMvBwMbAwMDLqmQfXSxdv+S3HyiegzMjBo1e77LxjaeY1PUd2AW0pKSlhC2YyRISomidnC0orf38uJGeQxOzs7HgcHB26HjMUMKfO/Mijo2DII8PEw8ArLMgAAAZlF7VApmfkAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>To solve this problem, CDN vendors usually insert a specific HTTP Header into the forwarded HTTP request to tell the actual client's IP to the origin server<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_http_header-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/ip_http_header-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/ip_http_header-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/ip_http_header-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_http_header-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/ip_http_header-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/ip_http_header-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/ip_http_header-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/ip_http_header-1920w.png" height="852" width="1580" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1580 852'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAACXBIWXMAABYlAAAWJQFJUiTwAAABGUlEQVQYlQEOAfH+ACVCmA4qTbAMHkGOAGmw/wBKR0IFP0BCCyIWAgk+UGoKRGGLDjpLZBJRfLwJAClCiisSIEpGMj42CJrp/wkICw4rBgUEKXGPvQo/XIUPOUFNHTc7QS1FYIgTADpBUwkODg8sOlmFF22s/xcWGiAjDgwJHmeb6BJWgsMmIjZTKAoPGDo6X5QHACxHkS4gMmZB/zoAAP///wAXFxgZGBgYGcT//wFnovggFSAxPQAAAFwAAAAFAA0JAAYAAAAuNFJ+G3S3/xoJDhQwAAAAKWmZ4BdEYo0YIScwDBoaGhMXJDgBAF1fZgM5OTsPT0pBAwAAAAA+Pj4MQEBAC0FtrwBUfLgAISw9ABAODAAOFB0Axp1BAKaHGmAAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>The CDN server in the above image uses the Real-IP header to tell the origin server the actual client's address in the forwarded request.</p><p>These default HTTP Header Names are actually well-known if you have used them, and fewer people will change them, e.g:</p><ul><li>Cloudflare: CF-Connecting-IP</li><li>Akamai: True-Client-IP</li><li>Cloudfront: CloudFront-Viewer-Address</li><li>Fastly: Fastly-Client-IP</li></ul><p>If an attacker knows the location of the origin server (e.g., by scanning the entire network), the attacker can send a request with a specific HTTP Header directly to the origin server, thereby achieving the effect of spoofing the IP and causing false records. Even Bypass related ACL settings.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_log_attack-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/ip_log_attack-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/ip_log_attack-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/ip_log_attack-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_log_attack-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/ip_log_attack-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/ip_log_attack-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/ip_log_attack-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/ip_log_attack-1920w.png" height="852" width="1580" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1580 852'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAACXBIWXMAABYlAAAWJQFJUiTwAAABEElEQVQYlWNQdZrOp+W7kVvesZeh7Mx/BhiIbD/JUHLkP5NzfAe/o0+KUETtHk4GLecuXWElXw9jOyPOyXf/c7Fx8mgwMTKoTjnyn801dRqvsYOvbKSDg15BRrcwA8N/sGmqltETxEt2/RcTFpdV4+HiUEyf+UQotOGguqJZsAaPgISVc+I0dgYLa2deB0c3CRNdFRFNUQZuC1NDDnsHZzbb6HbmzCV/FEQVDG0ZGBhiGBgYWBn09PQEdXV1NXT19BXjs2pYmJmZNRgYGJTjei+Ju6VMkFBQ0+eWkpISllK1YGQwMDBg1dfXF9TX1+cxMTFhUVZWFlBUVORzSZnMENJwgEFJ145BgI+HgU9ElgEAtF09lp+iSh0AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h4 id="mitigation"><a href="#mitigation" class="direct-link">#</a> Mitigation</h4><p>There are actually two methods to solve this situation</p><ul><li>Only Rewrite the requests from the CDN</li><li>Directly block all requests from non-CDN servers</li></ul><ol><li><p>if only the requests from CDN servers are rewritten, they will be logged to the correct IP as shown in the picture below. The disadvantage of this solution is that it is more difficult to implement and configure if you are not using a common Reverse Proxy (e.g. Nginx, Apache) to log the relevant IP<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_log_partial-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/ip_log_partial-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/ip_log_partial-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/ip_log_partial-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_log_partial-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/ip_log_partial-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/ip_log_partial-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/ip_log_partial-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/ip_log_partial-1920w.png" height="852" width="1580" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1580 852'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAACXBIWXMAABYlAAAWJQFJUiTwAAABEklEQVQYlWNQcZrOp+W7kVvesYeh7PR/BhiIaj/JUHzkP5NLQheflU+aUFDdAU4GLeduXWElP3djeyOO6Y//c7Fx8mgwMTKoTj70n805bSaPtWuwhIWti7pP3kJ+BiMGBkZmBgZ1i/BWyfwN/8WFxWXVeLg4FNNmPhEObTigrmQWosElIGltkzSLnSGjchXTpoPPmRkczjDYVV9lsDI3YrNzcGazie5gzln9X1ZYTt+agYEhkoGBgYXh//9fDP///2fgkHdgBLmVkZFRjYGBQTm256KEW3KfqpFTlIS2qbOyZ/4KDoaCggIGBwcHBiMjIwYVVVUGJSUlfnlZSV5D+2AGC5dwYzNbTwsLpwAzC5cwTQDQ6kXz9QGvgQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p></li><li><p>directly blocking non-CDN requests, this way is faster and better to set up, and you don't have to worry about two different situations (CDN/non-CDN traffic)<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_deny-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/ip_deny-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/ip_deny-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/ip_deny-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/ip_deny-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/ip_deny-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/ip_deny-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/ip_deny-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/ip_deny-1920w.png" height="852" width="1580" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1580 852'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAACXBIWXMAABYlAAAWJQFJUiTwAAABBklEQVQYlWNQcZrOp+W7kVvesYeh7PR/BhiIaj/FkLvrP5NLQieflU+aUFDdAU4GLeduXWElP3dje2OOqQ/+c7Fx8miwMTGqTdj5j90pdTq3tUuguIWti7pP3kJ+BiMGBkZmBgZ1i7BWycIt/8VFxWU1GFgZZBOWfeMPrd+nq2IVqcnJL25lnTSbnSGjchXThv1PmBmMFjG4PPrPAHLIc0NnyfTITikWYTk9VjZOOwYGhhgGBgZWhv//Ee5kZmCQZxBVVt1h6OFa41OoyMDAwCTCw8ErIysvzCOiyMgQExPDoK6uziAlIc4gKiYqKistL3FFQpNhSfYasAG8bEwMwiIiDIxADgD15zy8MkqZiQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p></li></ol><h3 id="2.-invalid-cache-mechanism"><a href="#2.-invalid-cache-mechanism" class="direct-link">#</a> 2. Invalid Cache Mechanism</h3><p>Most CDNs provide a cache mechanism so that the originating site will not keep receiving repeated requests and wasting traffic, but if the cache mechanism is set incorrectly, it may also cause security risks. Such as</p><ul><li>Malicious implantation of front-end backdoors (aka. cache poisoning)</li><li>Leaking user information</li></ul><h4 id="why-does-this-happen%3F"><a href="#why-does-this-happen%3F" class="direct-link">#</a> Why does this happen?</h4><p>The CDN determines whether a resource is to be cached or not, usually by using the file extension or the MIME type returned by the server. For example, Cloudflare is to use only the file extension to evaluate.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cf_default_cache-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/cf_default_cache-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/cf_default_cache-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/cf_default_cache-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cf_default_cache-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/cf_default_cache-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/cf_default_cache-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/cf_default_cache-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/cf_default_cache-1920w.png" height="350" width="1668" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1668 350'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAECAYAAABodtTSAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4klEQVQYlT2JTU+CAACGOTcvaa1JoKBb9uVIoyHF+BDBrV9QKLO6NPCMZqtDdegG/OOniVuHZ++e5xXu/HtG7pSrkVOhW37lA9NjeOtVfmMHHCk99upNaocStQOJptRCkluIkoxQpCHFckr+OiZPfMplSJFMyJMJZRpWXqYBv88WX7HJz8Lie25wrZ3TPTnl4rKP8PkS8r7wyR4ssshmNXPIHm3WM4dVtF2Xt7nLOrL5eArYxB6beIxp6OiGiTYYIqhnGkqvT11UdjTbFQ1R/W+NY5X9ba/+XZOVDkqni9xW+ANxiHWzoycZwQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>If your CDN only uses the file extensions as the criteria, this may lead to a situation where <code>/test.css?v=1</code> and <code>/test.css?v=2</code> may be different things on the original site, but return the same result after passing through the CDN.</p><p>CDNs usually have settings that can be changed to determine which features (e.g. HTTP Path/Query) should be used to determine if this is the same resource.</p><h4 id="case-study---chatgpt"><a href="#case-study---chatgpt" class="direct-link">#</a> Case Study - ChatGPT</h4><p>The ChatGPT server rewrites the HTTP Path incorrectly, resulting in <code>/session</code> and <code>/session/test.css</code> both pointing to the same API.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-1920w.png" height="604" width="1638" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1638 604'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAFCAYAAACeuGYRAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAm0lEQVQYlY2OSw7CMAxEk7CoqFCLlDSJ00/oJ2waqVfgCOy4/0kGxYIVGxZPI1sz9ojX84GUZlyHBCHEf6zbHeM4IoSAvh/gieC955mIWL+74uu6DiLnjOM4sOeMaZpgrWUDU8yfsHMOMUZQCBBaaxhjULRtW6ZpGlRVhXNd4yJPv/VKpXKhfFm3jZmXBTHe+CpZB6UUm6WUHHoDIx1PqoUMFd0AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>However, because ChatGPT uses the Cloudflare that uses the file extension to determine if a resource should be cached, this request for <code>/session/test.css</code> will be cached by the CDN. The attacker can do the following:</p><ol><li>send the link <code>chat.openai.com/api/auth/session/aaa.css</code> to the victim (or just spread it around for others to click)</li><li>when someone clicked the link, the CDN server will cache the response</li><li>the attacker can now access this link to get the ChatGPT Access Token of others</li></ol><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/chatgpt_hit-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/chatgpt_hit-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/chatgpt_hit-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/chatgpt_hit-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/chatgpt_hit-1920w.jpg 1920w, /img/posts/seadog007/dangers-in-cdn/chatgpt_hit-1280w.jpg 1280w, /img/posts/seadog007/dangers-in-cdn/chatgpt_hit-840w.jpg 840w, /img/posts/seadog007/dangers-in-cdn/chatgpt_hit-320w.jpg 320w" type="image/jpeg"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/chatgpt_hit-1920w.jpg" height="776" width="2106" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 2106 776'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAFCAIAAAAR2vFGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAxklEQVQImR3EawvBUBjA8eMF8yW80uxD8GVd3oxIIYnyQikpGubSctnB1NFczsyec4ZH/Pv1J6da1W01/HbdNw0AeFxvx2b90mnCoCf7XWnN34hCCGINx1tjQs2Fs1yxzfZMqW0uqTn3nIM8s8/Tx39kMzbs6exorRnds/3pfrlducdGfc+aCQEyFBKeUgQkSKpCTYWaFmraS1Uxk3Zte+e7Tsjv+OGI3h9BJYpxBZXY7xGCiQTPZV29wPU8lHWolIJyESrFLwhUmj/eCaXYAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture><br>(Source: <a href="https://twitter.com/naglinagli/status/1639351113571868673" rel="noopener noreferrer" target="_blank">https://twitter.com/naglinagli/status/1639351113571868673</a>)</p><h4 id="mitigation-2"><a href="#mitigation-2" class="direct-link">#</a> Mitigation</h4><ul><li>Set the Cache-related settings properly<ul><li>Very difficult</li><li>Check that the following settings are consistent on the CDN and the original site<ul><li>URL rewrites</li><li>Parameter</li></ul></li></ul></li><li>Use the frameworks to set the HTTP Cache-Control Header so CDN can cache properly.</li></ul><h3 id="3.-unexpected-transport-protocols"><a href="#3.-unexpected-transport-protocols" class="direct-link">#</a> 3. Unexpected transport protocols</h3><p>CDNs usually help you to enable some newer protocols that you may not be aware of, such as HTTP/2, HTTP/3, QUIC, IPv6, and so on.</p><p>Take IPv6 as an example, usually CDN will help you to enable IPv4 + IPv6 Dual Stack, so that people using two different IP protocols can connect to your website. The following figure shows the related configuration of Akamai Site Accelerator<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/akamai_v6-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/akamai_v6-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/akamai_v6-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/akamai_v6-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/akamai_v6-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/akamai_v6-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/akamai_v6-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/akamai_v6-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/akamai_v6-1920w.png" height="356" width="1606" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1606 356'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAECAYAAACHtL/sAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAaklEQVQYlY3OSw7CMBAEUd//mmERAZIt7Ik8nk8hXwCyeKpdq0trjTEk37VxPl9cU/EEi/zHVySl1so1Z9Yh7JFpjkaiHj+tSBcLSu+dtVaKXPQx8AgS7thHKcfx4NN7igiqirtjZnf47hc4d/rzDVITmgAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>However, there are CDNs that are turned on by default and cannot be turned off, such as Cloudflare<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cf_v6-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/cf_v6-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/cf_v6-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/cf_v6-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cf_v6-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/cf_v6-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/cf_v6-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/cf_v6-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/cf_v6-1920w.png" height="750" width="1224" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1224 750'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAo0lEQVQImU2Ou27DMBAE+f9/lNKNy1SxDbdKAkUwyTu+GQjSGFRh+IDBNrPYMyklrLX03tn3/cW2bYQQcOIZjhlCrZV1XXm/IbfWiLkQU8F474/maOWcKaWQciOXSq2FnAutdcyyLEzTxDzPOOdQVUT0yAORY9F4EUSVGBMhRlQDzgtexn+K9Urr/5jz9Y+Pz19Olweni+V899x+0ouvKfBtK08rhORsiXod6AAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>This may lead to unexpected errors in the application, or the associated ACL may be bypassed.</p><h4 id="case-study---popcat"><a href="#case-study---popcat" class="direct-link">#</a> Case Study - Popcat</h4><p>For those who don't know what <a href="https://popcat.click/" rel="noopener noreferrer" target="_blank">Popcat</a> is, here is a short introduction. Popcat is a click-based game that aggregates player clicks to the API and adds them to the leaderboard for the country the IP belongs to.</p><ul><li>Popcat is divided into two parts<ul><li>Front-end<ul><li>Returning the total number of clicks from the front-end to the API every 30 seconds</li></ul></li><li>API<ul><li>A request can only contain 800 clicks</li><li>Only one HTTP request for the same IP within 30 seconds</li></ul></li></ul></li></ul><p>Our purpose is obviously to get a bunch of IPs for our ranking. However, the game designer did not consider the IPv6 protocol at the beginning of the design, probably because his original host only has IPv4 support. After the game designer use Cloudflare as CDN, we can see that the DNS result actually has AAAA (IPv6) DNS records, which means we can use IPv6 to connect to this site.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/popcat_v6-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/popcat_v6-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/popcat_v6-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/popcat_v6-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/popcat_v6-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/popcat_v6-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/popcat_v6-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/popcat_v6-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/popcat_v6-1920w.png" height="578" width="1140" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1140 578'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAGCAYAAAAVMmT4AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmElEQVQYlVWPWw6EIAxF24iP+EARAj+6/0WxFriTa9SZ+WiaNL09p7LvO5xz1VqLvu9hjIGqQkSeKnfPchwH1nWty7JgnmeM43jVMAxo25bhcoezhBBgra3OOTDAvm0bSJymibPSdd338nmelVepQJUfhX+NGCPxlaimad7A466ql4aqZiHOGFO5yCfpeeORUkKMsVDVe58/h9dH4Dji9SAAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>We can get a large number of IPv6 locations in several ways</p><ul><li>With Own v6 Allocation</li><li>ISPs provided IPv6 Address</li><li>4in6 Tunnel</li></ul><p>More Details: <a href="https://hackmd.io/@seadog007/popcat" rel="noopener noreferrer" target="_blank">https://hackmd.io/@seadog007/popcat</a></p><h4 id="mitigation-3"><a href="#mitigation-3" class="direct-link">#</a> Mitigation</h4><p>There are two solutions to the mitigation the risks associated with the introduction of IPv6 in CDNs</p><ul><li>Disable the IPv6 feature of the CDN</li><li>Find a way to make the native application support it<ul><li>Non-self-developed systems may be a problem</li></ul></li></ul><h3 id="4.-bypassing-blocking-lists"><a href="#4.-bypassing-blocking-lists" class="direct-link">#</a> 4. Bypassing Blocking Lists</h3><p>CDNs often have a variety of built-in blocking lists to provide some compliance or easy firewall functionality.<br>For example, Akamai's built-in lists are divided into two types: IP and GEO<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/akamai_bl-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/akamai_bl-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/akamai_bl-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/akamai_bl-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/akamai_bl-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/akamai_bl-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/akamai_bl-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/akamai_bl-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/akamai_bl-1920w.png" height="634" width="1280" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1280 634'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAYAAACTphZWAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAk0lEQVQImT2N2wqEMBBD/f+PtItiZXVFpUw7l7RdnAcfQkIIJ8N32y3GtRFRBVDNzD3nXJm5qmpNKXk37PsPIXz6dV3dzFyA9ZxzV1VXKaUD6MMcN4QQ+nmezcyaqroTURORxsztvu8GoD3juiyLk5n5pT1kEfEupeSPw7xuZRxHmaZZYlzlOA5RVSEiKaW8GYD8ARWj02VC1TdTAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>Another example is Cloudflare's built-in Geo Firewall Policy, or the paid version of the IP List<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cf_rule-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/cf_rule-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/cf_rule-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/cf_rule-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cf_rule-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/cf_rule-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/cf_rule-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/cf_rule-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/cf_rule-1920w.png" height="612" width="790" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 790 612'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAYAAADam2dgAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAfElEQVQYlV2PCQpEIQxDvf9FRXDf9w7p8D/DFEKKtnkqWmtkraUQAnvvnVD33tdFKYVijLT35iH0uHDOUUqJzjkkcPC79QiJY4xvEhrvPeWcac7JWmtxAgSCqLWSlJKUUowzxjASS8DBeUhr/b7lH8s4DOFnQECIBxKopz40ZfXFyF41XwAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cf_bl-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/cf_bl-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/cf_bl-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/cf_bl-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/cf_bl-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/cf_bl-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/cf_bl-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/cf_bl-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/cf_bl-1920w.png" height="612" width="800" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 800 612'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAHCAYAAADam2dgAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAjUlEQVQYlT2OCwrEIAxEvf9JK42Gam39NMky2d0KDyGOLxNijLJtm+37obRXu65mrX2579twQs5ZiMiISFNKVkqx8zydWqs9z2OBiASDMYb23m2t9TLn9NtNOWdjZmVmN4wx/BEWEbHAzIL9vXdFBwxV1bu8oZSS/AyKPgCfYEIYhFKKmxD6rwEwwITiH9xo9AuUo51jAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>These features may help website operators in different scenarios, such as ITAR, OFAC region lists for compliance purposes, and some game operators use them to restrict the regions where games can access the API due to regional distribution needs.</p><p>However, if you study a little bit more, it is not difficult to find that different CDN vendors implement GeoIP in different ways: for example, Cloudflare uses Maxmind's DB to do IP country classification, while Akamai crawls IRRDB to the lowest level to determine the IP country (equivalent to whois).</p><p>What problems will this cause? We can use different ways to fake the IP location of the region, so that it is not the same as the actual IP usage area, and then bypass the relevant settings, we can also work with the IPv6 problem mentioned earlier in this article, to allow attackers to bypass the ACL set by the site at a very low cost.</p><h4 id="demo---akamai"><a href="#demo---akamai" class="direct-link">#</a> Demo - Akamai</h4><ol><li><p>We need to first take a >/48 segment of IPv6, such as the <code>2a0f:5707:ffa4::/46</code> IP segment used here<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_1-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_1-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_1-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_1-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_1-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_1-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_1-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_1-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/demo_v6_1-1920w.png" height="722" width="1512" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1512 722'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAYAAACTphZWAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAg0lEQVQImV2MMQ7DMAwD/f9XFd37gnbqHCexHUuWYYpFDCRDCRx4A6UQY8TJUQ9YN7RmGGPA3WFm0NagqtNDrUKpwjO9d6oqxxgEQBGZfiXknH0rh2+1OskbALM/768/Hy836x72bWcU4VLKvHb3mzOqjSXX+SOklLimxGVd78F/X/4DCY3Wbl17ZVkAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p></li><li><p>create a more specific inetnum6 whois data, where the Country field can be filled in by yourself<br>For example, here is an IP segment of /48<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_2-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_2-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_2-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_2-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_2-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_2-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_2-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_2-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/demo_v6_2-1920w.png" height="420" width="1676" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1676 420'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAECAYAAABREWWJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAiUlEQVQImY3JWw6CMABE0e5/Zwas0CIgFFr6gCVYE5wxkuin8ST3YzIipXVft21/I7kD+Dtxz5k5P/jxBAh8509CXiro5gqlNaZpQozxqOt63IYBMSWEEOC9R1XXGEeDECK8DxAnqSlVy6btOc+W1jouy0KtG5blmbO1dM4dX1GUlPLCWikaY/gC4qXgvlgsvhoAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p></li></ol><p>"Country: KP" specifies that this IP segment belongs to DPRK<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_3-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_3-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_3-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_3-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_3-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_3-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_3-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_3-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/demo_v6_3-1920w.png" height="792" width="696" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 696 792'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAYAAAA1BOUGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmklEQVQImU3N0W6EIBRFUf//C5to8aGAygUuY6VqxnE3OknT/bqScxoRoe97rLV8WYtzjqVWrhrvB7qu49MY2ralN4bXcbxRS0FiZN93wuPBoEpeV9bnkyYE4Zq+mlJGtBC1sN8owjzPN/rlm+Hn/XfPxhj/0IaEGSPH+Q9FIpwnLisfzuOnQF0qTUqJEALbtjGNIyVnVJVaK78MZ9TjAXom8gAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><ol start="3"><li>If we use this IP to connect to a CDN (such as Akamai) that uses IRRDB as the source of the GeoIP, we can now bypass the relevant blocking rules<br>Here you can also use the tool provided by Akamai to do GeoIP check<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_4-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_4-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_4-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_4-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_4-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_4-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_4-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_4-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/demo_v6_4-1920w.png" height="732" width="1492" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1492 732'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAYAAACTphZWAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVQImR2Lq04DQRhGB8KicDUYUsFNYDE0VSUBJIKEgELgELg6nmAR25QOYWEhGN6GlyjDpZ0dxLKzM93t/38kI445J0es7p3RzuEltXZPKNrYp5WtHi22u7Sw1qGldpei9R4tbx9RtHlA4vT8AjLNcJ+9YviQQT6+IJEp4oFEnIwQJ3e4HUiM0meI47d3Hn9PufwrGMwMIDCfN1xZyzPvuWnq4MRV/ITxh4JSCjrPURQFyrKEMQZTraHUJ4z5RV3XENf9G3z9TFBZi8o5OOdCsNaGSes8jN57/AMzWqiz0ci5EgAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></li></ol><p>By doing so, we can also create IP segments of other countries, like the Japanese segment that we can use to play Japanese games without worrying about being blocked from using VPNs.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_5-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_5-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_5-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_5-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/demo_v6_5-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/demo_v6_5-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/demo_v6_5-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/demo_v6_5-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/demo_v6_5-1920w.png" height="396" width="1596" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1596 396'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAECAYAAACHtL/sAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVQYlXWOywoEMQgE8/+/OmM0CWyc9dGLuc1hGwpaRagWEV8R8QLAISL+YmZORD7n9Mz09pgHM+O+CXMuVF9rITMRES9qZ2YgIlDvUFU0NY8xBpglRSSJKJk5e+dU1axExKFiZufWe8/P3tnU4hjUk4igqPm6bqg+L5Pq7n4MynjvjR9vkvho0jZU+wAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h4 id="demo---cloudflare"><a href="#demo---cloudflare" class="direct-link">#</a> Demo - Cloudflare</h4><p>If the CDN vendor is using an external GeoIP DB for the CDN, such as Cloudflare, we can work from the external DB<br>We know that the GeoIP DB used by Cloudflare is Maxmind, then we can found that Maxmind has a GeoIP correction form.<br><a href="https://www.maxmind.com/en/geoip-location-correction" rel="noopener noreferrer" target="_blank">https://www.maxmind.com/en/geoip-location-correction</a></p><p>Malicious attackers can also use this method to bypass the Geo type blocking list by modifying the specified IP to another country.</p><h4 id="mitigation-4"><a href="#mitigation-4" class="direct-link">#</a> Mitigation</h4><ul><li>Compare the GeoIP implementations used by various CDNs</li><li>Don't put too much faith in the GeoIP related rules of CDNs<ul><li>VPN, springboard, etc. may be used</li><li>The native IP address is the one that has been changed</li></ul></li></ul><h3 id="5.-domain-reputation-impact"><a href="#5.-domain-reputation-impact" class="direct-link">#</a> 5. Domain Reputation Impact</h3><p>To understand this weakness, first we need to understand the operation principle of HTTPS and HTTP Reverse Proxy.<br>First of all, a CDN server might be responsible for thousands of websites with one IP address, so users of these websites will all connect to the same server, and the CDN server will have to determine where the users want to go.</p><p>HTTP Reverse Proxy (CDN is also a kind of Reverse Proxy) uses the Host field in the HTTP Header to determine which website the user wants to connect to.</p><p>In the other hands, because HTTPS is protected by SSL/TLS, Reverse Proxy cannot see the HTTP Header before the SSL/TLS handshake is completed, so how can it determine which website the user wants to connect to? For this problem, Reverse Proxy uses the Server Name Indication (SNI) field in SSL/TLS Handshake to make the determination.</p><p>This is also how we can specify which HTTP site to connect to using <code>-H Host</code><br><code>curl -H 'Host: www.example.com' http://&lt;ip></code></p><p>However, HTTPS sites cannot be connected to by specifying the HTTP Header (unless it is the Default Server for that IP)<br><code>curl -H 'Host: www.example.com' https://&lt;ip></code><br>will likely to fail</p><p>We have to do this by using curl's --resolve parameter<br><code>curl --resolve www.example.com:443:&lt;ip> https://www.example.com</code></p><p>Many firewalls use the SNI as the criteria for determining HTTPS traffic.<br>So what happens if these two fields don't match? We use SNI "A" with HTTP Host "B". If the CDN Server is using SNI Prefer Forwarding, it will simply look at the SNI to decide which origin site to forward the request to.</p><p>But if the CDN is using Host Prefer Forwarding, at this time, the site you connect to with SNI A will see the content of site B, and then there may be a situation that attacker can use.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/fw_table-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/fw_table-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/fw_table-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/fw_table-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/fw_table-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/fw_table-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/fw_table-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/fw_table-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/fw_table-1920w.png" height="564" width="1330" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1330 564'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAYAAABxeg0vAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAn0lEQVQImS2O2xKDIAxE+f8PrIBVIIhVBBUvfd1OsA/JTHbm7IkInxFTnBHTguM6sZUd+1HqrPuGch41K/9b8DrvC3GJkFphyQmd6eE81SLO8rZCvltQGCC44fre1aC0Qlozur6DDwOm+QG4NLQa8xggWMevhBBAzsFaA2ctBu/hiPCSDVJOaJUEET0AWxjwRLDGVJAB8oRGyeelVlfrDwCM3iVwUFI7AAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>Because this issue has existed for some time, some CDNs have made corresponding fixes for this issue, and in the case of inconsistent SNI and Host Header, the response from each CDN probably looks like this</p><ul><li>Cloudflare: 403</li><li>Cloudfront: 403</li><li>Akamai: 503 or 400</li><li>Fastly: Host Prefer Forwarding</li></ul><p>Fastly does not have proper blocking and prevention, we can use this to achieve an attack called Domain Fronting. In a worse case, if the CDN does not check the ownership of the domain when adding the domain, we can add a domain with any name to do the forwarding, which can also bypass the detection in an environment with SSL Inspection.</p><p>For example, we can add a domain called <a href="http://there-is-no-way.this.exist.com" rel="noopener noreferrer" target="_blank">there-is-no-way.this.exist.com</a> to Fastly, and when browsing in an environment with SSL Inspection, the HTTP Header we see will be this Domain.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/fastly_1-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/fastly_1-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/fastly_1-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/fastly_1-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/fastly_1-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/fastly_1-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/fastly_1-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/fastly_1-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/fastly_1-1920w.png" height="350" width="1638" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1638 350'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAECAYAAABodtTSAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtklEQVQYlZWIy2rCQABF832+BSFtNaY+sN316wpKfIIgfkPVmXHizCSbClV36SlVUFx64XAuxyuE79R6H5TCN3J+k2rQJecHFJ9fyftNCk8h5Xqb0kvr/CuNzplqcPF/86LJlM9BxHAyYzAc049GzBdLxDbmayNZCcVK3LyW6sqlKbz9/htnLYlzWGuIY83h8MMj87ZaE+92OOdIkgRjDGmaYqxFSolSio0QaK05Hk/8AlmW3fEHZoXgFsFuFh4AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h4 id="demonstration"><a href="#demonstration" class="direct-link">#</a> Demonstration</h4><p>We first added a domain <code>www.president.gov.tw</code> to Fastly, and we know that <code>bbc.com</code> is using Fastly's service, so we can curl to access this site.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/fastly_2-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/fastly_2-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/fastly_2-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/fastly_2-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/fastly_2-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/fastly_2-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/fastly_2-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/fastly_2-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/fastly_2-1920w.png" height="362" width="1602" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1602 362'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAECAYAAACHtL/sAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdklEQVQYlZ2OywpDIQwFg1xfoCY+FiL6/z8ZTFFoN4UuuhgmDFkcqLWy956PiYitteycY0TkEML16YeU0v097Q0AgNRahYjk3H8AUkrZiLiVUvt5ng9a62sA+AVIjHHnnGXOKb13aa3JGEPWWrch4l1ojPla8AIfHUXALd+6rwAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>At this point the various inspection mechanisms will appear to look like this</p><ul><li>SSL Inspection (HTTP Host Header): <a href="http://www.president.gov.tw" rel="noopener noreferrer" target="_blank">www.president.gov.tw</a></li><li>SNI Inspection: <a href="http://bbc.com" rel="noopener noreferrer" target="_blank">bbc.com</a></li><li>IP Firewall: 151.101.64.81 (AS54113 / Fastly, Inc.)</li><li>Content: 103.147.22.128:80 (not realted with the above at all)</li></ul><p>The actual location of this content will not be visible to any inspection mechanism on the client side because it uses the feature of CDN to hide the IP of the original site, which makes it more difficult to identify and block malicious attacks.</p><h4 id="case-study---china-apt"><a href="#case-study---china-apt" class="direct-link">#</a> Case Study - China APT</h4><p>China APT has used <a href="http://pypi.python.org" rel="noopener noreferrer" target="_blank">pypi.python.org</a> as a fronting domain, and the various client-side blocking mechanisms would look like this</p><ul><li>DNS: Query for <a href="http://pypi.python.org" rel="noopener noreferrer" target="_blank">pypi.python.org</a></li><li>IP Based Firewall: Connect for Fastly (<a href="http://151.xxx.xxx.xxx" rel="noopener noreferrer" target="_blank">151.xxx.xxx.xxx</a>)</li><li>SNI Check: <a href="http://pypi.python.org" rel="noopener noreferrer" target="_blank">pypi.python.org</a></li></ul><p>Almost every check mechanism is bypassed, the below is related Cobalt Strike Beacon Profile looks like<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/china_apt-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/china_apt-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/china_apt-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/china_apt-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/china_apt-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/china_apt-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/china_apt-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/china_apt-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/china_apt-1920w.png" height="430" width="1552" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1552 430'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAECAYAAABREWWJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAn0lEQVQImVWOsW7CQBQE/TkR9u69OzA+u8I+2pSho6emI+HTT28jHIRIMRptNduM41RzztXMKoBK8uXdNFWk9Np8+I1mKUWlFMUYBUAkV4NB5zHrE50+ALXkP0CqKcejz4eDm5mTXAHgDMFP2+Rf0Tx3nQ+bjQ/tH/u2dQLezPOsZVnU9/1a5aP6fHBJSffdVt8WdAvUTzTdLegaKAP0C/TVYI7Rl5IRAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture><br>(Source: [Hiding in Plain Sight: Obscuring C2s by Abusing CDN Services](<a href="https://teamt5.org/en/posts/hiding-in-plain-sight-obscuring-c2s-by-" rel="noopener noreferrer" target="_blank">https://teamt5.org/en/posts/hiding-in-plain-sight-obscuring-c2s-by-</a> abusing-cdn-services/))</p><h4 id="impact"><a href="#impact" class="direct-link">#</a> Impact</h4><p>This issue affects the reputation of domains such as <a href="http://bbc.com" rel="noopener noreferrer" target="_blank">bbc.com</a>, which looks like this on Virustotal. The impact on the reputation of domains may result in emails being rejected or some users not being able to connect.<br><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/bbc_virus-1920w.webp 1920w, /img/posts/seadog007/dangers-in-cdn/bbc_virus-1280w.webp 1280w, /img/posts/seadog007/dangers-in-cdn/bbc_virus-840w.webp 840w, /img/posts/seadog007/dangers-in-cdn/bbc_virus-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/seadog007/dangers-in-cdn/bbc_virus-1920w.png 1920w, /img/posts/seadog007/dangers-in-cdn/bbc_virus-1280w.png 1280w, /img/posts/seadog007/dangers-in-cdn/bbc_virus-840w.png 840w, /img/posts/seadog007/dangers-in-cdn/bbc_virus-320w.png 320w" type="image/png"><img alt="" src="/img/posts/seadog007/dangers-in-cdn/bbc_virus-1920w.png" height="768" width="1224" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1224 768'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAk0lEQVQImUWO4QoCMQyD7/2fU4UTbm1vbq1dt8h2ioHQ/ghfsqlqJ+bOIt3MekQse2t9Kr7ezAzEDKsVWitETpRSQMQwe+OnGRws5wjV0dwHEY+cX+M40roRMdzbWEQWgZuiuYNZUGrFkdL6c86oqosI4n9wVtfvBFVD7/2qVlUkIrhewUmaxH1/4nZ/4MwZrTV8AOiR6GgkweUrAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h4 id="mitigation-5"><a href="#mitigation-5" class="direct-link">#</a> Mitigation</h4><p>For this kind of problem, basically, CDN users can only do limited things, they can only choose a good CDN vendor, or try to convince them to fix the problem.</p><h2 id="conclusion"><a href="#conclusion" class="direct-link">#</a> Conclusion</h2><p>After reading this article, do you think using a CDN is really bad? Of course this talk and this article are not meant to tell people not to use CDNs. In most cases, the benefits of using CDNs exceed the drawbacks of using CDNs significantly.</p><p>CDNs offer more protection for site administrators, but CDN customers still need to check the Best Practices Guide for CDNs and compare different CDN vendors. Finally, don't put too much trust in the features offered by CDNs, as they may cause the original site to malfunction or introduce weaknesses.</p><p>Feel free to leave a comment or contact <a href="https://cymetrics.io/en/" rel="noopener noreferrer" target="_blank">Cymetrics</a> directly for assistance with any security-related questions.</p><div class="article-footer"><a href="https://tech-blog.cymetrics.io/en/posts/seadog007/dangers-in-cdn/" on-click="share"><img alt="Share" src="/img/icons/icon_external link hyperlink.svg" height="24" width="24">Share this post</a></div><div><p style="font-weight: bold;">Tag</p><div class="post-tags"><a href="/en/tags/postsen/" class="post-tag">#postsEn</a> <a href="/en/tags/security/" class="post-tag">#Security</a> <a href="/en/tags/cdn/" class="post-tag">#CDN</a> <a href="/en/tags/cloud/" class="post-tag">#Cloud</a> <a href="/en/tags/internet/" class="post-tag">#Internet</a> <a href="/en/tags/network/" class="post-tag">#Network</a> <a href="/en/tags/networking/" class="post-tag">#Networking</a></div><p style="font-weight: bold;">Recommendation</p><ol><li><a href="/en/posts/seadog007/supply-chain-attack/">What is Supply Chain Attack?</a></li><li><a href="/en/posts/nick/backup_en/">Basic Awareness of Hacking Prevention：Backup and Restore</a></li><li><a href="/en/posts/huli/bsides-ahmedabad-ctf-2021-entrance/">BSides Ahmedabad CTF 2021 - entrance</a></li><li><a href="/en/posts/genchilu/javas-thread-model-and-golang-goroutine-en/">Java’s Thread Model and Golang Goroutine</a></li><li><a href="/en/posts/genchilu/the-difference-between-java-and-golang-in-writing-concurrent-code-to-access-shared-variable-en/">The Difference Between Java and Golang in Writing Concurrent Code to Access Shared Variable</a></li></ol></div><div class="article-author"><img alt="seadog007" src="/img/authors/seadog007_logo.png" class="article-author__img" data-deopt="true"><div class="article-author__info"><div class="article-author__title">Author</div><div class="article-author__author"><a href="/en/posts/seadog007">seadog007</a></div><div class="article-author__intro"></div></div></div><p style="font-weight: bold;">Discussion(login required)</p><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" id="utterance-script" issue-term="title" label="utterance" repo="cymetrics/blog" theme="github-light"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"The Hidden Dangers of CDNs: Why CDNs May Not Be as Secure as You Think","image":["https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cdn_cf-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cdn_benifit-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cdn_work-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/ip_wrong-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/ip_http_header-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/ip_log_attack-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/ip_log_partial-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/ip_deny-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cf_default_cache-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/chatgpt_tweet-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/chatgpt_hit-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/akamai_v6-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cf_v6-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/popcat_v6-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/akamai_bl-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cf_rule-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/cf_bl-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/demo_v6_1-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/demo_v6_2-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/demo_v6_3-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/demo_v6_4-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/demo_v6_5-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/fw_table-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/fastly_1-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/fastly_2-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/china_apt-1920w.png","https://tech-blog.cymetrics.io/img/posts/seadog007/dangers-in-cdn/bbc_virus-1920w.png","https://tech-blog.cymetrics.io/img/icons/icon_external link hyperlink.svg","https://tech-blog.cymetrics.io/img/authors/seadog007_logo.png"],"author":{"@type":"Person","name":"seadog007"},"publisher":{"@type":"Organization","name":"Cymetrics Tech Blog","url":"https://tech-blog.cymetrics.io","logo":{"@type":"ImageObject","url":"https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png","width":512,"height":512}},"url":"https://tech-blog.cymetrics.io/en/posts/seadog007/dangers-in-cdn/","mainEntityOfPage":"https://tech-blog.cymetrics.io/en/posts/seadog007/dangers-in-cdn/","datePublished":"2023-06-15","dateModified":"2023-08-01","description":"Content distribution networks (CDNs) are an important part of the modern Internet, providing fast and reliable connections and network..."}</script></article></main><footer><div class="footer-logos"><a href="https://www.facebook.com/cymetrics" rel="noopener noreferrer" target="_blank"><img alt="facebook" src="/img/icons/icon_social media_facebook.svg" height="30" width="30"></a><a href="https://www.linkedin.com/company/cymetrics" rel="noopener noreferrer" target="_blank"><img alt="linkedin" src="/img/icons/icon_social media_linkedln.svg" height="30" width="30"></a><a href="https://tech-blog.cymetrics.io/feed/feed.xml" rel="noreferrer noopener" target="_blank"><img alt="rss feed" src="/img/icons/rss-feed.svg" height="30" width="30"></a></div><div class="copyright">© 2021 Cymetrics Tech Blog, based on <a href="https://github.com/google/eleventy-high-performance-blog" rel="noopener noreferrer" target="_blank">eleventy-high-performance-blog</a>. <a href="https://oneinfinity.global/" rel="noopener noreferrer" target="_blank">OneInfinity</a></div></footer><script>const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })</script></body></html>