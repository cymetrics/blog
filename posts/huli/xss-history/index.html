<!DOCTYPE html><html domain="tech-blog.cymetrics.io" ga-id="G-3VBVCXV9Z0" lang="zh-TW"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="CYBER,Cymetrics,Security" name="keywords"><link href="/img/favicon/favicon-192x192.png?hash=42b087227d" rel="icon" type="image/png"><meta content="#5789d3" name="theme-color"><title>XSS å¾é ­è«‡èµ·ï¼šæ­·å²èˆ‡ç”±ä¾†</title><meta content="XSS å¾é ­è«‡èµ·ï¼šæ­·å²èˆ‡ç”±ä¾†" property="og:title"><meta content="XSS å¾é ­è«‡èµ·ï¼šæ­·å²èˆ‡ç”±ä¾†" name="twitter:title"><meta content="summary_large_image" name="twitter:card"><meta content="é€™ç¯‡åŸæœ¬æƒ³å¯«çš„æ˜¯ XSS çš„åŸºç¤ï¼Œå°±å¤§å®¶éƒ½è½éçš„é‚£ä¸‰ç¨®é¡åˆ¥ï¼šStored(Persistent)ã€Reflected(Non-Persistent) ä»¥åŠ DOM-based XSSï¼Œä½†ç•¶æˆ‘æ­£è¦é–‹å§‹å¯«çš„æ™‚å€™ï¼Œè…¦ä¸­çªç„¶æµ®ç¾äº†å¹¾å€‹å•é¡Œï¼šã€ŒXSS æ˜¯ä»€éº¼æ™‚å€™å‡ºç¾çš„ï¼Ÿé€™ä¸‰ç¨®é¡åˆ¥åˆæ˜¯ä»€éº¼æ™‚å€™é–‹å§‹è¢«åˆ†é¡çš„ï¼Ÿã€å› æ­¤ï¼Œæˆ‘èŠ±äº†é»æ™‚é–“æ‰¾äº†ä¸€äº›è³‡æ–™ï¼Œé€™ç¯‡æ–‡ç« æœƒè·Ÿå¤§å®¶è«‡è«‡ XSS çš„æ­·å²ï¼Œè®“æˆ‘å€‘ä¸€èµ·æ›´äº†è§£ XSS çš„å‰ä¸–ä»Šç”Ÿã€‚" name="description"><meta content="é€™ç¯‡åŸæœ¬æƒ³å¯«çš„æ˜¯ XSS çš„åŸºç¤ï¼Œå°±å¤§å®¶éƒ½è½éçš„é‚£ä¸‰ç¨®é¡åˆ¥ï¼šStored(Persistent)ã€Reflected(Non-Persistent) ä»¥åŠ DOM-based XSSï¼Œä½†ç•¶æˆ‘æ­£è¦é–‹å§‹å¯«çš„æ™‚å€™ï¼Œè…¦ä¸­çªç„¶æµ®ç¾äº†å¹¾å€‹å•é¡Œï¼šã€ŒXSS æ˜¯ä»€éº¼æ™‚å€™å‡ºç¾çš„ï¼Ÿé€™ä¸‰ç¨®é¡åˆ¥åˆæ˜¯ä»€éº¼æ™‚å€™é–‹å§‹è¢«åˆ†é¡çš„ï¼Ÿã€å› æ­¤ï¼Œæˆ‘èŠ±äº†é»æ™‚é–“æ‰¾äº†ä¸€äº›è³‡æ–™ï¼Œé€™ç¯‡æ–‡ç« æœƒè·Ÿå¤§å®¶è«‡è«‡ XSS çš„æ­·å²ï¼Œè®“æˆ‘å€‘ä¸€èµ·æ›´äº†è§£ XSS çš„å‰ä¸–ä»Šç”Ÿã€‚" name="twitter:description"><meta content="é€™ç¯‡åŸæœ¬æƒ³å¯«çš„æ˜¯ XSS çš„åŸºç¤ï¼Œå°±å¤§å®¶éƒ½è½éçš„é‚£ä¸‰ç¨®é¡åˆ¥ï¼šStored(Persistent)ã€Reflected(Non-Persistent) ä»¥åŠ DOM-based XSSï¼Œä½†ç•¶æˆ‘æ­£è¦é–‹å§‹å¯«çš„æ™‚å€™ï¼Œè…¦ä¸­çªç„¶æµ®ç¾äº†å¹¾å€‹å•é¡Œï¼šã€ŒXSS æ˜¯ä»€éº¼æ™‚å€™å‡ºç¾çš„ï¼Ÿé€™ä¸‰ç¨®é¡åˆ¥åˆæ˜¯ä»€éº¼æ™‚å€™é–‹å§‹è¢«åˆ†é¡çš„ï¼Ÿã€å› æ­¤ï¼Œæˆ‘èŠ±äº†é»æ™‚é–“æ‰¾äº†ä¸€äº›è³‡æ–™ï¼Œé€™ç¯‡æ–‡ç« æœƒè·Ÿå¤§å®¶è«‡è«‡ XSS çš„æ­·å²ï¼Œè®“æˆ‘å€‘ä¸€èµ·æ›´äº†è§£ XSS çš„å‰ä¸–ä»Šç”Ÿã€‚" property="og:description"><meta content="article" property="og:type"><meta content="https://tech-blog.cymetrics.io/posts/huli/xss-history/" property="og:url"><link href="https://blog.huli.tw/2021/10/11/xss-history/" rel="canonical"><meta content="Cymetrics Tech Blog" property="og:site_name"><meta content="https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png" property="og:image"><meta content="https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png" name="twitter:image"><meta content="hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk" name="google-site-verification"><meta content="always" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Cymetrics Tech Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=7f26b2ece8" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3VBVCXV9Z0"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3VBVCXV9Z0');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}html{line-height:1.15;-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}body{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button,input{font-family:inherit;font-size:100%;line-height:1.15;overflow:visible}button{text-transform:none}input{margin:0}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,ol,p,pre{font-size:1em}ol,p,pre{margin-bottom:1.5em}body,ol,p,pre{font-size:1rem;line-height:1.6}ol,p,pre{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}body,ol,p,pre{font-size:1.1rem;line-height:1.6}h2,ol,p,pre{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:2.05rem}body,ol,p,pre{font-size:1.2rem;line-height:1.6}h2,ol,p,pre{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){overflow-x:scroll}code{border-radius:.3em;color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}h1,h2{font-family:var(--font-family)}a:hover{text-decoration:underline}@media (max-width:767px){x:-moz-any-link{display:table-cell}}button,input{border-radius:.3em;max-width:100%}input{padding:.75em;margin-bottom:1.5em;display:inline}button+label,input+label,label+*{page-break-before:always}button,label{display:inline-block}button{background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover{background:#d9d9d9;color:#000}button[disabled]{background:#e6e6e6;color:#404040;cursor:not-allowed}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}input[type=email],input[type=number],input[type=search],input[type=time],input[type=url]{border:1px solid #595959;padding:.75em}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ol{margin-top:0}header nav .nav-title{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ol{margin-bottom:0}blockquote{padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:4px solid var(--primary)}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment{color:#999}.token.punctuation{color:#ccc}.token.tag{color:#e2777a}.token.function,.token.number{color:#f08d49}.token.constant,.token.property{color:#f8c555}.token.important,.token.keyword{color:#cc99cd}.token.regex,.token.string,.token.variable{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.inserted{color:green}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.w-full{width:100%}body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}@media (prefers-color-scheme:dark){body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}.post,footer{border-top:1px solid #ccc}.post{padding-top:35px;margin-top:35px}.menu__btn{display:inline-block;width:24px;height:24px;position:relative}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav,#nav .nav-title{display:flex;align-items:center}#nav{position:relative;height:68px;z-index:2}#nav .nav-title{padding:.375rem 1.5rem;width:100%;justify-content:space-between}#nav .nav-title *,.article-footer img{margin:0}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}.nav-logo{width:260px;height:40px;background:url(/img/logo1.png) no-repeat center center;background-size:contain}footer{margin-top:48px;font-size:14px;padding:24px;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.direct-link{display:none}.post-avatar{margin-top:27px;display:flex;align-items:center;height:36px}.post-avatar__img{width:36px;height:36px;overflow:hidden;margin:0;border-radius:50%}.post-avatar__time{font-size:13px}.post-avatar__info{margin-left:8px;color:#747474;text-align:left}.post-avatar__author{font-size:14px;font-weight:700}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}.article-author{margin-top:34px;display:flex;align-items:flex-start;margin-bottom:48px}.article-author__img{width:80px;height:80px;overflow:hidden;margin:0;border-radius:50%;flex-shrink:0}.article-author__info{margin-left:16px;text-align:left}.article-author__title{color:#747474;font-size:16px}.article-author__author{font-size:22px;font-weight:700;line-height:1em}.article-author__intro{color:#2f2f2f;margin-top:8px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav-logo{width:313px}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}.notice-block{text-align:left;background:rgba(87,137,211,.2);padding:16px;margin-top:24px;border-radius:8px}</style></head><body><header><nav><div id="nav"><div class="nav-title"><a href="/" class="nav-logo" title="Homepage"></a> <label class="menu__btn" for="menu__control"><span>Menu</span></label></div><div class="nav__links"><a href="/archive/">Archive</a> <a href="/tags/">Tags</a> <a href="/about/">About</a> <a href="/en">English</a></div></div><div id="reading-progress" aria-hidden="true"></div></nav><h1 class="w-full">XSS å¾é ­è«‡èµ·ï¼šæ­·å²èˆ‡ç”±ä¾†</h1><aside class="w-full"><div class="post-tags"><a href="/tags/security/" class="post-tag">#Security</a> <a href="/tags/front-end/" class="post-tag">#Front-end</a></div><div class="post-avatar"><img alt="huli" src="/img/authors/huli_logo.jpg" class="post-avatar__img" data-deopt="true"><div class="post-avatar__info"><div class="post-avatar__author"><a href="/posts/huli">huli</a></div><div class="post-avatar__time">11 Oct 2021</div></div></div><div class="notice-block" data-nosnippet="" style="display:none;">æˆ‘å€‘æ­£åœ¨å°‹æ‰¾ä¸€ä½ Security Engineer åŠ å…¥æˆ‘å€‘çš„åœ˜éšŠï¼Œè©³æƒ…è«‹åƒè€ƒ<a href="https://github.com/cymetrics/blog/issues/13" rel="noopener noreferrer" target="_blank">è·ç¼ºè³‡è¨Š</a></div></aside><dialog id="message"></dialog></header><main><article><div id="post-page"></div><p>æˆ‘ä»¥å‰æœ‰å¯«éä¸€äº›é—œæ–¼ XSS çš„æ–‡ç« ï¼Œä¸»è¦åœ¨è«‡çš„æ˜¯å¯¦ä½œé¢çš„é˜²ç¯„ä»¥åŠé˜²ç¦¦çš„å„å€‹ç´°ç¯€ï¼š</p><ol><li><a href="https://tech-blog.cymetrics.io/posts/huli/prevent-xss-might-be-harder-than-you-thought/">é˜²æ­¢ XSS å¯èƒ½æ¯”æƒ³åƒä¸­å›°é›£</a></li><li><a href="https://tech-blog.cymetrics.io/posts/huli/xss-attack-and-defense/">æ·ºè«‡ XSS æ”»æ“Šèˆ‡é˜²ç¦¦çš„å„å€‹ç’°ç¯€</a></li></ol><p>é€™ç¯‡åŸæœ¬æƒ³å¯«çš„æ˜¯ XSS çš„åŸºç¤ï¼Œå°±å¤§å®¶éƒ½è½éçš„é‚£ä¸‰ç¨®é¡åˆ¥ï¼šStored(Persistent)ã€Reflected(Non-Persistent) ä»¥åŠ DOM-based XSSï¼Œä½†ç•¶æˆ‘æ­£è¦é–‹å§‹å¯«çš„æ™‚å€™ï¼Œè…¦ä¸­çªç„¶æµ®ç¾äº†å¹¾å€‹å•é¡Œï¼šã€ŒXSS æ˜¯ä»€éº¼æ™‚å€™å‡ºç¾çš„ï¼Ÿé€™ä¸‰ç¨®é¡åˆ¥åˆæ˜¯ä»€éº¼æ™‚å€™é–‹å§‹è¢«åˆ†é¡çš„ï¼Ÿã€</p><p>å› æ­¤ï¼Œæˆ‘èŠ±äº†é»æ™‚é–“æ‰¾äº†ä¸€äº›è³‡æ–™ï¼Œé€™ç¯‡æ–‡ç« æœƒè·Ÿå¤§å®¶è«‡è«‡ XSS çš„æ­·å²ï¼Œè®“æˆ‘å€‘ä¸€èµ·æ›´äº†è§£ XSS çš„å‰ä¸–ä»Šç”Ÿã€‚</p><h2 id="xss-%E7%9A%84%E8%AA%95%E7%94%9F"><a href="#xss-%E7%9A%84%E8%AA%95%E7%94%9F" class="direct-link">#</a> XSS çš„èª•ç”Ÿ</h2><p>å¾å¾®è»Ÿçš„ MSDN blog åœ¨ 2009 å¹´ 12 æœˆç™¼ä½ˆçš„æ–‡ç« æ¨™é¡Œï¼š<a href="https://web.archive.org/web/20100723152801/http://blogs.msdn.com/b/dross/archive/2009/12/15/happy-10th-birthday-cross-site-scripting.aspx" rel="noopener noreferrer" target="_blank">Happy 10th birthday Cross-Site Scripting!</a> ä¸­å°±å¯ä»¥çœ‹å‡º XSSï¼ˆCross-Site Scriptingï¼‰é€™å€‹åè©ç´„è«æ˜¯ 1999 å¹´ 12 æœˆèª•ç”Ÿçš„ï¼Œé›¢ç¾åœ¨å·²ç¶“ 20 å¹¾å¹´äº†ã€‚</p><p>ï¼ˆä¸‹åœ–ç‚ºä¸Šé¢é€£çµçš„æˆªåœ–ï¼‰</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/huli/xss-history/xss-10years-1920w.webp 1920w, /img/posts/huli/xss-history/xss-10years-1280w.webp 1280w, /img/posts/huli/xss-history/xss-10years-840w.webp 840w, /img/posts/huli/xss-history/xss-10years-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/huli/xss-history/xss-10years-1920w.png 1920w, /img/posts/huli/xss-history/xss-10years-1280w.png 1280w, /img/posts/huli/xss-history/xss-10years-840w.png 840w, /img/posts/huli/xss-history/xss-10years-320w.png 320w" type="image/png"><img alt="xss-history" src="/img/posts/huli/xss-history/xss-10years-1920w.png" height="1398" width="1586" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1586 1398'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAYAAAA1WQxeAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAmklEQVQImSWM0Y6DIBRE+f9f3PRhs6tFES8XSREonkY6yck8zOQYq4VJGs/Q2OLJEk5CKrTWuGP0cIgqIgGNifQqvPJJKWVg5qny+MmIZGo9uXqn9zd9dMfYufP322m1D+V1XYN7vNs4L/w/FybrsG5HgpJSIufbWDFBI3bdWJxn3Tzee/Z9R0TGyWzO4dxKCMJxRGL8oqrD8AFo0tdjWuLj6wAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>åŸæ–‡æœ€å¾Œæœ‰é€™éº¼ä¸€æ®µè©±ï¼š</p><blockquote><p>Let's hope that ten years from now we'll be celebrating the death, not the birth, of Cross-Site Scripting!</p></blockquote><p>å¾ˆéºæ†¾çš„ï¼Œ2009 å¹´çš„ 10 å¹´å¾Œï¼Œä¹Ÿå°±æ˜¯ 2019 å¹´ï¼ŒXSS ä¾èˆŠæŒçºŒæ´»èºè‘—ï¼Œåœ¨ 2017 å¹´çš„ OWASP top 10 æ’åœ¨ç¬¬ä¸ƒåï¼Œ2021 çš„ç‰ˆæœ¬å‰‡ä½µå…¥ç¬¬ä¸‰å Injection çš„é¡åˆ¥ã€‚</p><p>è€Œæ–‡ä¸­æåˆ°çš„ï¼š<a href="https://web.archive.org/web/20100516115740/http://www.cert.org/advisories/CA-2000-02.html" rel="noopener noreferrer" target="_blank">CERTÂ® Advisory CA-2000-02 Malicious HTML Tags Embedded in Client Web Requests</a>ï¼Œå¯ä»¥è®“æˆ‘å€‘ä¸€çªºæœ€æ—©æœŸ XSS çš„é¢è²Œã€‚åº•ä¸‹å°±è®“æˆ‘å€‘ç°¡å–®çœ‹ä¸€ä¸‹é€™å€‹ç¶²é çš„å…§å®¹ï¼š</p><blockquote><p>A web site may inadvertently include malicious HTML tags or script in a dynamically generated page based on unvalidated input from untrustworthy sources. This can be a problem when a web server does not adequately ensure that generated pages are properly encoded to prevent unintended execution of scripts, and when input is not validated to prevent malicious HTML from being presented to the user.</p></blockquote><p>åœ¨ Overview çš„éƒ¨åˆ†å…¶å¯¦å°±æŠŠ XSS çš„æ ¸å¿ƒæ¦‚å¿µè¬›å¾—éå¸¸æ¸…æ¥šäº†ï¼Œserver æ²’æœ‰é©—è­‰è¼¸å…¥æˆ–æ˜¯ç·¨ç¢¼ï¼Œå°è‡´æ”»æ“Šè€…å¯ä»¥æ’å…¥ä¸€äº›æƒ¡æ„çš„ HTML æ¨™ç±¤æˆ–æ˜¯ scriptã€‚</p><blockquote><p>Malicious code provided by one client for another client</p><p>Sites that host discussion groups with web interfaces have long guarded against a vulnerability where one client embeds malicious HTML tags in a message intended for another client. For example, an attacker might post a message like <code>Hello message board. This is a message.&lt;SCRIPT>malicious code&lt;/SCRIPT>This is the end of my message.</code></p><p>When a victim with scripts enabled in their browser reads this message, the malicious code may be executed unexpectedly. Scripting tags that can be embedded in this way include <code>&lt;SCRIPT</code>> <code>&lt;OBJECT></code>, <code>&lt;APPLET></code>, and <code>&lt;EMBED></code>.</p><p>When client-to-client communications are mediated by a server, site developers explicitly recognize that data input is untrustworthy when it is presented to other users. Most discussion group servers either will not accept such input or will encode/filter it before sending anything to other readers.</p></blockquote><p>é€™ä¸€æ®µå‰‡æ˜¯å¾Œä¾†è¢«ç¨±ç‚ºã€ŒStored XSSï¼ˆä¹Ÿç¨±ç‚º Persistent XSSï¼‰ã€çš„åˆ†é¡ï¼Œå‡è¨­æœ‰ä¸€å€‹è¨è«–å€å¯ä»¥è®“äººç•™è¨€ï¼Œä¸€å€‹æƒ¡æ„çš„æ”»æ“Šè€…å¯ä»¥ç•™é€™æ¨£çš„å…§å®¹ï¼š</p><pre class="language-html"><code class="language-html">Hello message board. This is a message.<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCRIPT</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">malicious code</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCRIPT</span><span class="token punctuation">></span></span><br>This is the end of my message.</code></pre><p>ç•¶å…¶ä»–ä½¿ç”¨è€…çœ‹åˆ°é€™ç¯‡ç•™è¨€çš„æ™‚å€™ï¼Œå› ç‚ºç•™è¨€è£¡é¢æœ‰ <code>&lt;script></code> ï¼Œæ‰€ä»¥å°±æœƒåŸ·è¡Œæ”»æ“Šè€…æ‰€ç•™ä¸‹çš„ JavaScript ç¨‹å¼ç¢¼ã€‚</p><p>é™¤äº†é€™å€‹ä»¥å¤–ï¼Œ<code>&lt;object></code>ã€<code>&lt;applet></code> è·Ÿ <code>&lt;embed></code> ä¹Ÿéƒ½å¯ä»¥ç”¨ä¾†åŸ·è¡Œ JavaScriptï¼ˆè©±èªª applet é€™æ¨™ç±¤æ‡‰è©²å·²ç¶“æ²’ç”¨äº†ï¼Œå¯åƒè€ƒï¼š<a href="https://blog.huli.tw/2019/11/26/dont-break-web-smooshgate-and-keygen/" rel="noopener noreferrer" target="_blank">Donâ€™t break the Webï¼šä»¥ SmooshGate ä»¥åŠ keygen ç‚ºä¾‹ </a>ï¼‰ã€‚</p><blockquote><p>Malicious code sent inadvertently by a client for itself</p><p>Many Internet web sites overlook the possibility that a client may send malicious data intended to be used only by itself. This is an easy mistake to make. After all, why would a user enter malicious code that only the user will see?</p><p>However, this situation may occur when the client relies on an untrustworthy source of information when submitting a request. For example, an attacker may construct a malicious link such as <code>&lt;A HREF="http://example.com/comment.cgi? mycomment=&lt;SCRIPT>malicious code&lt;/SCRIPT>"> Click here&lt;/A></code></p><p>When an unsuspecting user clicks on this link, the URL sent to <a href="http://example.co" rel="noopener noreferrer" target="_blank">example.co</a> includes the malicious code. If the web server sends a page back to the user including the value of mycomment, the malicious code may be executed unexpectedly on the client. This example also applies to untrusted links followed in email or newsgroup messages.</p></blockquote><p>é€™ä¸€æ®µå°±å¾ˆæœ‰è¶£äº†ï¼Œæ¨™é¡Œæ˜¯ï¼šã€ŒMalicious code sent inadvertently by a client for itselfã€ï¼Œç™¼é€çš„å…§å®¹åŸºæœ¬ä¸Šåªæœ‰è‡ªå·±èƒ½çœ‹åˆ°ã€‚</p><p>ä¾‹å¦‚èªªç¶²å€ä¸­ mycomment é€™å€‹åƒæ•¸æœƒåæ˜ åˆ°ç•«é¢ä¸Šï¼Œæ‰€ä»¥åƒæ˜¯ <code>http://example.com/comment.cgi?mycomment=123</code>ï¼Œç•«é¢ä¸Šé¢å°±æœƒå‡ºç¾ 123ã€‚</p><p>ä½†åªæœ‰è‡ªå·±èƒ½çœ‹åˆ°èƒ½åšä»€éº¼å‘¢ï¼Ÿ</p><p>å› ç‚ºæ˜¯é€éç¶²å€ä¸Šçš„ query string ä¾†å‚³éè³‡è¨Šï¼Œå› æ­¤å¯ä»¥ç”¢ç”Ÿé€™æ¨£çš„ä¸€å€‹é€£çµï¼š<code>http://example.com/comment.cgi?mycomment=&lt;SCRIPT>malicious code&lt;/SCRIPT></code>ï¼Œæ¥è‘—å†æŠŠé€™å€‹é€£çµå‚³çµ¦å…¶ä»–äººï¼Œç•¶å…¶ä»–äººé»äº†ä»¥å¾Œï¼Œç•«é¢ä¸Šå°±æœƒå‡ºç¾ <code>&lt;SCRIPT>malicious code&lt;/SCRIPT></code>ï¼Œç…§æ¨£é”æˆ XSSã€‚</p><p>é€™å°±æ˜¯ XSS çš„å¦å¤–ä¸€ç¨®åˆ†é¡ï¼šReflected XSSï¼Œä½ çš„è¼¸å…¥æœƒåæ˜ åœ¨ç•«é¢ä¸Šã€‚</p><p>è€Œé€™å…©ç¨®çš„å·®åˆ¥åœ¨æ–¼ Stored XSS å°±åƒå®ƒçš„åå­—ä¸€æ¨£ï¼ŒXSS payload æ˜¯è¢«ä¿å­˜ä½çš„ï¼Œä»¥è¨è«–å€ä¾†èªªï¼Œæ–‡ç« æ˜¯ä¿å­˜åœ¨è³‡æ–™åº«ä¸­çš„ï¼Œè€Œ Reflected XSS å‰‡ä¸ç„¶ã€‚</p><p>ä»¥ PHP ç‚ºä¾‹ï¼ŒReflected XSS çš„ç¨‹å¼ç¢¼å¯èƒ½æœƒåƒé€™æ¨£ï¼š</p><pre class="language-php"><code class="language-php"><span class="token language-php php"><span class="token delimiter important">&lt;?php</span><br>   <span class="token variable">$comment</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'comment'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token delimiter important">?></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><br>    <span class="token language-php php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$comment</span> <span class="token delimiter important">?></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>æŠŠ GET çš„åƒæ•¸ç›´æ¥åæ˜ åœ¨ç•«é¢ä¸Šï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡éƒ½å¿…é ˆé€é comment é€™å€‹åƒæ•¸æŠŠ payload å‚³é€²å»ï¼Œå¦å‰‡ä¸æœƒè§¸ç™¼ XSSã€‚</p><p>ä»¥ä¸Šé¢æçš„ã€Œè¨è«–å€ã€é€™å€‹ç¶²ç«™ç‚ºä¾‹ï¼ŒStored XSS çš„ç ´å£åŠ›æ‡‰è©²æ˜¯æ›´å¼·å¤§çš„ï¼Œå› ç‚ºåªè¦é»é€²å»ä½ é€™ç¯‡æ–‡ç« å°±æœƒä¸­æ‹›ï¼Œå¯ä»¥æƒ³æˆä½ åœ¨ ptt ç™¼äº†ä¸€ç¯‡æ–‡ç« ï¼Œåªè¦æœ‰é„‰æ°‘é»é€²ä¾†æ–‡ç« å°±æœƒè¢«æ”»æ“Šï¼Œé‚„æ»¿å®¹æ˜“è§¸ç™¼çš„ã€‚</p><p>ä½† Reflected XSS å°±ä¸å¤ªä¸€æ¨£äº†ï¼Œé€™éœ€è¦ä½¿ç”¨è€…é»æ“Šé€£çµæ‰æœƒå‡ºäº‹ï¼Œåƒæ˜¯ä½ åœ¨ ptt æ¨æ–‡ç•™äº†ä¸€å€‹é€£çµï¼Œé„‰æ°‘è¦ä¸»å‹•é»é‚£å€‹é€£çµæ‰èƒ½è§¸ç™¼ XSSã€‚</p><p>æ–‡ä¸­çš„å…¶ä»–éƒ¨åˆ†ä¹Ÿå¾ˆæœ‰è¶£ï¼Œä¾‹å¦‚èªªä¹Ÿæœ‰æåˆ°åƒ…ç®¡æŠŠ JavaScript disabledï¼Œä¾ç„¶å¯ä»¥ç”¨ HTML èˆ‡ CSS å»ç«„æ”¹ç•«é¢ç­‰ç­‰ï¼Œä¹Ÿæœ‰æåˆ°ä¿®è£œæ–¹å¼ï¼Œåœ¨é€™é‚Šï¼š<a href="https://web.archive.org/web/20100527204457/http://www.cert.org/tech_tips/malicious_code_mitigation.html" rel="noopener noreferrer" target="_blank">Understanding Malicious Content Mitigation for Web Developers</a></p><p>ä¿®è£œæ–¹å¼é™¤äº†æˆ‘å€‘ç†Ÿæ‚‰çš„é‡å°å…§å®¹ç·¨ç¢¼ä»¥å¤–ï¼Œé‚„æœ‰å¦ä¸€å€‹æ˜¯è¦ã€ŒæŒ‡å®šç·¨ç¢¼æ–¹å¼ã€ï¼Œé€™é‚Šçš„ç·¨ç¢¼æŒ‡çš„æ˜¯ UTF-8 æˆ–æ˜¯ ISO-8859-1 ä»¥åŠ big5 é€™ç¨®ç·¨ç¢¼ã€‚é›–ç„¶èªªç¾åœ¨é€™å€‹å¹´ä»£çµ•å¤§éƒ¨åˆ†ç¶²ç«™éƒ½æ˜¯ UTF-8 äº†ï¼Œä½†æ—©æœŸå…¶å¯¦ä¸ç„¶ã€‚åœ¨ä»¥å¾€ç€è¦½å™¨é‚„æ”¯æ´åƒæ˜¯ UTF-7 é€™æ¨£çš„ç·¨ç¢¼æ–¹å¼ï¼Œå°±ç®—ä¸ç”¨ä¸€äº›ç‰¹æ®Šå­—å…ƒä¹Ÿå¯ä»¥é”æˆ XSSï¼š</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>test page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>  +ADw-script+AD4-alert(1)+ADw-/script+AD4-<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>ç¯„ä¾‹å–è‡ªï¼š<a href="https://wooyun.js.org/drops/XSS%E5%92%8C%E5%AD%97%E7%AC%A6%E9%9B%86%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF.html" rel="noopener noreferrer" target="_blank">XSS å’Œå­—ç¬¦é›†çš„é‚£äº›äº‹å…’</a>ï¼Œè£¡é¢æœ‰æåˆ°æ›´å¤šé€™ç¨®é¡ä¼¼çš„å•é¡Œï¼Œä½†å¤§å¤šæ•¸å•é¡Œæ‡‰è©²éƒ½ç™¼ç”Ÿåœ¨æ¯”è¼ƒæ—©æœŸçš„ç€è¦½å™¨ä¸Šé¢ã€‚</p><h2 id="%E7%AC%AC%E4%B8%89%E7%A8%AE-xss-%E5%88%86%E9%A1%9E%E7%9A%84%E8%AA%95%E7%94%9F"><a href="#%E7%AC%AC%E4%B8%89%E7%A8%AE-xss-%E5%88%86%E9%A1%9E%E7%9A%84%E8%AA%95%E7%94%9F" class="direct-link">#</a> ç¬¬ä¸‰ç¨® XSS åˆ†é¡çš„èª•ç”Ÿ</h2><p>æœ‰çœ‹é XSS æ–‡ç« çš„äººéƒ½çŸ¥é“ï¼Œæœ€å»£ç‚ºäººçŸ¥çš„ XSS åˆ†é¡å¤§æ¦‚å°±ä¸‰ç¨®ï¼š</p><ol><li>Stored XSSï¼ˆPersistent XSSï¼‰</li><li>Reflected XSSï¼ˆNon-Persistent XSSï¼‰</li><li>DOM-based XSS</li></ol><p>å†ç¹¼çºŒå¾€ä¸‹ä¹‹å‰ï¼Œæˆ‘å…ˆä¾†å•å•çœ‹å¤§å®¶å…©å€‹å•é¡Œã€‚</p><p>ç¬¬ä¸€å€‹å•é¡Œï¼Œå‡è¨­ç¾åœ¨æˆ‘ç™¼äº†ä¸€ç¯‡æ–‡ç« ï¼Œå…§å®¹ç‚º <code>&lt;img src=x onerror=alert(1)></code>ï¼Œè€Œé¡¯ç¤ºæ–‡ç« çš„é é¢ç¨‹å¼ç¢¼æ˜¯é€™æ¨£çš„ï¼š</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">post</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.article'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> post<span class="token punctuation">.</span>content<br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>å› ç‚ºç”¨äº† innerHTML çš„ç·£æ•…ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸€å€‹ XSS æ¼æ´ï¼Œåœ¨é€™å€‹ç‹€æ³ä¹‹ä¸‹ï¼Œæˆ‘çš„ç•™è¨€ç¢ºå¯¦æœ‰ã€Œä¿å­˜ã€åœ¨è³‡æ–™åº«ï¼Œä½†ä¹ŸåŒæ™‚ç”¨äº† DOM å»æ”¹è®Šå…§å®¹ï¼Œé‚£é€™å€‹ XSS æ‡‰è©²è¢«æ­¸é¡åœ¨ Stored XSSï¼Œé‚„æ˜¯ DOM-based XSSï¼Ÿ</p><p>ç¬¬äºŒå€‹å•é¡Œï¼Œå‡è¨­ç¶²é ä¸­æœ‰ä¸€æ®µç¨‹å¼ç¢¼é•·é€™æ¨£ï¼š</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".search"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>é€™é¡¯ç„¶å¯ä»¥é€é query string è£½é€ å‡ºä¸€å€‹ XSS æ¼æ´ï¼Œé€™å€‹ XSS ç¢ºå¯¦åæ˜ äº†ä½¿ç”¨è€…çš„è¼¸å…¥ï¼Œè€Œä¸”æ²’æœ‰è¢«å„²å­˜åœ¨è³‡æ–™åº«è£¡é¢ï¼Œä¸éå»æ˜¯ç”¨ DOM å»æ”¹è®Šå…§å®¹ï¼Œé‚£å®ƒæ‡‰è©²æ˜¯ Reflected XSSï¼Œé‚„æ˜¯ DOM-based XSSï¼Ÿ</p><p>åœ¨ç¹¼çºŒå¾€ä¸‹é–±è®€ä¹‹å‰ï¼Œå¤§å®¶å¯ä»¥å…ˆæƒ³ä¸€ä¸‹ä¸Šé¢é€™å…©å€‹å•é¡Œã€‚</p><p>å…ˆä¾†è¬›è¬›æˆ‘ä»¥å‰çš„ç­”æ¡ˆï¼Œæˆ‘ä¹‹å‰æ˜¯ç”¨ä¸‹é¢çš„å®šç¾©ä¾†åˆ†é¡é€™å¹¾å€‹çš„ï¼š</p><ol><li>æˆ‘çš„ XSS payloadï¼ˆä¾‹å¦‚èªª <code>&lt;script>alert(1)&lt;/script></code>ï¼‰å¦‚æœæœ‰å­˜åœ¨è³‡æ–™åº«ï¼Œé‚£å°±æ˜¯ Stored XSS</li><li>å¦‚æœä¸æ˜¯ï¼Œé‚£å°±çœ‹æˆ‘çš„ payload æ˜¯ç›´æ¥å¾å¾Œç«¯è¼¸å‡ºï¼Œé‚„æ˜¯é€é DOM å»è³¦å€¼ï¼Œå‰è€…å°±æ˜¯ Reflectedï¼Œå¾Œè€…å°±æ˜¯ DOM-based</li></ol><p>å¾Œä¾†æˆ‘æ‰ç™¼ç¾é€™å€‹åˆ†é¡æ–¹å¼æ˜¯éŒ¯èª¤çš„ï¼Œå› ç‚ºæˆ‘è¢«ã€Œstoredã€é€™å€‹åè©èª¤å°äº†ï¼Œæ²’æœ‰æ„è­˜åˆ°é€™èƒŒå¾Œçš„æ­·å²èƒŒæ™¯ã€‚</p><p>é€™æ˜¯ä»€éº¼æ„æ€å‘¢ï¼Ÿåœ¨ 1999 å¹´ XSS å‰›å‡ºä¾†çš„æ™‚å€™ï¼ŒAjax é‚„ä¸å­˜åœ¨ï¼ˆå®ƒæ˜¯ 2005 å¹´æ‰èª•ç”Ÿçš„ï¼‰ï¼Œæ‰€ä»¥å‰å¾Œç«¯çš„è³‡æ–™äº¤æ›æ‡‰è©²éƒ½æ˜¯é€éè¡¨å–®é€å» Serverï¼Œä¸¦ä¸”ç›´æ¥æŠŠå›æ‡‰ render å‡ºä¾†ã€‚</p><p>æ›å¥è©±èªªï¼Œåœ¨ 1999 å¹´çš„æ™‚å€™ï¼ŒåŸºæœ¬ä¸Šæ²’æœ‰ä»€éº¼æ“ä½œæ˜¯ç”¨ JavaScript å»æ›´æ”¹ç•«é¢å…§å®¹çš„ï¼Œå°±ç®—æœ‰ï¼Œä¹Ÿæ˜¯ä¸€äº›æ¯”è¼ƒç„¡é—œç·Šè¦çš„æ“ä½œã€‚ä½†åœ¨ 2021 å¹´éƒ½ä¸ä¸€æ¨£äº†ï¼Œåœ¨é€™å€‹ SPA ç››è¡Œçš„å¹´ä»£ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é€é JavaScript å»å‘¼å« APIï¼Œæ‹¿åˆ°è³‡æ–™ä»¥å¾Œå†å»æ›´æ”¹ç•«é¢ï¼Œå¾Œç«¯åªè² è²¬æä¾›è³‡æ–™ï¼Œå‰ç«¯é è‘— JavaScript ä¾† renderï¼Œé€™è·Ÿ 20 å¹´å‰å®Œå…¨ä¸åŒã€‚</p><p>XSS çš„ä¸‰ç¨®åˆ†é¡ä¹‹ä¸­ï¼Œå‰å…©ç¨® Stored ä»¥åŠ Reflected åœ¨ XSS èª•ç”Ÿä¹‹æ™‚å°±å·²ç¶“å­˜åœ¨äº†ï¼Œè€Œç¬¬ä¸‰ç¨®å‰‡æ™šäº†äº”å¹´æ‰å‡ºç¾ï¼ˆé€™é‚Šçš„ã€Œå‡ºç¾ã€æŒ‡çš„æ˜¯æœ‰å€‹åè©æˆ–åˆ†é¡ä¾†å®šç¾©å®ƒï¼Œè€Œä¸æ˜¯æŒ‡æ”»æ“Šå‡ºç¾ï¼‰ï¼Œå‡ºè™•æ‡‰è©²æ˜¯é€™ä¸€ç¯‡ï¼š<a href="http://www.webappsec.org/projects/articles/071105.shtml" rel="noopener noreferrer" target="_blank">DOM Based Cross Site Scripting or XSS of the Third Kind</a></p><p>æ–‡ä¸­çš„ Introduction æœ‰é€™æ¨£ä¸€å€‹æ®µè½ï¼š</p><blockquote><p>XSS is typically categorized into â€œnon-persistentâ€ and â€œpersistentâ€ (â€œreflectedâ€ and â€œstoredâ€ accordingly, as defined in [4]). â€œNon-persistentâ€ means that the malicious (Javascript) payload is echoed by the server in an immediate response to an HTTP request from the victim. â€œPersistentâ€ means that the payload is stored by the system, and may later be embedded by the vulnerable system in an HTML page provided to a victim.</p></blockquote><p>é‡é»æ˜¯ Stored è·Ÿ Reflected é€™å…©å€‹åˆ†é¡éƒ½æœ‰ä¸€å€‹å‰æï¼šã€Œpayload æ˜¯ç”±å¾Œç«¯ç›´æ¥ render çš„ã€ï¼Œè€Œé€™ç¯‡æ–‡ç« æ‰€æåˆ°çš„ç¬¬ä¸‰å€‹åˆ†é¡ DOM-basedï¼ŒæŒ‡çš„å‰‡æ˜¯ã€Œpayload æ˜¯ç”±å‰ç«¯ render å‡ºä¾†çš„ã€ï¼Œé€™å°±æ˜¯ç¬¬ä¸‰ç¨®èˆ‡å‰å…©ç¨®çš„æœ€å¤§å·®ç•°ã€‚</p><p>åœ¨åˆ¤åˆ¥ XSS çš„æ™‚å€™ï¼Œæ‡‰è©²å…ˆç¢ºèªçš„å…¶å¯¦æ˜¯ã€Œpayload æ˜¯å‰ç«¯é‚„æ˜¯å¾Œç«¯ renderï¼Ÿã€ï¼Œå¦‚æœæ˜¯å‰ç«¯ render å‡ºä¾†ï¼Œä¸è«–è³‡æ–™å¾å“ªè£¡ä¾†ï¼ˆå¾è³‡æ–™åº«æˆ–æ˜¯ç¶²å€æˆ–ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ï¼‰ï¼Œå°±æ˜¯ DOM-based XSSã€‚å¦‚æœæ˜¯å¾Œç«¯ render å‡ºä¾†ï¼Œæ‰å»å€åˆ†æ˜¯ Stored é‚„æ˜¯ Reflectedã€‚</p><p>å› æ­¤ï¼Œå‰›å‰›é‚£å…©å€‹å•é¡Œå› ç‚ºéƒ½æ˜¯å‰ç«¯ render çš„é—œä¿‚ï¼Œéƒ½æœƒè¢«æ­¸é¡åœ¨ DOM-based XSSã€‚</p><p>ä¸Šé¢çš„æ–‡ç« ä¸­å°±æœ‰èˆ‰ä¸€å€‹é¡ä¼¼çš„ä¾‹å­ï¼š</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HTML</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TITLE</span><span class="token punctuation">></span></span>Welcome!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TITLE</span><span class="token punctuation">></span></span><br>Hi<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCRIPT</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br><span class="token keyword">var</span> pos<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"name="</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">;</span><br>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCRIPT</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BR</span><span class="token punctuation">></span></span><br>Welcome to our system<br>â€¦<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HTML</span><span class="token punctuation">></span></span></code></pre><p>åœ¨æ–‡ç« çš„è¨»è§£ä¸­é‚„ç‰¹åˆ¥æåˆ°äº†ï¼š</p><blockquote><p>The malicious payload was not embedded in the raw HTML page at any time (unlike the other flavors of XSS).</p></blockquote><p>å› ç‚º payload å…¶å¯¦ä¸å­˜åœ¨æ–¼ä»»ä½• HTML pageï¼ˆå› ç‚ºæ˜¯å¾Œä¾†æ‰ç”¨ JavaScript æ”¹è®Šçš„ï¼‰ï¼Œæ‰€ä»¥å®ƒä¸å±¬æ–¼ Stored ä¹Ÿä¸å±¬æ–¼ Reflectedï¼Œæ˜¯ç¬¬ä¸‰ç¨®æ–°çš„é¡å‹çš„ XSSã€‚</p><p>è‡³æ–¼ä¿®è£œæ–¹å¼çš„è©±ï¼Œç”±æ–¼æ˜¯åœ¨å‰ç«¯ç”¨ JavaScript renderï¼Œæ‰€ä»¥ç·¨ç¢¼çš„å·¥ä½œç•¶ç„¶å°±æ˜¯å‰ç«¯çš„é–‹ç™¼è€…è¦è² è²¬ï¼Œä¸€å€‹å¸¸è¦‹çš„æ–¹å¼æ˜¯é€™æ¨£ï¼ˆç¨‹å¼ç¢¼å–è‡ªï¼š<a href="https://stackoverflow.com/questions/2794137/sanitizing-user-input-before-adding-it-to-the-dom-in-javascript" rel="noopener noreferrer" target="_blank">Sanitizing user input before adding it to the DOM in Javascript</a>ï¼‰ï¼š</p><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sanitize</span><span class="token punctuation">(</span><span class="token parameter">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><br>      <span class="token string">'&'</span><span class="token operator">:</span> <span class="token string">'&ampamp;'</span><span class="token punctuation">,</span><br>      <span class="token string">'&lt;'</span><span class="token operator">:</span> <span class="token string">'&amplt;'</span><span class="token punctuation">,</span><br>      <span class="token string">'>'</span><span class="token operator">:</span> <span class="token string">'&ampgt;'</span><span class="token punctuation">,</span><br>      <span class="token string">'"'</span><span class="token operator">:</span> <span class="token string">'&ampquot;'</span><span class="token punctuation">,</span><br>      <span class="token string">"'"</span><span class="token operator">:</span> <span class="token string">'&amp#x27;'</span><span class="token punctuation">,</span><br>      <span class="token string">"/"</span><span class="token operator">:</span> <span class="token string">'&amp#x2F;'</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">[&&lt;>"'/]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">match</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>match<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>ä½†æœ‰ä¸€é»è¦ç‰¹åˆ¥æ³¨æ„ï¼Œé‚£å°±æ˜¯ä¸¦ä¸æ˜¯é€™æ¨£å°±è¬äº‹ğŸ‘ŒğŸ‘Œäº†ï¼ŒXSS çš„é˜²ç¦¦æ¯”è¼ƒéº»ç…©çš„é»æ˜¯è¦é‡å°ä¸åŒæƒ…å¢ƒåšè™•ç†ï¼Œå¦‚åŒ <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="noopener noreferrer" target="_blank">OWASP: Cross Site Scripting Prevention Cheat Sheet</a> ä¸­æœ‰æåˆ°çš„ï¼Œå¦‚æœä½ çš„è¼¸å‡ºæ˜¯è¦æ”¾åˆ° <code>&lt;a href=""></code> è£¡é¢çš„è©±ï¼Œéœ€è¦è€ƒæ…®åˆ° <code>javascript:alert(1)</code> é€™ç¨®å½¢å¼çš„ payloadï¼Œé€™æ™‚å€™ä¸Šé¢çš„ sanitize function å°±æ²’æœ‰ç”¨äº†ã€‚</p><h2 id="%E7%B5%90%E8%AA%9E"><a href="#%E7%B5%90%E8%AA%9E" class="direct-link">#</a> çµèª</h2><p>å…¶å¯¦ä¸€é–‹å§‹æœƒç™¼ç¾åˆ†éŒ¯ï¼Œæ˜¯å› ç‚ºåœ¨ <a href="https://zeroday.hitcon.org/" rel="noopener noreferrer" target="_blank">HITCON ZeroDay</a> å¹³å°ä¸Šæ‰€å›å ±çš„æ¼æ´åˆ†é¡è¢«æ”¹è®Šï¼Œæ‰è®“æˆ‘æ„è­˜åˆ°è‡ªå·±å°æ–¼é€™å¹¾ç¨®çš„åˆ†æ³•ç†è§£éŒ¯èª¤ï¼Œåœ¨é€™é‚Šä¹Ÿæ„Ÿè¬è² è²¬å¯©æŸ¥çš„å·¥ä½œäººå“¡ã€‚</p><p>é™¤äº†é€™å¹¾ç¨®åˆ†æ³•ä»¥å¤–ï¼Œå…¶å¯¦ä¹Ÿæœ‰å…¶ä»–ç¨®çš„åˆ†é¡æ–¹å¼ï¼Œä¾‹å¦‚èªªä½¿ç”¨è€…éœ€è¦è‡ªå·±è¼¸å…¥ XSS payload çš„ Self XSSï¼Œæˆ–è€…æ˜¯åˆ©ç”¨ HTML è§£æä¸ä¸€è‡´è€Œé”æˆçš„ Mutation XSS ç­‰ç­‰ï¼Œå…¶å¯¦éƒ½æ˜¯ XSS å¾ˆæœ‰è¶£çš„æ‡‰ç”¨ï¼Œä»¥å¾Œæœ‰æ©Ÿæœƒå†ä¾†è·Ÿå¤§å®¶åˆ†äº«ã€‚</p><div class="article-footer"><a href="https://tech-blog.cymetrics.io/posts/huli/xss-history/" on-click="share"><img alt="Share" src="/img/icons/icon_external link hyperlink.svg" height="24" width="24">Share this post</a></div><div><p style="font-weight: bold;">Tag</p><div class="post-tags"><a href="/tags/security/" class="post-tag">#Security</a> <a href="/tags/front-end/" class="post-tag">#Front-end</a></div><p style="font-weight: bold;">Recommendation</p><ol><li><a href="/posts/huli/sql-injection-in-action/">SQL injection å¯¦æˆ°ï¼šåœ¨é™åˆ¶åº•ä¸‹æå‡é€Ÿåº¦</a></li><li><a href="/posts/crystal/pwn-intro/">PWN å…¥é–€ - buffer overflow æ˜¯ä»€éº¼ï¼Ÿ</a></li><li><a href="/posts/jo/zerobased-common-risk-fix/">è³‡å®‰ç§‘æ™®ç•ªå¤–ç¯‡ï¼ˆäºŒï¼‰-å¦‚ä½•æœ‰æ•ˆç‡é¸æ“‡é¢¨éšªé€²è¡Œä¿®å¾© feat.é¢¨éšªå’Œæ³•è¦æ¯æ¯ç›¸é—œï¼Ÿï¼</a></li><li><a href="/posts/genchilu/the-difference-between-java-and-golang-in-writing-concurrent-code-to-access-shared-variable-zh/">æ¯”è¼ƒ Java å’Œ Golang åœ¨æ’°å¯«ä½µç™¼æ™‚è™•ç†å…±äº«è®Šæ•¸çš„å·®ç•°</a></li><li><a href="/posts/maxchiu/indexing/">å¾Indexingçš„è§’åº¦åˆ‡å…¥MySQL-Innodbèˆ‡PostgreSQLçš„æ•ˆèƒ½æ¯”è¼ƒ</a></li></ol></div><div class="article-author"><img alt="huli" src="/img/authors/huli_logo.jpg" class="article-author__img" data-deopt="true"><div class="article-author__info"><div class="article-author__title">Author</div><div class="article-author__author"><a href="/posts/huli">huli</a></div><div class="article-author__intro">Act as a bridge between Front-end and Security world</div></div></div><p style="font-weight: bold;">Discussion(login required)</p><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" id="utterance-script" issue-term="title" label="utterance" repo="cymetrics/blog" theme="github-light"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"XSS å¾é ­è«‡èµ·ï¼šæ­·å²èˆ‡ç”±ä¾†","image":["https://tech-blog.cymetrics.io/img/posts/huli/xss-history/xss-10years-1920w.png","https://tech-blog.cymetrics.io/img/icons/icon_external link hyperlink.svg","https://tech-blog.cymetrics.io/img/authors/huli_logo.jpg"],"author":{"@type":"Person","name":"huli"},"publisher":{"@type":"Organization","name":"Cymetrics Tech Blog","url":"https://tech-blog.cymetrics.io","logo":{"@type":"ImageObject","url":"https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png","width":512,"height":512}},"url":"https://tech-blog.cymetrics.io/posts/huli/xss-history/","mainEntityOfPage":"https://tech-blog.cymetrics.io/posts/huli/xss-history/","datePublished":"2021-10-11","dateModified":"2024-11-27","description":"æˆ‘ä»¥å‰æœ‰å¯«éä¸€äº›é—œæ–¼ XSS çš„æ–‡ç« ï¼Œä¸»è¦åœ¨è«‡çš„æ˜¯å¯¦ä½œé¢çš„é˜²ç¯„ä»¥åŠé˜²ç¦¦çš„å„å€‹ç´°ç¯€ï¼š é˜²æ­¢ XSS å¯èƒ½æ¯”æƒ³åƒä¸­å›°é›£ æ·ºè«‡ XSS æ”»æ“Šèˆ‡é˜²ç¦¦çš„å„å€‹ç’°ç¯€ é€™ç¯‡åŸæœ¬æƒ³å¯«çš„æ˜¯ XSS..."}</script></article></main><footer><div class="footer-logos"><a href="https://www.facebook.com/cymetrics" rel="noopener noreferrer" target="_blank"><img alt="facebook" src="/img/icons/icon_social media_facebook.svg" height="30" width="30"></a><a href="https://www.linkedin.com/company/cymetrics" rel="noopener noreferrer" target="_blank"><img alt="linkedin" src="/img/icons/icon_social media_linkedln.svg" height="30" width="30"></a><a href="https://tech-blog.cymetrics.io/feed/feed.xml" rel="noreferrer noopener" target="_blank"><img alt="rss feed" src="/img/icons/rss-feed.svg" height="30" width="30"></a></div><div class="copyright">Â© 2021 Cymetrics Tech Blog, based on <a href="https://github.com/google/eleventy-high-performance-blog" rel="noopener noreferrer" target="_blank">eleventy-high-performance-blog</a>. <a href="https://oneinfinity.global/" rel="noopener noreferrer" target="_blank">OneInfinity</a></div></footer><script>// light/dark theme switch
      // disable dark mode for now
      const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })</script></body></html>