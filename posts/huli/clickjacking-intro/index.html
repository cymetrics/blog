<!DOCTYPE html><html domain=tech-blog.cymetrics.io ga-id=G-3VBVCXV9Z0 lang=zh-TW><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="index, follow" name=robots><meta content=CYBER,Cymetrics,Security name=keywords><link href="/img/favicon/favicon-192x192.png?hash=42b087227d" rel=icon type=image/png><meta content=#5789d3 name=theme-color><title>不識廬山真面目：Clickjacking 點擊劫持攻擊</title><meta content="不識廬山真面目：Clickjacking 點擊劫持攻擊" property=og:title><meta content="不識廬山真面目：Clickjacking 點擊劫持攻擊" name=twitter:title><meta content=summary name=twitter:card><meta content="# 前言 在針對前端的各種攻擊手法之中，我覺得 clickjacking 是相當有趣的一個。它的中文翻譯通常翻成「點擊劫持」，實際上的意思是你以為點了 A 網頁的東西，其實卻是點到了 B 網頁，惡意網頁劫持了使用者的點擊，讓使用者點到意料之外的地方。..." name=description><meta content="# 前言 在針對前端的各種攻擊手法之中，我覺得 clickjacking 是相當有趣的一個。它的中文翻譯通常翻成「點擊劫持」，實際上的意思是你以為點了 A 網頁的東西，其實卻是點到了 B 網頁，惡意網頁劫持了使用者的點擊，讓使用者點到意料之外的地方。..." name=twitter:description><meta content="# 前言 在針對前端的各種攻擊手法之中，我覺得 clickjacking 是相當有趣的一個。它的中文翻譯通常翻成「點擊劫持」，實際上的意思是你以為點了 A 網頁的東西，其實卻是點到了 B 網頁，惡意網頁劫持了使用者的點擊，讓使用者點到意料之外的地方。..." property=og:description><meta content=article property=og:type><meta content=https://tech-blog.cymetrics.io/posts/huli/clickjacking-intro/ property=og:url><meta content="Cymetrics Tech Blog" property=og:site_name><meta content=https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png property=og:image><meta content=https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png name=twitter:image><meta content=hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk name=google-site-verification><link href=https://tech-blog.cymetrics.io/posts/huli/clickjacking-intro/ rel=canonical><meta content=always name=referrer><link href=/feed/feed.xml rel=alternate type=application/atom+xml title="Cymetrics Tech Blog"><link href=/ rel=preconnect crossorigin=""><script async src="/js/min.js?hash=4aa09e9651" defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3VBVCXV9Z0"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3VBVCXV9Z0');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}share-widget{position:fixed;right:20px;bottom:20px;opacity:.9;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);position:fixed;opacity:.8;z-index:1000;font-size:10px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}html{line-height:1.15;-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}body{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button,input{font-family:inherit;font-size:100%;line-height:1.15;overflow:visible}button{text-transform:none}input{margin:0}[type=button],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}summary{display:list-item}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}h3{font-size:2em;line-height:1.125;margin-bottom:.75em;font-size:1.4rem;line-height:1.5rem;margin-bottom:1rem}body,ol,p,pre{font-size:1em}ol,p,pre{margin-bottom:1.5em}body,ol,p,pre{font-size:1rem;line-height:1.6}ol,p,pre{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}h3{font-size:1.7989rem;line-height:2rem}body,ol,p,pre{font-size:1.1rem;line-height:1.6}h2,h3,ol,p,pre{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:2.05rem}h3{font-size:1.5rem}body,ol,p,pre{font-size:1.2rem;line-height:1.6}h2,h3,ol,p,pre{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){overflow-x:scroll}code{border-radius:.3em;color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}h1,h2,h3{font-family:var(--font-family)}a:hover{text-decoration:underline}button,input{border-radius:.3em;max-width:100%}input{padding:.75em;margin-bottom:1.5em;display:inline}button+label,input+label,label+*{page-break-before:always}label{display:inline-block}button,input[type=submit]{background:#f2f2f2;color:#191919;cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover,input[type=submit]:hover{background:#d9d9d9;color:#000}button:not([disabled]),button[type=submit],input[type=submit]{background:#f9c412;color:#181818}button:not([disabled]):hover,button[type=submit]:hover,input[type=submit]:hover{background:#ba9005;color:#000}input[type=email],input[type=search],input[type=url]{border:1px solid #595959;padding:.75em}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ol{margin-top:0}header nav .nav-title{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ol{margin-bottom:0}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#2d2d2d}.token.punctuation{color:#ccc}.token.attr-name,.token.tag{color:#e2777a}.token.function{color:#f08d49}.token.property{color:#f8c555}.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.inserted{color:green}button:not([disabled]),button[type=submit],input[type=submit]{background:var(--primary)}button:not([disabled]):hover,button[type=submit]:hover,input[type=submit]:hover{background:var(--primary-dark)}.utterances{position:relative;box-sizing:border-box;width:100%;max-width:760px;margin-left:auto;margin-right:auto}.w-full{width:100%}body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color);--paginationCurrentColor: #666356}@media (prefers-color-scheme:dark){body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color);--paginationCurrentColor: #666356}}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}.post,footer{border-top:1px solid #ccc}.post{padding-top:35px;margin-top:35px}.menu__btn{display:inline-block;width:24px;height:24px;position:relative}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav,#nav .nav-title{display:flex;align-items:center}#nav{position:relative;height:68px;z-index:2}#nav .nav-title{padding:.375rem 1.5rem;width:100%;justify-content:space-between}#nav .nav-title *,.article-footer img{margin:0}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}.nav-logo{width:260px;height:40px;background:url(/img/logo1.png) no-repeat center center;background-size:contain}footer{margin-top:48px;font-size:14px;padding:24px;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.direct-link{display:none}.post-avatar{margin-top:27px;display:flex;align-items:center;height:36px}.post-avatar__img{width:36px;height:36px;overflow:hidden;margin:0;border-radius:50%}.post-avatar__time{font-size:13px}.post-avatar__info{margin-left:8px;color:#747474;text-align:left}.post-avatar__author{font-size:14px;font-weight:700}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}.article-author{margin-top:34px;display:flex;align-items:flex-start;margin-bottom:48px}.article-author__img{width:80px;height:80px;overflow:hidden;margin:0;border-radius:50%;flex-shrink:0}.article-author__info{margin-left:16px;text-align:left}.article-author__title{color:#747474;font-size:16px}.article-author__author{font-size:22px;font-weight:700;line-height:1em}.article-author__intro{color:#2f2f2f;margin-top:8px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav-logo{width:313px}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id=nav><div class=nav-title><a href=/ class=nav-logo title=Homepage></a> <label class=menu__btn for=menu__control><span>Menu</span></label></div><div class=nav__links><a href=/archive/ >Archive</a> <a href=/tags/ >Tags</a> <a href=/about/ >About</a></div></div><div id=reading-progress aria-hidden=true></div></nav><h1 class=w-full>不識廬山真面目：Clickjacking 點擊劫持攻擊</h1><aside class=w-full><div class=post-tags><a href=/tags/security/ class=post-tag>#Security</a> <a href=/tags/front-end/ class=post-tag>#Front-end</a></div><div class=post-avatar><img alt=huli src=/img/authors/huli_logo.jpg class=post-avatar__img data-deopt=true><div class=post-avatar__info><div class=post-avatar__author><a href=/posts/huli>huli</a></div><div class=post-avatar__time>26 Aug 2021</div></div></div></aside><dialog id=message></dialog></header><main><article><div id=post-page></div><h2 id=%E5%89%8D%E8%A8%80><a href=#%E5%89%8D%E8%A8%80 class=direct-link>#</a> 前言</h2><p>在針對前端的各種攻擊手法之中，我覺得 clickjacking 是相當有趣的一個。它的中文翻譯通常翻成「點擊劫持」，實際上的意思是你以為點了 A 網頁的東西，其實卻是點到了 B 網頁，惡意網頁劫持了使用者的點擊，讓使用者點到意料之外的地方。</p><p>只是一個點擊而已，這樣會有什麼危害嗎？</p><p>假設在背後的是一個銀行轉帳頁面，而且帳號跟金額都填好了，只要按一個按鈕就會轉錢出去，這樣的話危害就很大了（不過這通常不太可能啦，因為轉帳還需要輸入 OTP 之類的，這只是舉例）。</p><p>或是舉個更常見的例子，例如說有個乍看之下是取消訂閱電子報的頁面，於是你點了「確定取消」的按鈕，但其實底下藏著的是 Facebook 的按讚鈕，所以你不但沒有取消訂閱，還被騙了一個讚（因為劫持的目標是讚，所以又稱為 likejacking）。</p><p>這篇文章我會介紹 clickjacking 的攻擊原理、防禦方式以及實際案例，讓大家更了解這個攻擊手法。</p><h2 id=clickjacking-%E6%94%BB%E6%93%8A%E5%8E%9F%E7%90%86><a href=#clickjacking-%E6%94%BB%E6%93%8A%E5%8E%9F%E7%90%86 class=direct-link>#</a> Clickjacking 攻擊原理</h2><p>Clickjacking 的原理就是把兩個網頁疊在一起，透過 CSS 讓使用者看見的是 A 網頁，但點到的卻是 B 網頁。</p><p>以比較技術的講法來說，就是用 iframe 把 B 網頁嵌入然後設透明度 0.001，再用 CSS 把自己的內容疊上去，就大功告成了。</p><p>我覺得 clickjacking 直接看範例是最有趣的，因此做了一些簡單的範例。</p><p>底下這個範例可以先點擊「確定取消」的按鈕，然後再點「切換透明度」，就可以看到背後其實是修改個人資料的頁面以及刪除帳號的按鈕：</p><iframe height=430 src=https://aszx87410.github.io/demo/clickjacking/ width=320></iframe><p>所以我以為我點了「確定取消」，但實際上點到的卻是「刪除帳號」，這就是 clickjacking。</p><p>上面的 iframe 如果打不開，可以去這邊玩：<a href=https://aszx87410.github.io/demo/clickjacking/ rel="noopener noreferrer" target=_blank>clickjacking 範例</a>。</p><p>有些人可能會覺得這個範例太過簡單，實際應用中可能很少出現這種這麼簡單的攻擊，只要按一個按鈕而已，或許更多網站會更複雜一點，例如說要先輸入一個什麼東西？</p><p>底下這個範例以「更改 email」這個功能來設計 clickjacking，比起前一個範例是整個網頁蓋過去，這個範例刻意留下原網頁的 input，其他都用 CSS 蓋掉，按鈕的部分用 <code>pointer-events:none</code> 讓事件穿透。</p><p>看似是一個輸入 email 訂閱資訊的網頁，但按下確定之後卻跳出「修改 email 成功」，因為背後其實是個修改 email 的網頁：</p><iframe height=450 src=https://aszx87410.github.io/demo/clickjacking/adv.html width=340></iframe><p>上面的範例沒看到的話，可以去這邊玩：<a href=https://aszx87410.github.io/demo/clickjacking/adv.html rel="noopener noreferrer" target=_blank>進階 clickjacking 範例</a>。</p><p>除此之外，我也有在<a href=https://blog.miniasp.com/post/2008/10/11/The-latest-cross-browser-exploit-Clickjacking rel="noopener noreferrer" target=_blank>最新的跨瀏覽器攻擊手法：Clickjacking</a> 這篇裡面看到一個很有趣的範例：<a href="https://www.youtube.com/watch?v=gxyLbpldmuU" rel="noopener noreferrer" target=_blank>假遊戲真劫持（YouTube 影片）</a>，看似是遊戲但其實只是為了讓你去點按鈕，超級有趣！</p><p>寫到這邊，幫 clickjacking 做個總結，這個攻擊手法大概就是：</p><ol><li>把目標網頁嵌入惡意網頁之中（透過 iframe 或其他類似標籤）</li><li>在惡意網頁上用 CSS 把目標網頁蓋住，讓使用者看不見</li><li>誘導使用者前往惡意網頁並且做出操作（輸入或點擊等等）</li><li>觸發目標網頁行為，達成攻擊</li></ol><p>因此實際上攻擊的難易度，取決於你的惡意網站設計得怎麼樣，以及目標網頁的原始行為需要多少互動。舉例來說，點擊按鈕就比輸入資訊要容易得多。</p><p>然後還要提醒一點，這種攻擊要達成，使用者要先在目標網站是登入狀態才行。只要能把目標網頁嵌入惡意網頁之中，就會有 clickjacking 的風險。</p><h2 id=clickjacking-%E9%98%B2%E7%A6%A6%E6%96%B9%E5%BC%8F><a href=#clickjacking-%E9%98%B2%E7%A6%A6%E6%96%B9%E5%BC%8F class=direct-link>#</a> Clickjacking 防禦方式</h2><p>如同前面所述，只要能被其他網頁嵌入就會有風險，換句話說，如果沒辦法被嵌入，就不會有 clickjacking 的問題了，這就是解決 clickjacking 的方式。</p><p>一般來說點擊劫持的防禦方式可以分為兩種，一種是自己用 JavaScript 檢查，另一種是透過 response header 告知瀏覽器這個網頁是否能被嵌入。</p><h3 id=frame-busting><a href=#frame-busting class=direct-link>#</a> Frame busting</h3><p>有一種叫做 frame busting 的方式，就是我前面提到的自己用 JavaScript 檢查，原理很簡單，程式碼也很簡單：</p><pre class=language-js><code class=language-js><span class="token keyword">if</span> <span class="token punctuation">(</span>top <span class="token operator">!==</span> self<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  top<span class="token punctuation">.</span>location <span class="token operator">=</span> self<span class="token punctuation">.</span>location<br><span class="token punctuation">}</span></code></pre><p>每一個網頁都有自己的 window object，而 <code>window.self</code> 指向的會是自己的 window，那 top 的話就是 top window，可以想成是這整個瀏覽器的「分頁」最上層的 window。</p><p>如果今天是被獨立開啟的網頁，那 top 跟 self 就會指向同一個 window，但如果今天網頁是被鑲在 iframe 裡面，top 指的就會是使用 iframe 的那個 window。</p><p>舉個例子好了，假設今天我在 localhost 有個 index.html，裡面寫著：</p><pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://example.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://onedegree.hk<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">></span></span></code></pre><p>那關係圖就會是這樣：</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/huli/clickjacking-intro/top-1920w.webp 1920w, /img/posts/huli/clickjacking-intro/top-1280w.webp 1280w, /img/posts/huli/clickjacking-intro/top-640w.webp 640w, /img/posts/huli/clickjacking-intro/top-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/huli/clickjacking-intro/top-1920w.jpg 1920w, /img/posts/huli/clickjacking-intro/top-1280w.jpg 1280w, /img/posts/huli/clickjacking-intro/top-640w.jpg 640w, /img/posts/huli/clickjacking-intro/top-320w.jpg 320w" type=image/jpeg><img alt="window 關係圖" src=/img/posts/huli/clickjacking-intro/top-1920w.jpg height=721 width=1068 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1068 721'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAGCAYAAAARx7TFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVQI1yWOP0tCcQBFr+XTLQtCDMmGIBwiCg3aauvzBI6NTZKLieQS5XsqaH9eVGSpS00NKhbi0PBQK5e+w+mHDXc4cDhc6fAV5SYsFYZsO2OSzhcJe0TkdIiy3+ioi5TxUBlUhMUaLN/A/OU/q2SW/zVS+p3wlcfqdR+/PUFnsFLy2L8dsFEzgewPmjl2WXuMkaiLhWoKncPzwx68WPSeNvGfjJCVcYnczRF1Rah6gC6gdb9jTPFRj2PlxsiX7hCovBG0G8wWP6eldafDbrnJVqWNz5z/A+7Eh1vlW0OvAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>綠色跟黃色分別是兩個以 iframe 載入的網頁，也就是兩個不同的 window，在這兩個網頁裡面如果存取 <code>top</code> 的話，就會是 <code>localhost/index.html</code> 的 window object。</p><p>所以透過 <code>if (top !== self)</code> 的檢查，就可以知道自己是不是被放在 iframe 裡面。如果是的話，就改變 top.location，把最上層的網頁導向其他地方。</p><p>聽起來很美好而且沒什麼問題，但其實會被 iframe 的 <code>sandbox</code> 屬性繞過。</p><p>iframe 可以設置一個屬性叫做 <code>sandbox</code>，代表這個 iframe 的功能受到限制，如果要把限制打開必須明確指定，可以指定的值包括：</p><ol><li>allow-forms，允許提交表單</li><li>allow-scripts，允許執行 JS</li><li>allow-top-navigation，允許改變 top location</li><li>allow-popups，允許彈出視窗</li></ol><p>（還有一大堆，詳情可參考 <a href=https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/iframe rel="noopener noreferrer" target=_blank>MDN: iframe</a>）</p><p>也就是說，如果我是這樣載入 iframe 的：</p><pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./busting.html<span class="token punctuation">"</span></span> <span class="token attr-name">sandbox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>allow-forms allow-scripts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre><p>那就算 busting.html 有上面我說的那個防護也沒有用，因為 JavaScript 不會執行，所以那段 script 就不會跑到，但 user 還是可以正常 submit 表單。</p><p>於是就有人提出了更實用的方法，在現有基礎上做一些改良（程式碼取自：<a href=https://en.wikipedia.org/wiki/Framekiller rel="noopener noreferrer" target=_blank>Wikipedia - Framekiller</a>）：</p><pre class=language-html><code class=language-html><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">html</span><span class="token punctuation">{</span><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span><span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>   <span class="token keyword">if</span> <span class="token punctuation">(</span>self <span class="token operator">==</span> top<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>       document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span> <br>   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>       top<span class="token punctuation">.</span>location <span class="token operator">=</span> self<span class="token punctuation">.</span>location<span class="token punctuation">;</span> <br>   <span class="token punctuation">}</span><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>先把網頁整個藏起來，一定要執行 JS 才能開啟，所以用上面的 sandbox 阻止 script 執行的話，就只會看到一個空白的網頁；如果不用 sandbox 的話，JS 的檢查不會過，所以還是看到一片空白。</p><p>雖然說這樣可以做到比較完全的防禦，但也有缺點存在。這個缺點就是，如果使用者把 JS 功能關掉的話，他就什麼都看不到了。所以對於把 JS 功能關閉的使用者來說，體驗還滿差的。</p><p>clickjacking 早期出來的時候（2008 年）可能相關防禦還沒有這麼完全，所以只好用這些方案，但在現今 2021 年，瀏覽器已經支援了其他更好的方式來阻擋網頁被嵌入。</p><h3 id=x-frame-options><a href=#x-frame-options class=direct-link>#</a> X-Frame-Options</h3><p>這個 HTTP response header 在 2009 年時首先由 IE8 實作，接著其他瀏覽器才跟上，在 2013 年時才變成了完整的 <a href=https://www.rfc-editor.org/rfc/rfc7034.txt rel="noopener noreferrer" target=_blank>RFC7034</a>。</p><p>這個 header 會有底下這三種值：</p><ol><li>X-Frame-Options: DENY</li><li>X-Frame-Options: SAMEORIGIN</li><li>X-Frame-Options: ALLOW-FROM <a href=https://example.com/ rel="noopener noreferrer" target=_blank>https://example.com/</a></li></ol><p>第一種就是拒絕任何網頁把這個網頁嵌入，包含 <code>&lt;iframe></code>, <code>&lt;frame></code>, <code>&lt;object></code>, <code>&lt;applet></code>, <code>&lt;embed></code> 這些 tag 都不行。</p><p>第二個則是只有 same origin 的網頁可以，最後一個則是只允許特定的 origin 嵌入，除此之外其他的都不行（只能放一個值不能放列表，所以如果要多個 origin，要像 CORS header 那樣在 server 動態調整輸出）。</p><p>在 RFC 裡面還有特別提到最後兩種的判定方式可能跟你想的不一樣，每個瀏覽器的實作會有差異。</p><p>例如說有些瀏覽器可能只檢查「上一層」跟「最上層」，而不是每一層都檢查。這個「層」是什麼意思呢？因為 iframe 理論上可以有無限多層嘛，A 嵌入 B 嵌入 C 嵌入 D...</p><p>如果把這關係化為類似 html tag 的話，會長得像這樣：</p><pre><code>&lt;example.com/A.html>
  &lt;attacker.com>
    &lt;example.com/B.html>
        &lt;example.com/target.html>
</code></pre><p>對於最內層的 target.html 來說，如果瀏覽器只檢查上一層（B.html）跟最上層（A.html）的話，那儘管設置成 <code>X-Frame-Options: SAMEORIGIN</code>，檢查還是會通過，因為這兩層確實是相同的 origin。但實際上，中間卻夾了一個惡意網頁在裡面，所以還是有被攻擊的風險。</p><p>除此之外 <code>X-Frame-Options</code> 還有第二個問題，就是 <code>ALLOW-FROM</code> 的支援度不好，可以參考底下來自 <a href="https://caniuse.com/?search=X-Frame-Options" rel="noopener noreferrer" target=_blank>caniuse</a> 的表格，黃色的都是不支援 <code>ALLOW-FROM</code> 的：</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/huli/clickjacking-intro/caniuse-1920w.webp 1920w, /img/posts/huli/clickjacking-intro/caniuse-1280w.webp 1280w, /img/posts/huli/clickjacking-intro/caniuse-640w.webp 640w, /img/posts/huli/clickjacking-intro/caniuse-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/huli/clickjacking-intro/caniuse-1920w.jpg 1920w, /img/posts/huli/clickjacking-intro/caniuse-1280w.jpg 1280w, /img/posts/huli/clickjacking-intro/caniuse-640w.jpg 640w, /img/posts/huli/clickjacking-intro/caniuse-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/huli/clickjacking-intro/caniuse-1920w.jpg height=516 width=884 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 884 516'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6klEQVQI1z2LQUvCYACGv9/Sqb9Sh+6du9SlblGnIqhTRYdqUJGBSUSLSCIqhpQyTNuc2Uzcvolr6GZakP2Apw8PHR4eeB9eIV0T+ZYncAv4tSfajSKDqMowqfMTu/8It3CG95qj6Rj4yp59Owq/vXeGipHVSQTPGT5bFr1Wma4s0q3f0w8r9Ns2g9AmUfvXh4P47kjMvI75qJOEDeKgRsd3iJovRF5J2SKWVcSuNsOKNsn23jT66SqZ1CInB/OUjRQl45jD/TkespuI9PUy50dT7GyMs7U2Rlqb4O5qAftyHUtxczFLLrvEH+3Ww0/vZNsSAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p><code>X-Frame-Options</code> 最前面的 <code>X</code> 說明了它比較像是一個過渡時期的東西，在未來新的瀏覽器當中，它的功能會被 CSP（Content Security Policy）給取代，並且把上面提到的問題解決。</p><h3 id=csp%3A-frame-ancestors><a href=#csp%3A-frame-ancestors class=direct-link>#</a> CSP: frame-ancestors</h3><p>在之前的文章：<a href=https://tech-blog.cymetrics.io/posts/huli/xss-attack-and-defense/ >淺談 XSS 攻擊與防禦的各個環節</a>裡面我有稍微講了一下 CSP 這個東西，基本上就是告訴瀏覽器一些安全性相關的設置，其中有一個屬性是 <code>frame-ancestors</code>，設定起來會像這樣：</p><ol><li>Content-Security-Policy: frame-ancestors 'none'</li><li>Content-Security-Policy: frame-ancestors 'self'</li><li>Content-Security-Policy: frame-ancestors <a href=https://a.example.com rel="noopener noreferrer" target=_blank>https://a.example.com</a> <a href=https://b.example.com rel="noopener noreferrer" target=_blank>https://b.example.com</a></li></ol><p>這三種剛好對應到了之前 X-Frame-Options 的三種：DENY, SAMEORIGIN 以及 ALLOW-FROM（但這次有支援多個 origin 了）。</p><p>先講一個可能會被搞混的地方，<code>frame-ancestors</code> 限制的行為跟 X-Frame-Options 一樣，都是「哪些網頁可以把我用 iframe 嵌入」，而另外一個 CSP 規則 <code>frame-src</code> 則是：「我這個網頁允許載入哪些來源的 iframe」。</p><p>例如說我在 index.html 設一個規則是 <code>frame-src: 'none'</code>，那 index.html 裡面用 <code>&lt;iframe></code> 載入任何網頁都會被擋下來，不管那個網頁有沒有設置任何東西。</p><p>再舉個例子，我的 index.html 設置成：<code>frame-src: https://example.com</code>，但是 <a href=http://example.com rel="noopener noreferrer" target=_blank>example.com</a> 也有設置：<code>frame-ancestors: 'none'</code>，那 index.html 還是沒有辦法用 iframe 把 <a href=http://example.com rel="noopener noreferrer" target=_blank>example.com</a> 載入，因為對方拒絕了。</p><p>總而言之，<code>frame-src</code> 是「跟我交往好嗎？」，<code>frame-ancestors</code> 則是對於這個請求的回答。我可以設置成 <code>frame-ancestors: 'none'</code>，代表任何人來跟我告白我都說不要。瀏覽器要成功顯示 iframe，要兩方都同意才行，只要其中一方不同意就會失敗。</p><p>另外，值得注意的是 frame-ancestors 是 CSP level2 才支援的規則，在 2014 年年底才漸漸開始被主流瀏覽器們所支援。</p><h3 id=%E9%98%B2%E7%A6%A6%E7%B8%BD%E7%B5%90><a href=#%E9%98%B2%E7%A6%A6%E7%B8%BD%E7%B5%90 class=direct-link>#</a> 防禦總結</h3><p>因為支援度的關係，所以建議 <code>X-Frame-Options</code> 跟 CSP 的 <code>frame-ancestors</code>一起使用，若是你的網頁不想被 iframe 載入，記得加上 HTTP response header：</p><pre><code>X-Frame-Options: DENY
Content-Security-Policy: frame-ancestors 'none'
</code></pre><p>若是只允許被 same origin 載入的話，設置成：</p><pre><code>X-Frame-Options: SAMEORIGIN
Content-Security-Policy: frame-ancestors 'self'
</code></pre><p>如果要用 allow list 指定允許的來源，則是：</p><pre><code>X-Frame-Options: ALLOW-FROM https://example.com/
Content-Security-Policy: frame-ancestors https://example.com/
</code></pre><h2 id=%E5%AF%A6%E9%9A%9B%E6%A1%88%E4%BE%8B><a href=#%E5%AF%A6%E9%9A%9B%E6%A1%88%E4%BE%8B class=direct-link>#</a> 實際案例</h2><p>接著我們來看一些實際的 clickjacking 案例，會對這個攻擊更有感覺一點。</p><h3 id=yelp><a href=#yelp class=direct-link>#</a> Yelp</h3><p>美國最大的餐廳評論網站 Yelp 有幾個關於 clickjacking 的 report：</p><ol><li><a href=https://hackerone.com/reports/305128 rel="noopener noreferrer" target=_blank>ClickJacking on IMPORTANT Functions of Yelp</a></li><li><a href=https://hackerone.com/reports/355859 rel="noopener noreferrer" target=_blank>CRITICAL-CLICKJACKING at Yelp Reservations Resulting in exposure of victim Private Data (Email info) + Victim Credit Card MissUse.</a></li></ol><p>雖然說沒辦法達到奪取帳號這種很嚴重的攻擊，但還是可以造成一些危害，例如說自己註冊一間餐廳之後：</p><ol><li>幫使用者訂位，藉此偷到他們的 email</li><li>幫使用者訂位，使用者要取消訂位的話就要付取消訂位的費用，造成錢財損失</li></ol><p>對於看不爽的餐廳，也可以靠這方法去製造很多假的訂位，讓餐廳無從辨別（因為都是真的使用者來訂位）</p><h3 id=twitter-periscope-clickjacking-vulnerability><a href=#twitter-periscope-clickjacking-vulnerability class=direct-link>#</a> Twitter Periscope Clickjacking Vulnerability</h3><p>原始報告：<a href=https://hackerone.com/reports/591432 rel="noopener noreferrer" target=_blank>https://hackerone.com/reports/591432</a><br>日期：2019 年 5 月</p><p>這個 bug 是因為相容性問題，網頁只設置了 <code>X-Frame-Options ALLOW-FROM</code> 而沒有設置 CSP，這樣的話其實沒什麼用，因為現在的瀏覽器都不支援 <code>ALLOW-FROM</code>。</p><p>解法很簡單，就是加上 CSP 的 frame-ancestors，讓現代瀏覽器也遵守這個規則。</p><h3 id=highly-wormable-clickjacking-in-player-card><a href=#highly-wormable-clickjacking-in-player-card class=direct-link>#</a> Highly wormable clickjacking in player card</h3><p>原始報告：<a href=https://hackerone.com/reports/85624 rel="noopener noreferrer" target=_blank>https://hackerone.com/reports/85624</a><br>日期：2015 年 8 月</p><p>這個漏洞滿有趣的，運用了前面所提到的瀏覽器實作問題。這個案例是 twitter 已經有設置 <code>X-Frame-Options: SAMEORIGIN</code> 跟 <code>Content-Security-Policy: frame-ancestors 'self'</code>，但當時有些瀏覽器實作檢查時，只檢查 top window 是不是符合條件。</p><p>換句話說，如果是 <a href=http://twitter.com rel="noopener noreferrer" target=_blank>twitter.com</a> => <a href=http://attacker.com rel="noopener noreferrer" target=_blank>attacker.com</a> => <a href=http://twitter.com rel="noopener noreferrer" target=_blank>twitter.com</a>，就會通過檢查，所以還是可以被惡意網頁嵌入。</p><p>再加上這個漏洞發生在 twitter 的 timeline，所以可以達成蠕蟲的效果，clickjacking 之後就發推，然後就會有更多人看到，更多人發同樣的推文。</p><p>作者的 writeup 寫得很棒，但部落格掛掉了，這是存檔：<a href=http://web.archive.org/web/20190310161937/https://blog.innerht.ml/google-yolo/ rel="noopener noreferrer" target=_blank>Google YOLO</a></p><h3 id=%5Bapi.tumblr.com%5D-exploiting-clickjacking-vulnerability-to-trigger-self-dom-based-xss><a href=#%5Bapi.tumblr.com%5D-exploiting-clickjacking-vulnerability-to-trigger-self-dom-based-xss class=direct-link>#</a> [<a href=http://api.tumblr.com rel="noopener noreferrer" target=_blank>api.tumblr.com</a>] Exploiting clickjacking vulnerability to trigger self DOM-based XSS</h3><p>原始報告：<a href=https://hackerone.com/reports/953579 rel="noopener noreferrer" target=_blank>https://hackerone.com/reports/953579</a><br>日期：2020 年 8 月</p><p>會特別挑這個案例，是因為它是攻擊鍊的串接！</p><p>在 XSS 漏洞中有一種叫做 self XSS，意思就是通常都要使用者自己做一些操作才會中招，所以影響十分有限，許多 program 也都不接受 self XSS 的漏洞。</p><p>而這份報告把 self XSS 跟 clickjacking 串連在一起，透過 clickjacking 的方式讓使用者去觸發 self XSS，串連攻擊鍊讓這個攻擊更容易被達成，可行性更高。</p><p>以上就是一些 clickjacking 相關的實際案例，值得注意的是有一些是因為相容性問題造成的 issue，而不是沒有設定，所以設定正確也是很重要的一件事。</p><h2 id=%E7%84%A1%E6%B3%95%E9%98%B2%E7%A6%A6%E7%9A%84-clickjacking%EF%BC%9F><a href=#%E7%84%A1%E6%B3%95%E9%98%B2%E7%A6%A6%E7%9A%84-clickjacking%EF%BC%9F class=direct-link>#</a> 無法防禦的 clickjacking？</h2><p>clickjacking 防禦的方式說穿了就是不要讓別人可以嵌入你的網頁，但如果這個網頁的目的就是讓別人嵌入，那該怎麼辦？</p><p>例如說 Facebook widget，大家常看到的那些「讚」跟「分享」的按鈕，就是為了讓其他人可以用 iframe 嵌入的，這類型的 widget 該怎麼辦呢？</p><p>根據這兩篇：</p><ol><li><a href=https://www.netsparker.com/blog/web-security/clickjacking-attack-on-facebook-how-tiny-attribute-save-corporation/ rel="noopener noreferrer" target=_blank>Clickjacking Attack on Facebook: How a Tiny Attribute Can Save the Corporation</a></li><li><a href=https://stackoverflow.com/questions/61968091/facebook-like-button-click rel="noopener noreferrer" target=_blank>Facebook like button click</a></li></ol><p>裡面得到的資訊，或許目前只能降低一點使用者體驗來換取安全性，例如說點了按鈕之後還會跳出一個 popup 讓你確認，對使用者來說多了一個點擊，但是也避免了 likejacking 的風險。</p><p>或是我猜可能也會根據網站的來源決定是否有這個行為，舉例來說在一些比較有信譽的網站，可能就不會跳出這個 popup。</p><p>我有做了一個簡單的 demo 網頁：<a href=https://aszx87410.github.io/demo/clickjacking/like.html rel="noopener noreferrer" target=_blank>https://aszx87410.github.io/demo/clickjacking/like.html</a></p><p>如果 likejacking 成功的話，點了按鈕之後會對 Facebook Developer Plugin 的粉專按讚（我自己實驗是有成功啦），大家可以試試看，按完以後可以按「顯示原始網頁」看看按鈕底下長什麼樣子，順便把讚收回來。</p><h2 id=%E7%B8%BD%E7%B5%90><a href=#%E7%B8%BD%E7%B5%90 class=direct-link>#</a> 總結</h2><p>比起以前瀏覽器支援度還沒有這麼完整的時代，現在已經幸福許多了，瀏覽器也實作了愈來愈多的安全性功能以及新的 response header，透過瀏覽器保護使用者避免惡意攻擊。</p><p>雖然說平均來講 clickjacking 的攻擊難易度、先備條件以及影響程度通常都比 XSS 或是 CSRF 之類的攻擊來得低，但依然是不可忽視的風險之一。</p><p>如果你的網頁沒有要讓別的網站嵌入，記得設置 <code>X-Frame-Options: DENY</code> 以及 <code>Content-Security-Policy: frame-ancestors 'none'</code>，告訴瀏覽器你的網頁不能被嵌入，藉此防止點擊劫持攻擊。</p><p>參考資料：</p><ol><li><a href=https://github.com/reddelexc/hackerone-reports/blob/master/tops_by_bug_type/TOPCLICKJACKING.md rel="noopener noreferrer" target=_blank>TOPCLICKJACKING.md</a></li><li><a href=https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html#x-frame-options-header-types rel="noopener noreferrer" target=_blank>Clickjacking Defense Cheat Sheet</a></li><li><a href=https://content-security-policy.com/frame-ancestors/ rel="noopener noreferrer" target=_blank>CSP frame-ancestors</a></li></ol><div class=article-footer><a href=https://tech-blog.cymetrics.io/posts/huli/clickjacking-intro/ on-click=share><img alt=Share src="/img/icons/icon_external link hyperlink.svg" height=24 width=24>Share this post</a></div><div class=article-author><img alt=huli src=/img/authors/huli_logo.jpg class=article-author__img data-deopt=true><div class=article-author__info><div class=article-author__title>Author</div><div class=article-author__author><a href=/posts/huli>huli</a></div><div class=article-author__intro>遊走在前端與資安間，以開發者身份學習資安，也從資安重新學習前端</div></div></div><script async src=https://utteranc.es/client.js crossorigin=anonymous id=utterance-script issue-term=title label=utterance repo=cymetrics/blog theme=github-light></script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"不識廬山真面目：Clickjacking 點擊劫持攻擊","image":["https://tech-blog.cymetrics.io/img/posts/huli/clickjacking-intro/top-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/huli/clickjacking-intro/caniuse-1920w.jpg","https://tech-blog.cymetrics.io/img/icons/icon_external link hyperlink.svg","https://tech-blog.cymetrics.io/img/authors/huli_logo.jpg"],"author":{"@type":"Person","name":"huli"},"publisher":{"@type":"Organization","name":"Cymetrics Tech Blog","url":"https://tech-blog.cymetrics.io","logo":{"@type":"ImageObject","url":"https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png","width":512,"height":512}},"url":"https://tech-blog.cymetrics.io/posts/huli/clickjacking-intro/","mainEntityOfPage":"https://tech-blog.cymetrics.io/posts/huli/clickjacking-intro/","datePublished":"2021-08-26","dateModified":"2021-08-26","description":"# 前言 在針對前端的各種攻擊手法之中，我覺得 clickjacking 是相當有趣的一個。它的中文翻譯通常翻成「點擊劫持」，實際上的意思是你以為點了 A 網頁的東西，其實卻是點到了 B 網頁，惡意網頁劫持了使用者的點擊，讓使用者點到意料之外的地方。..."}</script><script type=application/ld+json>{   
  "@context":"http://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Cymetrics Tech Blog",
      "item": "https://tech-blog.cymetrics.io"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Archive",
      "item": "https://tech-blog.cymetrics.io/archive/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "不識廬山真面目：Clickjacking 點擊劫持攻擊",
      "item": "https://tech-blog.cymetrics.io/posts/huli/clickjacking-intro/"
    }
  ]
}</script></article></main><footer><div class=footer-logos><a href=https://www.facebook.com/Cymetrics-100957872049641 rel="noopener noreferrer" target=_blank><img alt=facebook src="/img/icons/icon_social media_facebook.svg" height=30 width=30></a><a href=https://www.linkedin.com/company/onedegree-hk rel="noopener noreferrer" target=_blank><img alt=linkedin src="/img/icons/icon_social media_linkedln.svg" height=30 width=30></a><a href=https://tech-blog.cymetrics.io/feed/feed.xml rel="noreferrer noopener" target=_blank><img alt="rss feed" src=/img/icons/rss-feed.svg height=30 width=30></a></div><div class=copyright>© 2021 Cymetrics Tech Blog</div></footer><script>// light/dark theme switch
      // disable dark mode for now
      const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })
      

      /*
      const toggleEl = document.querySelector('#color-scheme-toggle')
      const bodyEl = document.querySelector('body');
      const DARK = 'dark';
      const LIGHT = 'light';
      const currentTheme = localStorage.getItem("theme") ||
            (window.matchMedia('(prefers-color-scheme: dark)').matches ? DARK : LIGHT);
      setTheme(currentTheme)

      toggleEl.addEventListener("click", handleToggleEvent)

      function handleToggleEvent(){
        const isDark = bodyEl.classList.toggle(DARK);
        const theme = isDark ? DARK : LIGHT;
        setTheme(theme)
        localStorage.setItem('theme', theme);
      }
      function setTheme(theme){
        if (theme === DARK) {
          setUtterancesTheme(DARK)
          bodyEl.classList.add(DARK);
          toggleEl.src = toggleEl.src.replace(DARK, LIGHT);
        }else{
          setUtterancesTheme(LIGHT)
          toggleEl.src = toggleEl.src.replace(LIGHT, DARK);
        }
      }

      var isUtterancesLoaded = false
      window.addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') {
          return;
        }
        isUtterancesLoaded = true
      });

      function setUtterancesTheme(theme) {
        let utterancesIframe = document.querySelector('.utterances iframe')
        if (!isUtterancesLoaded) {
          return requestAnimationFrame(() => setUtterancesTheme(theme))
        }

        utterancesIframe.contentWindow.postMessage({
          type: 'set-theme',
          theme: theme === DARK ? 'github-dark-orange' : 'github-light'
        }, 'https://utteranc.es');
      }
    */</script></body></html>