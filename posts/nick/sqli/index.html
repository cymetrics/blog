<!DOCTYPE html><html domain=tech-blog.cymetrics.io ga-id=G-3VBVCXV9Z0 lang=zh-TW><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="index, follow" name=robots><meta content=CYBER,Cymetrics,Security name=keywords><link href="/img/favicon/favicon-192x192.png?hash=42b087227d" rel=icon type=image/png><meta content=#5789d3 name=theme-color><title>秒懂 SQL Injection</title><meta content="秒懂 SQL Injection" property=og:title><meta content="秒懂 SQL Injection" name=twitter:title><meta content=summary name=twitter:card><meta content="# 前言 現實生活中也可能發生 SQL Injection ? 買飲料的時候店員問你甜度冰塊，你卻跟店員說店長已經連續三個月忘記繳水電費，再不交就要斷水斷電，店員情急之下不疑有他，把盈餘拿出來請你幫忙繳清，你就帶著這筆錢一走了之，SQL Injection..." name=description><meta content="# 前言 現實生活中也可能發生 SQL Injection ? 買飲料的時候店員問你甜度冰塊，你卻跟店員說店長已經連續三個月忘記繳水電費，再不交就要斷水斷電，店員情急之下不疑有他，把盈餘拿出來請你幫忙繳清，你就帶著這筆錢一走了之，SQL Injection..." name=twitter:description><meta content="# 前言 現實生活中也可能發生 SQL Injection ? 買飲料的時候店員問你甜度冰塊，你卻跟店員說店長已經連續三個月忘記繳水電費，再不交就要斷水斷電，店員情急之下不疑有他，把盈餘拿出來請你幫忙繳清，你就帶著這筆錢一走了之，SQL Injection..." property=og:description><meta content=article property=og:type><meta content=https://tech-blog.cymetrics.io/posts/nick/sqli/ property=og:url><meta content="Cymetrics Tech Blog" property=og:site_name><meta content=https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_1.jpg property=og:image><meta content=https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_1.jpg name=twitter:image><meta content=hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk name=google-site-verification><link href=https://tech-blog.cymetrics.io/posts/nick/sqli/ rel=canonical><meta content=always name=referrer><link href=/feed/feed.xml rel=alternate type=application/atom+xml title="Cymetrics Tech Blog"><link href=/ rel=preconnect crossorigin=""><script async src="/js/min.js?hash=4aa09e9651" defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3VBVCXV9Z0"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-3VBVCXV9Z0');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}html{line-height:1.15;-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}body{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b,strong{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button,select{font-family:inherit;font-size:100%;line-height:1.15;text-transform:none}button{overflow:visible}select{margin:0}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}summary{display:list-item}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}h3{font-size:2em;line-height:1.125;margin-bottom:.75em;font-size:1.4rem;line-height:1.5rem;margin-bottom:1rem}body,ol,p,pre,ul{font-size:1em}ol,p,pre,ul{margin-bottom:1.5em}body,ol,p,pre,ul{font-size:1rem;line-height:1.6}ol,p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}h3{font-size:1.7989rem;line-height:2rem}body,ol,p,pre,ul{font-size:1.1rem;line-height:1.6}h2,h3,ol,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:2.05rem}h3{font-size:1.5rem}body,ol,p,pre,ul{font-size:1.2rem;line-height:1.6}h2,h3,ol,p,pre,ul{margin-bottom:1.632rem}}table{display:table}code,pre,table{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){overflow-x:scroll}code{border-radius:.3em;color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}h1,h2,h3{font-family:var(--font-family)}a:hover{text-decoration:underline}button,select{border-radius:.3em;max-width:100%}button+label,label+*,select+label{page-break-before:always}select{margin-bottom:1.5em;display:inline;border:1px solid #595959;padding:.75em}button,label{display:inline-block}button{background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*,.utterances{box-sizing:border-box}*{border:0}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;flex-direction:column}header p,ol,ul{margin-top:0}header nav .nav-title{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ol,li ul{margin-bottom:0}.utterances{position:relative;width:100%;max-width:760px;margin-left:auto;margin-right:auto}.w-full{width:100%}body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color);--paginationCurrentColor: #666356}@media (prefers-color-scheme:dark){body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color);--paginationCurrentColor: #666356}}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}.post,footer{border-top:1px solid #ccc}.post{padding-top:35px;margin-top:35px}.menu__btn{display:inline-block;width:24px;height:24px;position:relative}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav,#nav .nav-title,header{display:flex;align-items:center}#nav{position:relative;height:68px;z-index:2}#nav .nav-title{padding:.375rem 1.5rem;width:100%;justify-content:space-between}#nav .nav-title *,.article-footer img{margin:0}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}.nav-logo{width:260px;height:40px;background:url(/img/logo1.png) no-repeat center center;background-size:contain}footer{margin-top:48px;font-size:14px;padding:24px;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.direct-link{display:none}.post-avatar{margin-top:27px;display:flex;align-items:center;height:36px}.post-avatar__img{width:36px;height:36px;overflow:hidden;margin:0;border-radius:50%}.post-avatar__time{font-size:13px}.post-avatar__info{margin-left:8px;color:#747474;text-align:left}.post-avatar__author{font-size:14px;font-weight:700}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}.article-author{margin-top:34px;display:flex;align-items:flex-start;margin-bottom:48px}.article-author__img{width:80px;height:80px;overflow:hidden;margin:0;border-radius:50%;flex-shrink:0}.article-author__info{margin-left:16px;text-align:left}.article-author__title{color:#747474;font-size:16px}.article-author__author{font-size:22px;font-weight:700;line-height:1em}.article-author__intro{color:#2f2f2f;margin-top:8px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav-logo{width:313px}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id=nav><div class=nav-title><a href=/ class=nav-logo title=Homepage></a> <label class=menu__btn for=menu__control><span>Menu</span></label></div><div class=nav__links><a href=/archive/ >Archive</a> <a href=/tags/ >Tags</a> <a href=/about/ >About</a></div></div><div id=reading-progress aria-hidden=true></div></nav><h1 class=w-full>秒懂 SQL Injection</h1><aside class=w-full><div class=post-tags><a href=/tags/security/ class=post-tag>#Security</a> <a href=/tags/sql-injection/ class=post-tag>#SQL Injection</a> <a href=/tags/sql/ class=post-tag>#SQL</a> <a href=/tags/web/ class=post-tag>#Web</a></div><div class=post-avatar><img alt=nick src=/img/authors/nick_logo.jpg class=post-avatar__img data-deopt=true><div class=post-avatar__info><div class=post-avatar__author><a href=/posts/nick>nick</a></div><div class=post-avatar__time>31 Aug 2021</div></div></div></aside><dialog id=message></dialog></header><main><article><div id=post-page></div><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_1-1920w.webp 1920w, /img/posts/nick/sqli/sqli_1-1280w.webp 1280w, /img/posts/nick/sqli/sqli_1-640w.webp 640w, /img/posts/nick/sqli/sqli_1-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_1-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_1-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_1-640w.jpg 640w, /img/posts/nick/sqli/sqli_1-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_1-1920w.jpg height=901 width=1351 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1351 901'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAGCAIAAACepSOSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVQI1wGoAFf/ACAeFSEbEW1eTkY/NidTXwZEW2W3ykW46BB0qwAfHxd0a123nYiejIB4gYJveXpMgJVEZnsXIi0AZFlOsKyji5GLdHBmi3htfnJpJCkvDA8QHSMfAKCPepCAbHBiU009LU88K2JINEE+NTU8OImMfwC4qXmHe2RSRjiIdF+ghGmxr5q/y7iksqZgdHQAMjQqPzovfHlq0K2L2JhtzMW1q8S7SFhQGyEcIYFByZB7xX8AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h2 id=%E5%89%8D%E8%A8%80><a href=#%E5%89%8D%E8%A8%80 class=direct-link>#</a> 前言</h2><p>現實生活中也可能發生 SQL Injection ? 買飲料的時候店員問你甜度冰塊，你卻跟店員說店長已經連續三個月忘記繳水電費，再不交就要斷水斷電，店員情急之下不疑有他，把盈餘拿出來請你幫忙繳清，你就帶著這筆錢一走了之，SQL Injection 就如同這詐騙一般的行為發生在網站上，開發者沒考慮到意料之外的輸入，駭客趁機對資料庫下命令來竊取或竄改資料，特定狀況下還可以攻到伺服器。</p><h2 id=%E5%AF%A6%E9%9A%9B%E6%A1%88%E4%BE%8B><a href=#%E5%AF%A6%E9%9A%9B%E6%A1%88%E4%BE%8B class=direct-link>#</a> 實際案例</h2><p>SQL Injection 真的已經出現很久了，但它依然不斷發生，這邊分享幾個相關的資安新聞，逐個介紹的話就偏離我們快速了解的目標，先了解其嚴重性即可，如果對 SQL Injection 攻擊所造成的影響有興趣，不仿花點時間看看。</p><ul><li>2012年 Yahoo<br><a href=https://www.inside.com.tw/article/1487-yahoo-leaked-450k-accounts rel="noopener noreferrer" target=_blank>https://www.inside.com.tw/article/1487-yahoo-leaked-450k-accounts</a></li><li>2015年 Joomla<br><a href=https://thehackernews.com/2015/10/joomla-security.html rel="noopener noreferrer" target=_blank>https://thehackernews.com/2015/10/joomla-security.html</a></li><li>2021年 中華民國國防部<br><a href=https://udn.com/news/story/10930/5238128 rel="noopener noreferrer" target=_blank>https://udn.com/news/story/10930/5238128</a></li></ul><h2 id=sql-injection-%E6%80%8E%E9%BA%BC%E7%99%BC%E7%94%9F-%3F><a href=#sql-injection-%E6%80%8E%E9%BA%BC%E7%99%BC%E7%94%9F-%3F class=direct-link>#</a> SQL Injection 怎麼發生 ?</h2><p>SQL Injection 的原理很簡單，利用網頁程式設計者忽略檢查使用者輸入內容造成攻擊，但只從一句話很難看出到底發生了什麼，下面用生活化的例子，帶大家快速了解整個流程。</p><h3 id=%E6%AD%A3%E5%B8%B8%E6%B5%81%E7%A8%8B><a href=#%E6%AD%A3%E5%B8%B8%E6%B5%81%E7%A8%8B class=direct-link>#</a> 正常流程</h3><p>了解攻擊流程之前需要先了解正常網站的作業流程，這邊先用兩張圖來說明。</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_2-1920w.webp 1920w, /img/posts/nick/sqli/sqli_2-1280w.webp 1280w, /img/posts/nick/sqli/sqli_2-640w.webp 640w, /img/posts/nick/sqli/sqli_2-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_2-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_2-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_2-640w.jpg 640w, /img/posts/nick/sqli/sqli_2-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_2-1920w.jpg height=800 width=1600 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1600 800'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAIAAAAcxIEBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiUlEQVQI1yWMuw6FIBBE+f/vsrKhVAkKMT6C8hakMJI7uW6xmdk5syTnfN93KUUpdV2X9x72EyklbLJt23Ec1lpAxhitdQjhPE8UcBdCEFBfTClt2/Z936ZpGGMxxnmeu64jnHNk+AzR9/2+78MwoCqlXJYFKEGp1goi/2eapud5nHPjOK7rCvsDTUaWMac0Oz0AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_3-1920w.webp 1920w, /img/posts/nick/sqli/sqli_3-1280w.webp 1280w, /img/posts/nick/sqli/sqli_3-640w.webp 640w, /img/posts/nick/sqli/sqli_3-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_3-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_3-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_3-640w.jpg 640w, /img/posts/nick/sqli/sqli_3-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_3-1920w.jpg height=800 width=1600 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1600 800'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAIAAAAcxIEBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQI1yWNuQ6DMBBE/f//RYVIhwQWpxASNibrK7t2Ac4qmWKK0dM88TxPKQURrbXee6XUvznXdWmtxaHPSOk0JsbonOOV0fOXeZ7bthVvAMrJedc0r7qu7/uuqmoYBqa3bev7XlgLRKi1WpZlHMcQQtd1+77zx7quUkqB3qcQwJgPYkoJAHLORMQ6tkzT9AVuRpcR+nSPfgAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>網站登入流程</p><ol><li>用戶在頁面上輸入帳號密碼。</li><li>前端將從頁面上將資料整理給後端。</li><li>後段將資料整理成 SQL 格式，向資料庫詢問是否存在一個名稱欄位為 admin 密碼欄位為 password 的使用者，如果存在的話 ID 是多少。</li><li>後端從資料庫找到這個使用者後判斷讓用戶登入。</li><li>前端在頁面上顯示登入成功。</li></ol><h3 id=%E6%94%BB%E6%93%8A%E6%B5%81%E7%A8%8B><a href=#%E6%94%BB%E6%93%8A%E6%B5%81%E7%A8%8B class=direct-link>#</a> 攻擊流程</h3><p>SQL Injection 攻擊的流程，示範如何不用密碼就可登錄網站。</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_4-1920w.webp 1920w, /img/posts/nick/sqli/sqli_4-1280w.webp 1280w, /img/posts/nick/sqli/sqli_4-640w.webp 640w, /img/posts/nick/sqli/sqli_4-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_4-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_4-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_4-640w.jpg 640w, /img/posts/nick/sqli/sqli_4-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_4-1920w.jpg height=800 width=1600 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1600 800'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAFCAIAAAAcxIEBAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAkElEQVQI1yXN3QqEIBBAYd//vbqKbqMi+qENbCadETVHWGmFfYDzHVVKed/3eR5mds4RgLNWa41akzGIqC6AJHIhhBCIKHrvmAGAED/b1ve9skQpCzF3Xde27beUpmnmea7gcRzjOCprTBap7Lquy7J474dhOM+z+vu+T9OkxPscAt93jFFE6ijnnFIyxvybH3I7lxwbiZ3wAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>網站登入流程(SQL Injection)</p><ol><li>用戶輸入帳號密碼。</li><li>前端將資料整理給後端。<br><font color=#FF0000></font></li><font color=#FF0000></font><li><font color=#FF0000>後段將資料整理成SQL語法格式，向資料庫詢問是否存在一個名稱欄位為 admin 或 1=1 和密碼為空的使用者，如果存在的話 ID 是多少。</font></li><li><font color=#FF0000>後端從資料庫找不到這個使用者但因為 1 等於 1 所以讓讓用戶登入。</font></li><li>前端在頁面上顯示登入成功。</li></ol><p>從流程中可以看出因為輸入中加上符號後組合成 SQL 語句，影響了步驟 3 的輸入與步驟 4 的判斷，因為與 1=1 取聯集導致查詢一定成立，所以即使密碼錯了也可以成功登入。明顯看出攻擊者透過截斷原本程式的語意，插入他希望執行的 SQL 語法，達成攻擊的效果。</p><h2 id=sql-injection-%E6%9C%89%E5%93%AA%E4%BA%9B%E7%A8%AE%E9%A1%9E-%3F><a href=#sql-injection-%E6%9C%89%E5%93%AA%E4%BA%9B%E7%A8%AE%E9%A1%9E-%3F class=direct-link>#</a> SQL Injection 有哪些種類 ?</h2><p>看懂攻擊原理後是否感覺 SQL Injection 其實很單純 ? 可惜在實務較為複雜，當開發者想出了方法來保護資料庫後，駭客會在想出新的攻擊手法來繞過，在這互相競爭的過程中，衍伸出各種花式攻擊，我們通常依攻擊手法分成 3 大類，接著利用知名的靶站 DVWA 做一個簡單的示範。</p><h3 id=1.-in-band-sql-injection><a href=#1.-in-band-sql-injection class=direct-link>#</a> 1. In-band SQL Injection</h3><p>最常見和最容易被利用的一種。攻擊者藉由插入 SQL 語法來從資料庫收集資訊，以攻擊方式來看又可再細分為兩個小類別。</p><p>在了解攻擊之前還是要先了解正常運作的狀況，範例中是一個查詢頁面，輸入整數的 ID 可以顯示出對應的人員名稱。</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_5-1920w.webp 1920w, /img/posts/nick/sqli/sqli_5-1280w.webp 1280w, /img/posts/nick/sqli/sqli_5-640w.webp 640w, /img/posts/nick/sqli/sqli_5-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_5-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_5-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_5-640w.jpg 640w, /img/posts/nick/sqli/sqli_5-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_5-1920w.jpg height=563 width=1519 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1519 563'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAFCAIAAAAR2vFGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA00lEQVQI1wHIADf/AGhveVJXYE5UXl1qenuQp36RqHWJoHWKoXaLo3iNpn2SqYGRo5WUnwCHiYonJyMtLSorKygoJyQzMjBXWFAwMCokJCEnJiMpKSUrKyiYm5wAzdHQnqGXqayksLKqpqmhrrGotrqvra+nuby0ur21ury0ubuz3N3dAN3g48C/wNPT1fb09fPv7/X19fDx8fv8/P////////////7+/u3u8ADV2t6ztbjDxsrp6evw5uju7/Hv8/Xv8vPv8vTv8vTu8fPt8fHk6OyploAABdczogAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><ul><li><p><strong>Error-based</strong></p><ul><li>簡介: 藉由錯誤訊息來取得想要的資訊。</li><li>攻擊範例: <code>'</code></li><li>測試結果: 藉由錯誤訊息來取得資料庫的類型，以便於之後針對性的攻擊。<br><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_6-1920w.webp 1920w, /img/posts/nick/sqli/sqli_6-1280w.webp 1280w, /img/posts/nick/sqli/sqli_6-640w.webp 640w, /img/posts/nick/sqli/sqli_6-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_6-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_6-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_6-640w.jpg 640w, /img/posts/nick/sqli/sqli_6-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_6-1920w.jpg height=282 width=1519 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1519 282'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAADCAIAAAARJsg+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAoklEQVQI12NIya3wCYryCo5184vwi84q6FjYMGtr85zt9TO2VExcUzl5PRBVTdlQPXVj46ztNROXt89YM3vKPIaNm7dt3rhxAxCsX7d+3VogWLNmzbq169auWbtu3fqV8xesXLR49RoQ2Lhh4+7duzdv2bJ55z6Gd19/f/35++uPP99+/f32E4L+fP0BE/n+69uP3xBxoMinbz///fv3489/AEiudWnPBFsoAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></li></ul></li><li><p><strong>Union-based</strong></p><ul><li>簡介: 將多筆查詢的結果藉由 UNION 語法合併到單次查詢中，藉此查詢原本不提供的資訊。</li><li>攻擊範例:<code>' union all select system_user(),user() #</code></li><li>測試結果: 在原本的查詢內容之外加上對伺服器用戶的查詢，範例中成功的找出使用者(app@localhost)。</li></ul><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_7-1920w.webp 1920w, /img/posts/nick/sqli/sqli_7-1280w.webp 1280w, /img/posts/nick/sqli/sqli_7-640w.webp 640w, /img/posts/nick/sqli/sqli_7-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_7-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_7-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_7-640w.jpg 640w, /img/posts/nick/sqli/sqli_7-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_7-1920w.jpg height=554 width=1519 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1519 554'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAFCAIAAAAR2vFGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA00lEQVQI1wHIADf/AElOVkVJUU9ZZW1/k3KEmW+Bl2p9kW1/lG6Blm6Bl3SFmXeElJSUoAAnJiMwMC0sKygpJyQmJCFUVE1GRz0jIh8nJiMmJSInJiM2NTKxt7oAra+ntrmywMS7uL62ucG4wMa8vMC3w8a/zNDHy8/Gyc3Fzc/H4eXpAL69vdLR0fby8vjq6fXk4vHm5fj08////v////////////79++fr7gCttby6w8vc4enm2uHl09rk3+fk6vLk6/Hl7vXk7PPi6/Pi6vHX4u3cbH769+ig0gAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p></li></ul><h3 id=2.-inference-(blind)-sql-injection><a href=#2.-inference-(blind)-sql-injection class=direct-link>#</a> 2. Inference (Blind) SQL Injection</h3><p>部分頁面輸入後並不像查尋頁面會直接顯示從資料庫來的資料，甚至根本沒有回應 ! 所以攻擊者需要靠其他資訊來攻擊，因為大多數狀況下要靠反複猜測來猜取資料內容，這類型攻擊又常被稱為盲測，以攻擊方式來看又可再細分為兩個小類別，分別對應網站有回應跟沒有回應的兩種狀況。</p><p>在了解攻擊之前還是要先了解正常運作的狀況，範例中是一個查詢頁面，輸入整數的 ID 之後網站會告訴你這個 ID 在資料庫中資否存在，所以只會回應有跟沒有，不會直接顯示從資料庫中得到的資料。</p><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_8-1920w.webp 1920w, /img/posts/nick/sqli/sqli_8-1280w.webp 1280w, /img/posts/nick/sqli/sqli_8-640w.webp 640w, /img/posts/nick/sqli/sqli_8-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_8-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_8-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_8-640w.jpg 640w, /img/posts/nick/sqli/sqli_8-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_8-1920w.jpg height=613 width=1891 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1891 613'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAECAIAAAAxsZngAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQI1wGsAFP/AH+AgRkYFyMiIh0cGh4cGh0bGlFRTDw9NBgXFh0bGhsZGBkXFignJbS5vQDKzcqlqJysr6Sws6ilqZ6mqZ6usqWusqWkqJyqrqO3u7C1ua67vbHY3N8A3+DiwcHB1NPU9vX19PPy9vX08PDv8/T0+/37/P38//////////794ubpANXa37Cztr/CxuXo6+zr7uzq7ero6u3x8+7y9ezx8+vw8uvw8uvv8dvj6vz3cjrLUANIAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><ul><li><p><strong>Content-based</strong></p><ul><li>簡介: 從頁面的內容來判斷攻擊是否成功，故需能從頁面上看出反應。</li><li>攻擊範例: <code>' ; DROP table USERS ; --</code></li><li>測試結果: 查詢 ID = 1 的使用者已不存在，代表攻擊已成功刪除 table。</li></ul><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_9-1920w.webp 1920w, /img/posts/nick/sqli/sqli_9-1280w.webp 1280w, /img/posts/nick/sqli/sqli_9-640w.webp 640w, /img/posts/nick/sqli/sqli_9-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_9-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_9-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_9-640w.jpg 640w, /img/posts/nick/sqli/sqli_9-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_9-1920w.jpg height=613 width=1891 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1891 613'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAECAIAAAAxsZngAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQI1wGsAFP/AHx8fR4dHScmJiQkJCYlJSUkJVlaV0VFPyEgISUlJCMiIiAgHzMyMp2hogDBw76lqZyqraKusqajqJykqJyssaOssKOipZqorKC1ua2xtKnAw7i1t7cA2trbxsXF1tbX9vX19vHw+PPz8+3t9fLy/v///v7+/////f39////wsPFAMHDxaOkprCztNfW1t3U1N3S09zQ0d7W1+Dj497h4d3f4Nze3+Tl5rCyteWzbq5r0GCFAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p></li><li><p><strong>Time-based</strong></p><ul><li>簡介: 從等待時間來判斷攻擊是否成功。</li><li>攻擊範例: <code>1' and sleep(5)#</code></li><li>測試結果: 可從左上角可判斷出網站正在等待，藉由檢查等待時間是否為 5 秒來判斷攻擊時否成功，成功代表可做 Time-based 相關的進階測試。</li></ul><p><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_10-1920w.webp 1920w, /img/posts/nick/sqli/sqli_10-1280w.webp 1280w, /img/posts/nick/sqli/sqli_10-640w.webp 640w, /img/posts/nick/sqli/sqli_10-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_10-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_10-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_10-640w.jpg 640w, /img/posts/nick/sqli/sqli_10-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_10-1920w.jpg height=675 width=1890 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1890 675'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAFCAIAAAAR2vFGAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA00lEQVQI1wHIADf/AEtPU09UW2RwfWVxfmh0gWBsemFufGRxgGZzgGd1gWx4hWx0gIaJkwAjIyAuLSomJCElIiAjIR5QT0hBQDUgHh0nJCAhHxwfHhsuKympr7QAmZyRoKSapaienJ+VnKCWq6+ip6ufmp2UoKSZrLCmqq2jsbOn2+HmAL69vNLQ0PT08u/v7enr6+3t7fLx7/n49vr6+P/////////9++Lm6wCzucDAx8/Y3+bW3eTW3eXj6/Lj6/Hl7PPk6/Lg6O7i6fDi6O/W4ezS3HhkCMr4AQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p></li></ul><h3 id=3.-out-of-band-sql-injection><a href=#3.-out-of-band-sql-injection class=direct-link>#</a> 3. Out-of-band SQL Injection</h3><p>該類因為攻擊前置需求比較高，所以比較少發生，攻擊方式主要是透過 SQL Injection 來攻擊與資料庫有串連的系統，像是 DNS Server、文件系統、電子郵件等等，所以攻擊方式取決於後面有串那些系統，本次測試靶站利用 docker 架的環境相對單純，沒有這類型的問題。</p><p>發生機會低不代表問題不會發生，因為缺範例這邊補上一篇近期從 SQL 打到 DNS 的資安新聞。</p><p><strong><a href=https://www.cna.com.tw/news/aipl/202101270075.aspx rel="noopener noreferrer" target=_blank title=Title>政府網路遇襲上月近10萬件 非核心系統也成目標</a></strong><br><picture><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_11-1920w.webp 1920w, /img/posts/nick/sqli/sqli_11-1280w.webp 1280w, /img/posts/nick/sqli/sqli_11-640w.webp 640w, /img/posts/nick/sqli/sqli_11-320w.webp 320w" type=image/webp><source sizes="(max-width: 608px) 100vw, 608px" srcset="/img/posts/nick/sqli/sqli_11-1920w.jpg 1920w, /img/posts/nick/sqli/sqli_11-1280w.jpg 1280w, /img/posts/nick/sqli/sqli_11-640w.jpg 640w, /img/posts/nick/sqli/sqli_11-320w.jpg 320w" type=image/jpeg><img alt="" src=/img/posts/nick/sqli/sqli_11-1920w.jpg height=947 width=1386 decoding=async loading=lazy style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1386 947'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAGCAIAAACepSOSAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAiElEQVQI1xWMzQ7CIBCEef938+LJpNoDxhYWWFgrluUvrjNfJnOZUYDfywLXNTw2uj3jur/vGy0vKmWo2jpXruVkgf/ZKgtzTsXcAqIFEIwFYyQgEY0hu9rzJ6P3wbuE6KyVno9j9K5Gn0cIm9a71t6Y5FwEIO/bWVRvIxN5xBBQLG8xiWJn/gG6JpfrsFFjRQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h2 id=%E7%B8%BD%E7%B5%90%3A><a href=#%E7%B8%BD%E7%B5%90%3A class=direct-link>#</a> 總結:</h2><p>SQL Injection 畢竟是由使用者輸入所導致的問題，要解決當然也要從輸入下手。</p><p><strong>解決方案（一） : 輸入過濾</strong></p><p>過濾輸入是最常見的防範方法，藉由檢查 SQL 語法中有意義的符號來避免語意被竄改，但要特別注意兩點，第一是必須在後端進行過濾，因為駭客有太多機會繞過前端檢查，第二是避免用黑名單的方式過濾，因為駭客會嘗試用合法的字元來組合出該被過濾掉的符號，用白名單可以將這個問題的發生機率降到最低，不過白名單只適合用在輸入較為單純的網站，如果網站的輸入較複雜或者必須包含符號，建議改用其他方法。</p><p><strong>解決方案（二） : 參數化</strong></p><p>限制輸入僅含參數不含語法，接著在輸入後立刻轉換輸入格式。</p><p>以開頭的免密碼登入攻擊來舉例，實際上資料庫收到的 SQL 語句如下。</p><pre><code>SELECT ID FROM Accounts WHERE user ='admin or '1'=1' and 'pass'='';
</code></pre><p>如果在先轉換輸入內容轉換為字串再放入 SQL 語句。</p><pre><code>SELECT ID FROM Accounts WHERE user="admin\' or \'1\'=\'1" and 'pass'="";
</code></pre><p>這時會去檢查有沒有一個名稱為 <font color=#FF0000>admin' or '1'='1 </font>的帳號，結果當然是找不到攻擊也失效，這種方法比較通用，不過要注意轉換失敗時的例外處理，部分程式語言會直接 crash，影響到網站服務。</p><p><strong>解決方案（三） : 資料庫套件</strong></p><p>其實這個解決方案是前兩個安案的延伸，有一些套件已經幫你做完上述兩件事情，所以透過套件來呼叫資料庫可防止攻擊發生，常見的像是 JAVA 的 JDBC 套件，其他程式語言也有類似的套件，但使用前務必做好功課，避免用了不安全的套件導致網站還是受到攻擊。</p><br><p>前面為快速說明原理挑了一些簡單易懂的攻擊來示範，實際上還有更多進階的攻擊手法，如果閱覽數量夠多，之後會再加開一篇分享一些更進階的用法與經典案例，有任何資安方面相關的問題都歡迎留言討論，或者直接到 Cymetrics 尋求協助。</p><div class=article-footer><a href=https://tech-blog.cymetrics.io/posts/nick/sqli/ on-click=share><img alt=Share src="/img/icons/icon_external link hyperlink.svg" height=24 width=24>Share this post</a></div><div><p style="font-weight: bold;">更多同分類文章</p><div class=post-tags><a href=/tags/security/ class=post-tag>#Security</a> <a href=/tags/sql-injection/ class=post-tag>#SQL Injection</a> <a href=/tags/sql/ class=post-tag>#SQL</a> <a href=/tags/web/ class=post-tag>#Web</a></div></div><div class=article-author><img alt=nick src=/img/authors/nick_logo.jpg class=article-author__img data-deopt=true><div class=article-author__info><div class=article-author__title>Author</div><div class=article-author__author><a href=/posts/nick>nick</a></div><div class=article-author__intro>Security</div></div></div><script async src=https://utteranc.es/client.js crossorigin=anonymous id=utterance-script issue-term=title label=utterance repo=cymetrics/blog theme=github-light></script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"秒懂 SQL Injection","image":["https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_1-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_2-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_3-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_4-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_5-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_6-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_7-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_8-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_9-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_10-1920w.jpg","https://tech-blog.cymetrics.io/img/posts/nick/sqli/sqli_11-1920w.jpg","https://tech-blog.cymetrics.io/img/icons/icon_external link hyperlink.svg","https://tech-blog.cymetrics.io/img/authors/nick_logo.jpg"],"author":{"@type":"Person","name":"nick"},"publisher":{"@type":"Organization","name":"Cymetrics Tech Blog","url":"https://tech-blog.cymetrics.io","logo":{"@type":"ImageObject","url":"https://tech-blog.cymetrics.io/img/favicon/favicon-512x512.png","width":512,"height":512}},"url":"https://tech-blog.cymetrics.io/posts/nick/sqli/","mainEntityOfPage":"https://tech-blog.cymetrics.io/posts/nick/sqli/","datePublished":"2021-08-31","dateModified":"2021-09-07","description":"# 前言 現實生活中也可能發生 SQL Injection ? 買飲料的時候店員問你甜度冰塊，你卻跟店員說店長已經連續三個月忘記繳水電費，再不交就要斷水斷電，店員情急之下不疑有他，把盈餘拿出來請你幫忙繳清，你就帶著這筆錢一走了之，SQL Injection..."}</script><script type=application/ld+json>{   
  "@context":"http://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Cymetrics Tech Blog",
      "item": "https://tech-blog.cymetrics.io"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Archive",
      "item": "https://tech-blog.cymetrics.io/archive/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "秒懂 SQL Injection",
      "item": "https://tech-blog.cymetrics.io/posts/nick/sqli/"
    }
  ]
}</script></article></main><footer><div class=footer-logos><a href=https://www.facebook.com/Cymetrics-100957872049641 rel="noopener noreferrer" target=_blank><img alt=facebook src="/img/icons/icon_social media_facebook.svg" height=30 width=30></a><a href=https://www.linkedin.com/company/onedegree-hk rel="noopener noreferrer" target=_blank><img alt=linkedin src="/img/icons/icon_social media_linkedln.svg" height=30 width=30></a><a href=https://tech-blog.cymetrics.io/feed/feed.xml rel="noreferrer noopener" target=_blank><img alt="rss feed" src=/img/icons/rss-feed.svg height=30 width=30></a></div><div class=copyright>© 2021 Cymetrics Tech Blog</div></footer><script>// light/dark theme switch
      // disable dark mode for now
      const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })
      

      /*
      const toggleEl = document.querySelector('#color-scheme-toggle')
      const bodyEl = document.querySelector('body');
      const DARK = 'dark';
      const LIGHT = 'light';
      const currentTheme = localStorage.getItem("theme") ||
            (window.matchMedia('(prefers-color-scheme: dark)').matches ? DARK : LIGHT);
      setTheme(currentTheme)

      toggleEl.addEventListener("click", handleToggleEvent)

      function handleToggleEvent(){
        const isDark = bodyEl.classList.toggle(DARK);
        const theme = isDark ? DARK : LIGHT;
        setTheme(theme)
        localStorage.setItem('theme', theme);
      }
      function setTheme(theme){
        if (theme === DARK) {
          setUtterancesTheme(DARK)
          bodyEl.classList.add(DARK);
          toggleEl.src = toggleEl.src.replace(DARK, LIGHT);
        }else{
          setUtterancesTheme(LIGHT)
          toggleEl.src = toggleEl.src.replace(LIGHT, DARK);
        }
      }

      var isUtterancesLoaded = false
      window.addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') {
          return;
        }
        isUtterancesLoaded = true
      });

      function setUtterancesTheme(theme) {
        let utterancesIframe = document.querySelector('.utterances iframe')
        if (!isUtterancesLoaded) {
          return requestAnimationFrame(() => setUtterancesTheme(theme))
        }

        utterancesIframe.contentWindow.postMessage({
          type: 'set-theme',
          theme: theme === DARK ? 'github-dark-orange' : 'github-light'
        }, 'https://utteranc.es');
      }
    */</script></body></html>